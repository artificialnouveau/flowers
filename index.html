<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flowers</title>
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
  html { overflow-x: hidden; width: 100%; }

  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: #0f0f1a;
    color: #e2e8f0;
    min-height: 100vh;
    overflow-x: hidden;
  }

  header {
    padding: 20px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 16px;
    border-bottom: 1px solid #1e293b;
    background: #0f0f1aee;
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(12px);
  }

  header h1 {
    font-size: 1.4rem;
    font-weight: 300;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .controls {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
  }

  select, button, #searchBar {
    background: #1e293b;
    color: #e2e8f0;
    border: 1px solid #334155;
    padding: 8px 14px;
    border-radius: 6px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  #searchBar {
    width: 160px;
    cursor: text;
  }
  #searchBar:focus {
    outline: none;
    border-color: #6366f1;
    box-shadow: 0 0 0 2px #6366f130;
  }

  select:hover, button:hover {
    background: #334155;
    border-color: #475569;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px;
    padding: 28px;
  }

  .card {
    background: #1a1a2e;
    border: 1px solid #1e293b;
    border-radius: 14px;
    padding: 12px;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .card:hover {
    border-color: #475569;
    transform: translateY(-3px);
    box-shadow: 0 8px 32px #0008;
  }

  .card svg { width: 190px; height: 200px; }

  .card .label {
    margin-top: 6px;
    font-size: 0.85rem;
    font-weight: 600;
    text-align: center;
  }

  .card .sub-label {
    font-size: 0.68rem;
    color: #64748b;
    margin-top: 2px;
    text-align: center;
  }

  /* Solo overlay */
  .overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: #0f0f1af2;
    z-index: 200;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(8px);
    transition: background 0.4s ease;
  }
  .overlay.open { display: flex; }

  #hallucinationCanvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    pointer-events: none;
  }

  .overlay > *:not(#hallucinationCanvas) {
    position: relative;
    z-index: 1;
  }

  .return-btn {
    font-size: 0.85rem;
    padding: 8px 16px;
    background: #334155;
    border: 1px solid #475569;
    color: #e2e8f0;
    border-radius: 6px;
    cursor: pointer;
  }
  .return-btn:hover { background: #475569; }

  .overlay svg.solo-flower {
    width: min(70vw, 420px);
    height: min(70vw, 420px);
  }

  .solo-info { text-align: center; margin-top: 12px; }

  .solo-info h2 {
    font-size: 1.6rem;
    font-weight: 300;
    letter-spacing: 1px;
  }

  .solo-info .category-tag {
    font-size: 0.75rem;
    color: #64748b;
    margin-top: 3px;
  }

  .phase-indicator {
    margin-top: 10px;
    font-size: 0.95rem;
    color: #a78bfa;
    font-weight: 500;
    min-height: 22px;
  }

  .timeline-container {
    margin-top: 16px;
    width: min(70vw, 420px);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }

  .timeline-container input[type=range] {
    width: 100%;
    accent-color: #6366f1;
    cursor: pointer;
  }

  .timeline-labels {
    display: flex;
    justify-content: space-between;
    width: 100%;
    font-size: 0.7rem;
    color: #64748b;
  }

  .solo-controls {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }

  .solo-controls button {
    font-size: 1.1rem;
    padding: 8px 18px;
  }

  /* Intro / legend */
  .intro {
    max-width: 800px;
    margin: 0 auto;
    padding: 24px 32px 8px;
    line-height: 1.6;
  }

  .intro p {
    font-size: 0.85rem;
    color: #94a3b8;
    margin-bottom: 10px;
  }

  .legend {
    display: flex;
    flex-wrap: wrap;
    gap: 6px 18px;
    font-size: 0.72rem;
    color: #64748b;
    margin-top: 4px;
  }

  .legend span { white-space: nowrap; }
  .legend b { color: #94a3b8; font-weight: 500; }

  /* Solo effect details */
  .solo-details {
    display: flex;
    flex-wrap: wrap;
    gap: 6px 16px;
    justify-content: center;
    margin-top: 10px;
    font-size: 0.72rem;
    color: #64748b;
    max-width: min(80vw, 480px);
  }

  .solo-details span b { color: #94a3b8; font-weight: 500; }

  .pw-link {
    display: inline-block;
    margin-top: 8px;
    color: #818cf8;
    font-size: 0.75rem;
    text-decoration: none;
    transition: color 0.2s;
  }
  .pw-link:hover { color: #a5b4fc; text-decoration: underline; }

  .dose-slider-wrap {
    margin-top: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.72rem;
    color: #64748b;
  }
  .dose-slider-wrap input[type=range] { width: 100px; accent-color: #6366f1; }
  .dose-slider-wrap .dose-label { color: #94a3b8; font-weight: 500; min-width: 50px; }

  /* Footer / credits */
  footer {
    padding: 24px 32px;
    border-top: 1px solid #1e293b;
    text-align: center;
    font-size: 0.72rem;
    color: #475569;
    line-height: 1.8;
    margin-top: 20px;
  }
  footer a { color: #6366f1; text-decoration: none; }
  footer a:hover { text-decoration: underline; }
  footer .disclaimer {
    max-width: 700px;
    margin: 12px auto 0;
    font-size: 0.68rem;
    color: #334155;
    line-height: 1.6;
  }

  /* Category headers in full list mode */
  .category-header {
    grid-column: 1 / -1;
    font-size: 1rem;
    font-weight: 400;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: #64748b;
    padding: 16px 0 4px;
    border-bottom: 1px solid #1e293b;
    margin-top: 8px;
  }
  .category-header:first-child { margin-top: 0; }

  .full-list-active { color: #6366f1 !important; border-color: #6366f1 !important; }

  /* Sound toggle */
  .sound-btn {
    font-size: 1.1rem;
    background: #1e293b;
    border: 1px solid #334155;
    color: #94a3b8;
    cursor: pointer;
    padding: 8px 14px;
    border-radius: 6px;
    z-index: 2;
    transition: all 0.2s;
  }
  .sound-btn:hover { background: #334155; color: #e2e8f0; }
  .sound-btn.active { color: #6366f1; border-color: #6366f1; }

  /* Hybrid flower in compare mode */
  .compare-flowers .hybrid-side {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .compare-flowers .hybrid-side svg {
    width: min(28vw, 220px);
    height: min(28vw, 220px);
  }
  .hybrid-label {
    font-size: 0.75rem;
    color: #a78bfa;
    margin-top: 4px;
    font-style: italic;
  }

  /* Compare mode */
  .compare-bar {
    display: none;
    align-items: center;
    gap: 12px;
    padding: 12px 32px;
    background: #1a1a2eee;
    border-bottom: 1px solid #334155;
    backdrop-filter: blur(8px);
    font-size: 0.85rem;
  }
  .compare-bar.active { display: flex; flex-wrap: wrap; }

  .compare-bar .pick-label { color: #94a3b8; }

  .compare-bar .picked {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: #334155;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
  }

  .compare-bar .picked .remove-pick {
    cursor: pointer;
    color: #94a3b8;
    font-weight: bold;
    font-size: 1rem;
    line-height: 1;
    background: none;
    border: none;
    padding: 0 0 0 4px;
  }

  .compare-bar .picked .remove-pick:hover { color: #f87171; }

  .compare-bar .go-btn {
    background: #4f46e5;
    border-color: #6366f1;
    padding: 6px 16px;
    font-size: 0.8rem;
  }

  .compare-bar .cancel-btn {
    background: transparent;
    border-color: #475569;
    padding: 6px 16px;
    font-size: 0.8rem;
  }

  .card.selectable { cursor: crosshair; }
  .card.selected {
    border-color: #6366f1 !important;
    box-shadow: 0 0 16px rgba(99,102,241,0.4) !important;
  }

  /* Compare overlay */
  .compare-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: #0f0f1af2;
    z-index: 200;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(8px);
    overflow: auto;
  }
  .compare-overlay.open { display: flex; }

  #compareCanvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    pointer-events: none;
  }

  .compare-overlay > *:not(#compareCanvas) {
    position: relative;
    z-index: 1;
  }

  .compare-flowers {
    display: flex;
    gap: 24px;
    align-items: flex-end;
    justify-content: center;
    flex-wrap: wrap;
  }

  .compare-flowers .compare-side {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .compare-flowers svg {
    width: min(38vw, 300px);
    height: min(38vw, 300px);
  }

  .hybrid-flower {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: -20px auto 0;
  }
  .hybrid-flower svg {
    width: min(28vw, 200px);
    height: min(28vw, 200px);
    filter: drop-shadow(0 0 12px rgba(139, 92, 246, 0.4));
  }
  .hybrid-label {
    font-size: 0.7rem;
    color: #a78bfa;
    margin-top: 4px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .compare-side .compare-label {
    margin-top: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    text-align: center;
  }

  .compare-side .compare-phase {
    font-size: 0.75rem;
    color: #a78bfa;
    margin-top: 2px;
    min-height: 18px;
  }

  .compare-info {
    text-align: center;
    margin-top: 14px;
  }

  .compare-info h2 {
    font-size: 1.3rem;
    font-weight: 300;
    letter-spacing: 1px;
  }

  .compare-info .interaction-tag {
    font-size: 0.8rem;
    margin-top: 6px;
    padding: 4px 14px;
    border-radius: 20px;
    display: inline-block;
  }

  .compare-info .interaction-desc {
    font-size: 0.72rem;
    color: #94a3b8;
    margin-top: 6px;
    max-width: 500px;
  }

  .compare-timeline {
    margin-top: 14px;
    width: min(80vw, 550px);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }

  .compare-timeline input[type=range] {
    width: 100%;
    accent-color: #6366f1;
    cursor: pointer;
  }

  .compare-controls {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }

  .compare-controls button {
    font-size: 1.1rem;
    padding: 8px 18px;
  }

  /* ─── Mobile responsive ─── */
  @media (max-width: 640px) {
    html, body { overflow-x: hidden; width: 100%; }

    header {
      padding: 12px 12px;
      gap: 8px;
    }
    header h1 { font-size: 1.1rem; }

    .controls {
      gap: 6px;
      width: 100%;
      justify-content: flex-start;
    }
    .controls > * {
      font-size: 0.72rem;
      padding: 6px 8px;
    }
    #searchBar { width: 100%; order: -1; }

    .grid {
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      padding: 12px;
    }
    /* Compact card on mobile */
    .card { padding: 8px; border-radius: 10px; }
    .card svg { width: 120px; height: 130px; }
    .card .label { font-size: 0.75rem; }
    .card .sub-label { font-size: 0.6rem; }

    /* List view on mobile */
    .grid.list-view {
      grid-template-columns: 1fr;
      gap: 4px;
    }
    .grid.list-view .card {
      flex-direction: row;
      gap: 10px;
      padding: 6px 10px;
    }
    .grid.list-view .card svg { width: 48px; height: 52px; flex-shrink: 0; }
    .grid.list-view .card .label { font-size: 0.8rem; margin-top: 0; }
    .grid.list-view .card .sub-label { font-size: 0.65rem; margin-top: 0; }
    .grid.list-view .category-header {
      font-size: 0.8rem;
      padding: 8px 10px 4px;
    }

    .intro { padding: 12px 14px 6px; }
    .intro p { font-size: 0.8rem; line-height: 1.5; }
    .legend { font-size: 0.65rem; gap: 4px 10px; }
    .legend span { white-space: normal; }

    .compare-bar { padding: 8px 12px; font-size: 0.75rem; gap: 8px; }

    /* Solo overlay mobile */
    .overlay svg.solo-flower { width: 60vw; height: 60vw; }
    .solo-info h2 { font-size: 1.2rem; }
    .timeline-container { width: 85vw; }
    .solo-details { font-size: 0.65rem; max-width: 90vw; }
    .dose-slider-wrap { font-size: 0.65rem; }
    .sound-btn { font-size: 0.9rem; padding: 6px 10px; }
    .return-btn { font-size: 0.75rem; padding: 6px 10px; }

    /* Compare overlay mobile */
    .compare-overlay { padding: 10px; }
    .compare-flowers svg { width: 35vw; height: 35vw; }
    .compare-flowers { gap: 12px; }
    .hybrid-flower svg { width: 25vw; height: 25vw; }
    .compare-info h2 { font-size: 1rem; }
    .compare-timeline { width: 85vw; }
    .compare-side .compare-label { font-size: 0.75rem; }
    .compare-side .compare-phase { font-size: 0.65rem; }

    footer { padding: 16px 12px; font-size: 0.7rem; }
  }

  /* Toggle between grid and list view on mobile */
  #viewToggle { display: none; }
  @media (max-width: 640px) {
    #viewToggle { display: inline-block; }
  }
</style>
</head>
<body>

<header>
  <h1>Flowers</h1>
  <div class="controls">
    <input type="text" id="searchBar" placeholder="Search drugs..." autocomplete="off">
    <select id="categoryFilter">
      <option value="All">All Categories</option>
    </select>
    <button id="fullListBtn" class="full-list-active">Curated (20)</button>
    <button id="compareBtn">Compare Two</button>
    <button id="randomPairBtn" title="Random pair">&#127922;</button>
    <button id="restartAllBtn">&#8634; Restart</button>
    <button id="viewToggle" title="Toggle list/grid view">&#9776; List</button>
  </div>
</header>

<div class="compare-bar" id="compareBar">
  <span class="pick-label">Select two flowers to compare:</span>
  <span id="picks"></span>
  <button class="go-btn" id="compareGo" style="display:none">Compare</button>
  <button class="cancel-btn" id="compareCancel">Cancel</button>
</div>

<div class="intro">
  <p>Each flower represents a drug's experience profile. The animation plays through onset, come-up, peak, offset, and after-effects in real-time compression (1 hour = 1 second). Click any flower to watch its full timeline.</p>
  <div class="legend">
    <span><b>Petals</b> = cognitive complexity (how many distinct thought patterns, altered perceptions, and mental effects — more petals = richer, more layered headspace)</span>
    <span><b>Shape</b> = drug class (rounded: depressants/entactogens, pointed: stimulants, wavy: psychedelics, wispy: dissociatives/deliriants)</span>
    <span><b>Color</b> = drug class (warm reds/yellows: stimulants, cool blues: depressants, purples/greens: psychedelics, grays: dissociatives, dark: deliriants)</span>
    <span><b>Size</b> = intensity</span>
    <span><b>Sway</b> = body load</span>
    <span><b>Center</b> = ego dissolution (the center disc is larger and pulses more during peak for substances that dissolve the sense of self — a big, breathing center means a stronger loss of identity)</span>
    <span><b>Stem</b> = total duration</span>
    <span><b>Glow</b> = peak phase</span>
    <span><b>Background</b> = hallucination intensity (brighter = stronger visuals)</span>
  </div>
</div>

<div class="grid" id="grid"></div>

<div class="overlay" id="overlay">
  <canvas id="hallucinationCanvas"></canvas>
  <div id="soloFlowerContainer"></div>
  <div class="solo-info">
    <h2 id="soloName"></h2>
    <div class="category-tag" id="soloCategory"></div>
    <div class="phase-indicator" id="phaseIndicator"></div>
    <div class="solo-details" id="soloDetails"></div>
    <a id="pwLink" class="pw-link" href="#" target="_blank" rel="noopener">View on PsychonautWiki &rarr;</a>
    <div class="dose-slider-wrap">
      <b>Dose:</b>
      <input type="range" id="doseSlider" min="1" max="3" step="0.1" value="2">
      <span class="dose-label" id="doseLabel">Medium</span>
    </div>
  </div>
  <div class="timeline-container">
    <input type="range" id="timeline" min="0" max="1000" value="0">
    <div class="timeline-labels">
      <span id="timeLabel">0:00</span>
      <span id="totalLabel">0:00</span>
    </div>
  </div>
  <div class="solo-controls">
    <button id="soloRestart">&#8634;</button>
    <button id="soloPlayPause">&#9654;</button>
    <button class="sound-btn" id="soloSoundBtn" title="Toggle sound">&#128264;</button>
    <button id="closeOverlay" class="return-btn">&larr; Return</button>
  </div>
</div>

<footer>
  Data sourced from <a href="https://psychonautwiki.org/" target="_blank" rel="noopener">PsychonautWiki</a> — thank you for maintaining an open, evidence-based resource.
  <br>Duration and classification data retrieved via the <a href="https://api.psychonautwiki.org/" target="_blank" rel="noopener">PsychonautWiki API</a>.
  <div class="disclaimer">
    This visualization is for educational and harm reduction purposes only. It does not constitute medical advice.
    Subjective effect ratings are approximations based on commonly reported experiences and should not be taken as definitive.
    Drug interactions shown are based on documented pharmacological interactions from harm reduction literature — individual responses vary significantly.
    Always consult qualified healthcare professionals and evidence-based resources before making decisions about substance use.
    Many of these substances are controlled or illegal in various jurisdictions.
  </div>
</footer>

<div class="compare-overlay" id="compareOverlay">
  <canvas id="compareCanvas"></canvas>
  <div class="compare-flowers" id="compareFlowers"></div>
  <div class="hybrid-flower" id="hybridFlower"></div>
  <div class="compare-info">
    <h2 id="compareTitle"></h2>
    <div class="interaction-tag" id="interactionTag"></div>
    <div class="interaction-desc" id="interactionDesc"></div>
  </div>
  <div class="compare-timeline">
    <input type="range" id="compareTimeline" min="0" max="1000" value="0">
    <div class="timeline-labels">
      <span id="compareTimeLabel">0h 00m</span>
      <span id="compareTotalLabel">0h 00m</span>
    </div>
  </div>
  <div class="compare-controls">
    <button id="compareRestart">&#8634;</button>
    <button id="comparePlayPause">&#9654;</button>
    <button class="sound-btn" id="compareSoundBtn" title="Toggle sound">&#128264;</button>
    <button id="closeCompare" class="return-btn">&larr; Return</button>
  </div>
</div>

<script>
// ─── Drug Data (embedded to work with file:// protocol) ───
const drugs = [
  {
    id: "lsd", name: "LSD", category: "Psychedelics", subcategory: "Lysergamides",
    duration: { onset: 0.5, comeUp: 1.5, peak: 4, offset: 3, afterEffects: 3 },
    effects: { cognitiveComplexity: 10, euphoria: 7, intensity: 9, bodyLoad: 4, egoDissolve: 8, visuals: 9 },
    flower: { petalCount: 12, petalShape: "wavy", primaryColor: "#a855f7", secondaryColor: "#f472b6", petalRadius: 38, centerSize: 14, stemHeight: 90 }
  },
  {
    id: "1p-lsd", name: "1P-LSD", category: "Psychedelics", subcategory: "Lysergamides",
    duration: { onset: 0.75, comeUp: 1.5, peak: 3.5, offset: 3, afterEffects: 2.5 },
    effects: { cognitiveComplexity: 9, euphoria: 6, intensity: 8, bodyLoad: 4, egoDissolve: 7, visuals: 8 },
    flower: { petalCount: 11, petalShape: "wavy", primaryColor: "#c084fc", secondaryColor: "#e879f9", petalRadius: 36, centerSize: 13, stemHeight: 85 }
  },
  {
    id: "psilocybin", name: "Psilocybin Mushrooms", category: "Psychedelics", subcategory: "Tryptamines",
    duration: { onset: 0.5, comeUp: 1, peak: 2.5, offset: 1.5, afterEffects: 1 },
    effects: { cognitiveComplexity: 8, euphoria: 7, intensity: 8, bodyLoad: 5, egoDissolve: 7, visuals: 8 },
    flower: { petalCount: 9, petalShape: "wavy", primaryColor: "#8b5cf6", secondaryColor: "#6ee7b7", petalRadius: 34, centerSize: 13, stemHeight: 55 }
  },
  {
    id: "dmt", name: "DMT", category: "Psychedelics", subcategory: "Tryptamines",
    duration: { onset: 0.05, comeUp: 0.08, peak: 0.17, offset: 0.17, afterEffects: 0.5 },
    effects: { cognitiveComplexity: 10, euphoria: 8, intensity: 10, bodyLoad: 6, egoDissolve: 10, visuals: 10 },
    flower: { petalCount: 12, petalShape: "wavy", primaryColor: "#e11d48", secondaryColor: "#fbbf24", petalRadius: 42, centerSize: 18, stemHeight: 30 }
  },
  {
    id: "mescaline", name: "Mescaline", category: "Psychedelics", subcategory: "Phenethylamines",
    duration: { onset: 1, comeUp: 2, peak: 4, offset: 3, afterEffects: 4 },
    effects: { cognitiveComplexity: 8, euphoria: 8, intensity: 8, bodyLoad: 6, egoDissolve: 6, visuals: 8 },
    flower: { petalCount: 9, petalShape: "wavy", primaryColor: "#059669", secondaryColor: "#fbbf24", petalRadius: 34, centerSize: 11, stemHeight: 95 }
  },
  {
    id: "2cb", name: "2C-B", category: "Psychedelics", subcategory: "Phenethylamines",
    duration: { onset: 0.5, comeUp: 0.75, peak: 2, offset: 1.5, afterEffects: 1 },
    effects: { cognitiveComplexity: 6, euphoria: 8, intensity: 7, bodyLoad: 5, egoDissolve: 3, visuals: 8 },
    flower: { petalCount: 7, petalShape: "wavy", primaryColor: "#ec4899", secondaryColor: "#a78bfa", petalRadius: 30, centerSize: 7, stemHeight: 48 }
  },
  {
    id: "ketamine", name: "Ketamine", category: "Dissociatives", subcategory: "Dissociatives",
    duration: { onset: 0.08, comeUp: 0.17, peak: 0.75, offset: 0.5, afterEffects: 2 },
    effects: { cognitiveComplexity: 7, euphoria: 6, intensity: 8, bodyLoad: 7, egoDissolve: 8, visuals: 6 },
    flower: { petalCount: 8, petalShape: "wispy", primaryColor: "#64748b", secondaryColor: "#38bdf8", petalRadius: 34, centerSize: 15, stemHeight: 30 }
  },
  {
    id: "dxm", name: "DXM", category: "Dissociatives", subcategory: "Dissociatives",
    duration: { onset: 0.75, comeUp: 1.5, peak: 3, offset: 2, afterEffects: 6 },
    effects: { cognitiveComplexity: 7, euphoria: 5, intensity: 7, bodyLoad: 7, egoDissolve: 7, visuals: 5 },
    flower: { petalCount: 8, petalShape: "wispy", primaryColor: "#475569", secondaryColor: "#94a3b8", petalRadius: 30, centerSize: 13, stemHeight: 90 }
  },
  {
    id: "mdma", name: "MDMA", category: "Entactogens", subcategory: "Entactogens",
    duration: { onset: 0.5, comeUp: 0.5, peak: 2.5, offset: 1.5, afterEffects: 3 },
    effects: { cognitiveComplexity: 5, euphoria: 10, intensity: 9, bodyLoad: 6, egoDissolve: 4, visuals: 3 },
    flower: { petalCount: 6, petalShape: "rounded", primaryColor: "#f43f5e", secondaryColor: "#fbbf24", petalRadius: 38, centerSize: 8, stemHeight: 60 }
  },
  {
    id: "mda", name: "MDA", category: "Entactogens", subcategory: "Entactogens",
    duration: { onset: 0.5, comeUp: 1, peak: 3, offset: 2, afterEffects: 4 },
    effects: { cognitiveComplexity: 6, euphoria: 8, intensity: 8, bodyLoad: 7, egoDissolve: 5, visuals: 6 },
    flower: { petalCount: 7, petalShape: "rounded", primaryColor: "#e11d48", secondaryColor: "#fb923c", petalRadius: 34, centerSize: 10, stemHeight: 75 }
  },
  {
    id: "cannabis", name: "Cannabis", category: "Cannabinoids", subcategory: "Cannabinoids",
    duration: { onset: 0.17, comeUp: 0.33, peak: 1.5, offset: 1, afterEffects: 1 },
    effects: { cognitiveComplexity: 4, euphoria: 6, intensity: 4, bodyLoad: 3, egoDissolve: 1, visuals: 2 },
    flower: { petalCount: 5, petalShape: "rounded", primaryColor: "#22c55e", secondaryColor: "#86efac", petalRadius: 22, centerSize: 6, stemHeight: 35 }
  },
  {
    id: "jwh018", name: "JWH-018", category: "Cannabinoids", subcategory: "Cannabinoids",
    duration: { onset: 0.05, comeUp: 0.17, peak: 1, offset: 0.5, afterEffects: 1.5 },
    effects: { cognitiveComplexity: 5, euphoria: 5, intensity: 7, bodyLoad: 6, egoDissolve: 3, visuals: 3 },
    flower: { petalCount: 6, petalShape: "rounded", primaryColor: "#16a34a", secondaryColor: "#fde047", petalRadius: 30, centerSize: 7, stemHeight: 28 }
  },
  {
    id: "cocaine", name: "Cocaine", category: "Stimulants", subcategory: "Stimulants",
    duration: { onset: 0.03, comeUp: 0.08, peak: 0.5, offset: 0.33, afterEffects: 2 },
    effects: { cognitiveComplexity: 4, euphoria: 8, intensity: 7, bodyLoad: 5, egoDissolve: 0, visuals: 0 },
    flower: { petalCount: 5, petalShape: "pointed", primaryColor: "#f59e0b", secondaryColor: "#fef3c7", petalRadius: 30, centerSize: 5, stemHeight: 25 }
  },
  {
    id: "amphetamine", name: "Amphetamine", category: "Stimulants", subcategory: "Stimulants",
    duration: { onset: 0.33, comeUp: 0.5, peak: 3, offset: 2, afterEffects: 4 },
    effects: { cognitiveComplexity: 5, euphoria: 7, intensity: 7, bodyLoad: 5, egoDissolve: 0, visuals: 0 },
    flower: { petalCount: 6, petalShape: "pointed", primaryColor: "#ef4444", secondaryColor: "#fbbf24", petalRadius: 30, centerSize: 5, stemHeight: 72 }
  },
  {
    id: "morphine", name: "Morphine", category: "Depressants", subcategory: "Opioids",
    duration: { onset: 0.25, comeUp: 0.5, peak: 2, offset: 1.5, afterEffects: 2 },
    effects: { cognitiveComplexity: 3, euphoria: 9, intensity: 7, bodyLoad: 3, egoDissolve: 2, visuals: 0 },
    flower: { petalCount: 4, petalShape: "rounded", primaryColor: "#6366f1", secondaryColor: "#c4b5fd", petalRadius: 30, centerSize: 6, stemHeight: 50 }
  },
  {
    id: "codeine", name: "Codeine", category: "Depressants", subcategory: "Opioids",
    duration: { onset: 0.5, comeUp: 0.5, peak: 2, offset: 1.5, afterEffects: 1.5 },
    effects: { cognitiveComplexity: 2, euphoria: 5, intensity: 4, bodyLoad: 2, egoDissolve: 1, visuals: 0 },
    flower: { petalCount: 4, petalShape: "rounded", primaryColor: "#818cf8", secondaryColor: "#ddd6fe", petalRadius: 22, centerSize: 5, stemHeight: 48 }
  },
  {
    id: "alprazolam", name: "Alprazolam", category: "Depressants", subcategory: "Benzodiazepines",
    duration: { onset: 0.25, comeUp: 0.5, peak: 2, offset: 2, afterEffects: 4 },
    effects: { cognitiveComplexity: 2, euphoria: 4, intensity: 5, bodyLoad: 3, egoDissolve: 1, visuals: 0 },
    flower: { petalCount: 4, petalShape: "rounded", primaryColor: "#3b82f6", secondaryColor: "#93c5fd", petalRadius: 24, centerSize: 5, stemHeight: 65 }
  },
  {
    id: "diazepam", name: "Diazepam", category: "Depressants", subcategory: "Benzodiazepines",
    duration: { onset: 0.25, comeUp: 0.75, peak: 3, offset: 3, afterEffects: 8 },
    effects: { cognitiveComplexity: 2, euphoria: 3, intensity: 4, bodyLoad: 2, egoDissolve: 1, visuals: 0 },
    flower: { petalCount: 4, petalShape: "rounded", primaryColor: "#2563eb", secondaryColor: "#60a5fa", petalRadius: 22, centerSize: 5, stemHeight: 95 }
  },
  {
    id: "dph", name: "DPH (Diphenhydramine)", category: "Deliriants", subcategory: "Deliriants",
    duration: { onset: 0.75, comeUp: 1.5, peak: 3, offset: 2, afterEffects: 6 },
    effects: { cognitiveComplexity: 6, euphoria: 1, intensity: 7, bodyLoad: 8, egoDissolve: 5, visuals: 7 },
    flower: { petalCount: 7, petalShape: "wispy", primaryColor: "#44403c", secondaryColor: "#78716c", petalRadius: 30, centerSize: 10, stemHeight: 90 }
  },
  {
    id: "datura", name: "Datura", category: "Deliriants", subcategory: "Deliriants",
    duration: { onset: 1, comeUp: 2, peak: 8, offset: 6, afterEffects: 24 },
    effects: { cognitiveComplexity: 8, euphoria: 0, intensity: 10, bodyLoad: 10, egoDissolve: 9, visuals: 9 },
    flower: { petalCount: 9, petalShape: "wispy", primaryColor: "#1c1917", secondaryColor: "#57534e", petalRadius: 42, centerSize: 16, stemHeight: 95 }
  }
];

// ─── Extra drugs from PsychonautWiki API ───
const extraDrugs = [
{"id": "haloperidol", "name": "Haloperidol", "category": "Antipsychotics", "subcategory": "Substituted piperidines", "duration": {"onset": 0.75, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 23.25}, "effects": {"cognitiveComplexity": 3, "euphoria": 3, "intensity": 6, "bodyLoad": 4, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#d1d5db", "secondaryColor": "#9ca3af", "petalRadius": 36, "centerSize": 6, "stemHeight": 92}},
  {"id": "prochlorperazine", "name": "Prochlorperazine", "category": "Antipsychotics", "subcategory": "Phenothiazine", "duration": {"onset": 0.625, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 5.375}, "effects": {"cognitiveComplexity": 3, "euphoria": 3, "intensity": 6, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#d1d5db", "secondaryColor": "#9ca3af", "petalRadius": 36, "centerSize": 5, "stemHeight": 52}},
  {"id": "quetiapine", "name": "Quetiapine", "category": "Antipsychotics", "subcategory": "Dibenzothiazepine", "duration": {"onset": 0.5, "comeUp": 0, "peak": 3.75, "offset": 6.5, "afterEffects": 5.25}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 10, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#d1d5db", "secondaryColor": "#9ca3af", "petalRadius": 42, "centerSize": 5, "stemHeight": 92}},
  {"id": "risperidone", "name": "Risperidone", "category": "Antipsychotics", "subcategory": "Benzisoxazole", "duration": {"onset": 0.667, "comeUp": 0, "peak": 5.0, "offset": 3.0, "afterEffects": 7.333}, "effects": {"cognitiveComplexity": 3, "euphoria": 3, "intensity": 10, "bodyLoad": 4, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#6b7280", "secondaryColor": "#d1d5db", "petalRadius": 42, "centerSize": 5, "stemHeight": 92}},
  {"id": "5f_akb48", "name": "5F-AKB48", "category": "Cannabinoids", "subcategory": "Indazolecarboxamide", "duration": {"onset": 0.333, "comeUp": 0, "peak": 0.333, "offset": 0.125, "afterEffects": 0.198}, "effects": {"cognitiveComplexity": 3, "euphoria": 6, "intensity": 5, "bodyLoad": 4, "egoDissolve": 2, "visuals": 3}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#22c55e", "secondaryColor": "#16a34a", "petalRadius": 32, "centerSize": 6, "stemHeight": 29}},
  {"id": "ab_fubinaca", "name": "AB-FUBINACA", "category": "Cannabinoids", "subcategory": "Indazolecarboxamide", "duration": {"onset": 0.333, "comeUp": 0, "peak": 0.75, "offset": 0.25, "afterEffects": 0.167}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 7, "bodyLoad": 4, "egoDissolve": 2, "visuals": 2}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#4ade80", "secondaryColor": "#22c55e", "petalRadius": 40, "centerSize": 6, "stemHeight": 31}},
  {"id": "apica", "name": "APICA", "category": "Cannabinoids", "subcategory": "Indolecarboxamide", "duration": {"onset": 20.0, "comeUp": 0, "peak": 0.333, "offset": 0.125, "afterEffects": 5.115}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 7, "bodyLoad": 3, "egoDissolve": 2, "visuals": 3}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#22c55e", "secondaryColor": "#16a34a", "petalRadius": 35, "centerSize": 6, "stemHeight": 92}},
  {"id": "cannabidiol", "name": "Cannabidiol", "category": "Cannabinoids", "subcategory": "Cannabinoid", "duration": {"onset": 0, "comeUp": 0.375, "peak": 0, "offset": 1.25, "afterEffects": 1.125}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 3}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#4ade80", "secondaryColor": "#22c55e", "petalRadius": 37, "centerSize": 5, "stemHeight": 37}},
  {"id": "jwh_073", "name": "JWH-073", "category": "Cannabinoids", "subcategory": "Naphthoylindole", "duration": {"onset": 0.125, "comeUp": 0, "peak": 1.25, "offset": 0.125, "afterEffects": 0.375}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 8, "bodyLoad": 4, "egoDissolve": 2, "visuals": 3}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#86efac", "secondaryColor": "#4ade80", "petalRadius": 42, "centerSize": 6, "stemHeight": 33}},
  {"id": "sts_135", "name": "STS-135", "category": "Cannabinoids", "subcategory": "Indolecarboxamide", "duration": {"onset": 27.5, "comeUp": 0.458, "peak": 0.333, "offset": 0.125, "afterEffects": 7.104}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 5, "bodyLoad": 3, "egoDissolve": 1, "visuals": 2}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#86efac", "secondaryColor": "#4ade80", "petalRadius": 31, "centerSize": 5, "stemHeight": 92}},
  {"id": "thj_018", "name": "THJ-018", "category": "Cannabinoids", "subcategory": "Naphthoylindazole", "duration": {"onset": 0.125, "comeUp": 0, "peak": 1.25, "offset": 0.125, "afterEffects": 1.0}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 6, "bodyLoad": 4, "egoDissolve": 1, "visuals": 4}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#22c55e", "secondaryColor": "#16a34a", "petalRadius": 39, "centerSize": 5, "stemHeight": 36}},
  {"id": "thj_2201", "name": "THJ-2201", "category": "Cannabinoids", "subcategory": "Naphthoylindazole", "duration": {"onset": 0.125, "comeUp": 0, "peak": 0.625, "offset": 0, "afterEffects": 0.75}, "effects": {"cognitiveComplexity": 3, "euphoria": 6, "intensity": 7, "bodyLoad": 4, "egoDissolve": 2, "visuals": 3}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#22c55e", "secondaryColor": "#16a34a", "petalRadius": 40, "centerSize": 6, "stemHeight": 31}},
  {"id": "benzydamine", "name": "Benzydamine", "category": "Deliriants", "subcategory": "Indazole", "duration": {"onset": 0.667, "comeUp": 0, "peak": 4.5, "offset": 5.5, "afterEffects": 2.667}, "effects": {"cognitiveComplexity": 6, "euphoria": 2, "intensity": 10, "bodyLoad": 8, "egoDissolve": 6, "visuals": 7}, "flower": {"petalCount": 6, "petalShape": "wispy", "primaryColor": "#44403c", "secondaryColor": "#1c1917", "petalRadius": 42, "centerSize": 12, "stemHeight": 85}},
  {"id": "mirtazapine", "name": "Mirtazapine", "category": "Deliriants", "subcategory": "Piperazinoazepine", "duration": {"onset": 0.375, "comeUp": 0, "peak": 2.25, "offset": 4.0, "afterEffects": 12.375}, "effects": {"cognitiveComplexity": 6, "euphoria": 2, "intensity": 8, "bodyLoad": 9, "egoDissolve": 5, "visuals": 8}, "flower": {"petalCount": 7, "petalShape": "wispy", "primaryColor": "#1c1917", "secondaryColor": "#78716c", "petalRadius": 42, "centerSize": 11, "stemHeight": 92}},
  {"id": "promethazine", "name": "Promethazine", "category": "Deliriants", "subcategory": "Phenothiazine", "duration": {"onset": 0.75, "comeUp": 0.667, "peak": 1.5, "offset": 4.0, "afterEffects": 1.729}, "effects": {"cognitiveComplexity": 6, "euphoria": 2, "intensity": 6, "bodyLoad": 8, "egoDissolve": 6, "visuals": 7}, "flower": {"petalCount": 7, "petalShape": "wispy", "primaryColor": "#1c1917", "secondaryColor": "#78716c", "petalRadius": 34, "centerSize": 12, "stemHeight": 63}},
  {"id": "14_butanediol", "name": "1,4-Butanediol", "category": "Depressants", "subcategory": "Alkanediol", "duration": {"onset": 0.667, "comeUp": 0, "peak": 1.5, "offset": 1.75, "afterEffects": 0.083}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 8, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#2563eb", "secondaryColor": "#60a5fa", "petalRadius": 42, "centerSize": 5, "stemHeight": 43}},
  {"id": "2m2b", "name": "2M2B", "category": "Depressants", "subcategory": "Alcohol", "duration": {"onset": 0, "comeUp": 0, "peak": 7.0, "offset": 5.0, "afterEffects": 3.0}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 10, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#3b82f6", "secondaryColor": "#6366f1", "petalRadius": 42, "centerSize": 5, "stemHeight": 92}},
  {"id": "alcohol", "name": "Alcohol", "category": "Depressants", "subcategory": "Alcohol", "duration": {"onset": 0.058, "comeUp": 0.5, "peak": 1.0, "offset": 1.375, "afterEffects": 0.317}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#6366f1", "secondaryColor": "#818cf8", "petalRadius": 41, "centerSize": 5, "stemHeight": 39}},
  {"id": "baclofen", "name": "Baclofen", "category": "Depressants", "subcategory": "Butyric acid", "duration": {"onset": 0.875, "comeUp": 1.25, "peak": 1.5, "offset": 2.0, "afterEffects": 5.375}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 8, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#2563eb", "secondaryColor": "#60a5fa", "petalRadius": 42, "centerSize": 6, "stemHeight": 74}},
  {"id": "carisoprodol", "name": "Carisoprodol", "category": "Depressants", "subcategory": "1,3-Propanediol dicarbamate", "duration": {"onset": 0.625, "comeUp": 0, "peak": 3.5, "offset": 0, "afterEffects": 1.031}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 10, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#2563eb", "secondaryColor": "#60a5fa", "petalRadius": 42, "centerSize": 5, "stemHeight": 48}},
  {"id": "clonazepam", "name": "Clonazepam", "category": "Depressants", "subcategory": "Benzodiazepines", "duration": {"onset": 0.667, "comeUp": 0, "peak": 3.0, "offset": 4.5, "afterEffects": 1.833}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 9, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#60a5fa", "secondaryColor": "#93c5fd", "petalRadius": 41, "centerSize": 6, "stemHeight": 70}},
  {"id": "clonazolam", "name": "Clonazolam", "category": "Depressants", "subcategory": "Benzodiazepines", "duration": {"onset": 0.333, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 7.667}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 7, "bodyLoad": 4, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#3b82f6", "secondaryColor": "#6366f1", "petalRadius": 40, "centerSize": 6, "stemHeight": 61}},
  {"id": "clonidine", "name": "Clonidine", "category": "Depressants", "subcategory": "Imidazoline", "duration": {"onset": 0.5, "comeUp": 0, "peak": 1.25, "offset": 7.0, "afterEffects": 2.188}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 6, "bodyLoad": 4, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#3b82f6", "secondaryColor": "#6366f1", "petalRadius": 36, "centerSize": 6, "stemHeight": 74}},
  {"id": "deschloroetizolam", "name": "Deschloroetizolam", "category": "Depressants", "subcategory": "Thienodiazepines", "duration": {"onset": 0.375, "comeUp": 0.75, "peak": 3.5, "offset": 3.5, "afterEffects": 0.875}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 9, "bodyLoad": 3, "egoDissolve": 2, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#60a5fa", "secondaryColor": "#93c5fd", "petalRadius": 42, "centerSize": 6, "stemHeight": 65}},
  {"id": "diclazepam", "name": "Diclazepam", "category": "Depressants", "subcategory": "Benzodiazepines", "duration": {"onset": 0.458, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 9.542}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 5, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#3b82f6", "secondaryColor": "#6366f1", "petalRadius": 36, "centerSize": 6, "stemHeight": 70}},
  {"id": "etizolam", "name": "Etizolam", "category": "Depressants", "subcategory": "Thienodiazepines", "duration": {"onset": 0.375, "comeUp": 0.75, "peak": 2.5, "offset": 2.0, "afterEffects": 0.375}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 8, "bodyLoad": 3, "egoDissolve": 1, "visuals": 2}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#818cf8", "secondaryColor": "#2563eb", "petalRadius": 39, "centerSize": 5, "stemHeight": 52}},
  {"id": "f_phenibut", "name": "F-Phenibut", "category": "Depressants", "subcategory": "Gabapentinoids", "duration": {"onset": 0.667, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 6.333}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 5, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#818cf8", "secondaryColor": "#2563eb", "petalRadius": 36, "centerSize": 6, "stemHeight": 56}},
  {"id": "flubromazepam", "name": "Flubromazepam", "category": "Depressants", "subcategory": "Benzodiazepines", "duration": {"onset": 1.083, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 7.917}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 5, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#60a5fa", "secondaryColor": "#93c5fd", "petalRadius": 33, "centerSize": 6, "stemHeight": 65}},
  {"id": "flunitrazepam", "name": "Flunitrazepam", "category": "Depressants", "subcategory": "Benzodiazepines", "duration": {"onset": 0.417, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 5.583}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 6, "bodyLoad": 4, "egoDissolve": 2, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#2563eb", "secondaryColor": "#60a5fa", "petalRadius": 36, "centerSize": 6, "stemHeight": 52}},
  {"id": "flunitrazolam", "name": "Flunitrazolam", "category": "Depressants", "subcategory": "Benzodiazepines", "duration": {"onset": 0.5, "comeUp": 0, "peak": 1.5, "offset": 3.0, "afterEffects": 1.0}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 6, "bodyLoad": 4, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#6366f1", "secondaryColor": "#818cf8", "petalRadius": 36, "centerSize": 6, "stemHeight": 52}},
  {"id": "gbl", "name": "GBL", "category": "Depressants", "subcategory": "Lactone", "duration": {"onset": 0.108, "comeUp": 0.167, "peak": 0.625, "offset": 0.375, "afterEffects": 0.225}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 8, "bodyLoad": 4, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#6366f1", "secondaryColor": "#818cf8", "petalRadius": 37, "centerSize": 6, "stemHeight": 31}},
  {"id": "ghb", "name": "GHB", "category": "Depressants", "subcategory": "\u0393-Hydroxy acid", "duration": {"onset": 0.292, "comeUp": 0.25, "peak": 1.125, "offset": 0.375, "afterEffects": 0.51}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 6, "bodyLoad": 4, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#60a5fa", "secondaryColor": "#93c5fd", "petalRadius": 35, "centerSize": 5, "stemHeight": 36}},
  {"id": "gabapentin", "name": "Gabapentin", "category": "Depressants", "subcategory": "Gabapentinoids", "duration": {"onset": 1.25, "comeUp": 0, "peak": 2.5, "offset": 0, "afterEffects": 4.25}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#93c5fd", "secondaryColor": "#3b82f6", "petalRadius": 35, "centerSize": 5, "stemHeight": 61}},
  {"id": "mephenaqualone", "name": "Mephenaqualone", "category": "Depressants", "subcategory": "Quinazolinone", "duration": {"onset": 0.583, "comeUp": 0.125, "peak": 3.0, "offset": 12.5, "afterEffects": 1.292}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 10, "bodyLoad": 4, "egoDissolve": 2, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#60a5fa", "secondaryColor": "#93c5fd", "petalRadius": 42, "centerSize": 6, "stemHeight": 92}},
  {"id": "methaqualone", "name": "Methaqualone", "category": "Depressants", "subcategory": "Quinazolinone", "duration": {"onset": 0, "comeUp": 0, "peak": 3.0, "offset": 3.0, "afterEffects": 0.5}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 8, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#2563eb", "secondaryColor": "#60a5fa", "petalRadius": 41, "centerSize": 5, "stemHeight": 54}},
  {"id": "metizolam", "name": "Metizolam", "category": "Depressants", "subcategory": "Thienodiazepines", "duration": {"onset": 1.0, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 5.5}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#60a5fa", "secondaryColor": "#93c5fd", "petalRadius": 38, "centerSize": 5, "stemHeight": 54}},
  {"id": "midazolam", "name": "Midazolam", "category": "Depressants", "subcategory": "Benzodiazepines", "duration": {"onset": 0.75, "comeUp": 0.75, "peak": 1.5, "offset": 1.5, "afterEffects": 1.125}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#3b82f6", "secondaryColor": "#6366f1", "petalRadius": 39, "centerSize": 5, "stemHeight": 50}},
  {"id": "nicotine", "name": "Nicotine", "category": "Depressants", "subcategory": "Pyridine", "duration": {"onset": 0.5, "comeUp": 1.25, "peak": 1.25, "offset": 3.0, "afterEffects": 1.5}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 7, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#6366f1", "secondaryColor": "#818cf8", "petalRadius": 41, "centerSize": 6, "stemHeight": 58}},
  {"id": "nifoxipam", "name": "Nifoxipam", "category": "Depressants", "subcategory": "Benzodiazepines", "duration": {"onset": 1.375, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 24}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 6, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#818cf8", "secondaryColor": "#2563eb", "petalRadius": 34, "centerSize": 5, "stemHeight": 92}},
  {"id": "pentobarbital", "name": "Pentobarbital", "category": "Depressants", "subcategory": "Barbiturates", "duration": {"onset": 0.625, "comeUp": 0, "peak": 2.0, "offset": 1.5, "afterEffects": 0.875}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 8, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#6366f1", "secondaryColor": "#818cf8", "petalRadius": 38, "centerSize": 5, "stemHeight": 47}},
  {"id": "phenibut", "name": "Phenibut", "category": "Depressants", "subcategory": "Gabapentinoids", "duration": {"onset": 2.25, "comeUp": 2.25, "peak": 3.5, "offset": 5.0, "afterEffects": 3.25}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 10, "bodyLoad": 4, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#60a5fa", "secondaryColor": "#93c5fd", "petalRadius": 42, "centerSize": 6, "stemHeight": 92}},
  {"id": "phenobarbital", "name": "Phenobarbital", "category": "Depressants", "subcategory": "Barbiturates", "duration": {"onset": 0.625, "comeUp": 1.5, "peak": 5.0, "offset": 18.0, "afterEffects": 6.281}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 9, "bodyLoad": 4, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#6366f1", "secondaryColor": "#818cf8", "petalRadius": 40, "centerSize": 5, "stemHeight": 92}},
  {"id": "pregabalin", "name": "Pregabalin", "category": "Depressants", "subcategory": "Gabapentinoids", "duration": {"onset": 0.625, "comeUp": 1.5, "peak": 5.0, "offset": 6.0, "afterEffects": 3.281}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 10, "bodyLoad": 4, "egoDissolve": 2, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#3b82f6", "secondaryColor": "#6366f1", "petalRadius": 42, "centerSize": 6, "stemHeight": 92}},
  {"id": "progesterone", "name": "Progesterone", "category": "Depressants", "subcategory": "Steroid", "duration": {"onset": 0.75, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 2.25}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 6, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#60a5fa", "secondaryColor": "#93c5fd", "petalRadius": 35, "centerSize": 5, "stemHeight": 38}},
  {"id": "pyrazolam", "name": "Pyrazolam", "category": "Depressants", "subcategory": "Benzodiazepines", "duration": {"onset": 0.208, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 6.292}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 6, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#6366f1", "secondaryColor": "#818cf8", "petalRadius": 38, "centerSize": 5, "stemHeight": 54}},
  {"id": "secobarbital", "name": "Secobarbital", "category": "Depressants", "subcategory": "Barbiturates", "duration": {"onset": 0.625, "comeUp": 0, "peak": 6.0, "offset": 3.0, "afterEffects": 2.406}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 10, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#3b82f6", "secondaryColor": "#6366f1", "petalRadius": 42, "centerSize": 5, "stemHeight": 79}},
  {"id": "temazepam", "name": "Temazepam", "category": "Depressants", "subcategory": "Benzodiazepines", "duration": {"onset": 0.75, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 6.75}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 6, "bodyLoad": 4, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#93c5fd", "secondaryColor": "#3b82f6", "petalRadius": 37, "centerSize": 5, "stemHeight": 58}},
  {"id": "tizanidine", "name": "Tizanidine", "category": "Depressants", "subcategory": "Imidazoline", "duration": {"onset": 0.5, "comeUp": 0, "peak": 1.5, "offset": 0, "afterEffects": 2.0}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 7, "bodyLoad": 4, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#818cf8", "secondaryColor": "#2563eb", "petalRadius": 41, "centerSize": 5, "stemHeight": 43}},
  {"id": "3_ho_pcp", "name": "3-HO-PCP", "category": "Dissociatives", "subcategory": "Arylcyclohexylamines", "duration": {"onset": 0, "comeUp": 1.25, "peak": 0, "offset": 0, "afterEffects": 3.75}, "effects": {"cognitiveComplexity": 7, "euphoria": 2, "intensity": 5, "bodyLoad": 7, "egoDissolve": 7, "visuals": 5}, "flower": {"petalCount": 8, "petalShape": "wispy", "primaryColor": "#64748b", "secondaryColor": "#475569", "petalRadius": 34, "centerSize": 13, "stemHeight": 47}},
  {"id": "3_meo_pce", "name": "3-MeO-PCE", "category": "Dissociatives", "subcategory": "Arylcyclohexylamines", "duration": {"onset": 1.0, "comeUp": 1.5, "peak": 2.5, "offset": 1.5, "afterEffects": 1.625}, "effects": {"cognitiveComplexity": 7, "euphoria": 3, "intensity": 8, "bodyLoad": 6, "egoDissolve": 7, "visuals": 4}, "flower": {"petalCount": 7, "petalShape": "wispy", "primaryColor": "#475569", "secondaryColor": "#94a3b8", "petalRadius": 42, "centerSize": 13, "stemHeight": 61}},
  {"id": "3_meo_pcmo", "name": "3-MeO-PCMo", "category": "Dissociatives", "subcategory": "Arylcyclohexylamines", "duration": {"onset": 1.5, "comeUp": 0, "peak": 2.5, "offset": 1.5, "afterEffects": 1.375}, "effects": {"cognitiveComplexity": 7, "euphoria": 3, "intensity": 8, "bodyLoad": 6, "egoDissolve": 7, "visuals": 4}, "flower": {"petalCount": 7, "petalShape": "wispy", "primaryColor": "#38bdf8", "secondaryColor": "#334155", "petalRadius": 38, "centerSize": 13, "stemHeight": 55}},
  {"id": "3_meo_pcp", "name": "3-MeO-PCP", "category": "Dissociatives", "subcategory": "Arylcyclohexylamines", "duration": {"onset": 1.0, "comeUp": 1.375, "peak": 2.5, "offset": 1.5, "afterEffects": 1.594}, "effects": {"cognitiveComplexity": 7, "euphoria": 2, "intensity": 8, "bodyLoad": 6, "egoDissolve": 7, "visuals": 4}, "flower": {"petalCount": 7, "petalShape": "wispy", "primaryColor": "#64748b", "secondaryColor": "#475569", "petalRadius": 39, "centerSize": 13, "stemHeight": 60}},
  {"id": "4_meo_pcp", "name": "4-MeO-PCP", "category": "Dissociatives", "subcategory": "Arylcyclohexylamines", "duration": {"onset": 1.375, "comeUp": 1.5, "peak": 5.0, "offset": 8.0, "afterEffects": 0.125}, "effects": {"cognitiveComplexity": 7, "euphoria": 2, "intensity": 10, "bodyLoad": 7, "egoDissolve": 7, "visuals": 5}, "flower": {"petalCount": 8, "petalShape": "wispy", "primaryColor": "#38bdf8", "secondaryColor": "#334155", "petalRadius": 42, "centerSize": 13, "stemHeight": 92}},
  {"id": "diphenidine", "name": "Diphenidine", "category": "Dissociatives", "subcategory": "Diarylethylamines", "duration": {"onset": 0.375, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 3.125}, "effects": {"cognitiveComplexity": 7, "euphoria": 2, "intensity": 5, "bodyLoad": 6, "egoDissolve": 7, "visuals": 5}, "flower": {"petalCount": 8, "petalShape": "wispy", "primaryColor": "#94a3b8", "secondaryColor": "#38bdf8", "petalRadius": 31, "centerSize": 13, "stemHeight": 40}},
  {"id": "ephenidine", "name": "Ephenidine", "category": "Dissociatives", "subcategory": "Diarylethylamines", "duration": {"onset": 0.333, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 5.667}, "effects": {"cognitiveComplexity": 7, "euphoria": 2, "intensity": 6, "bodyLoad": 6, "egoDissolve": 7, "visuals": 4}, "flower": {"petalCount": 8, "petalShape": "wispy", "primaryColor": "#64748b", "secondaryColor": "#475569", "petalRadius": 33, "centerSize": 13, "stemHeight": 52}},
  {"id": "hxe", "name": "HXE", "category": "Dissociatives", "subcategory": "Arylcyclohexylamines", "duration": {"onset": 0.667, "comeUp": 0.75, "peak": 3.0, "offset": 4.5, "afterEffects": 2.229}, "effects": {"cognitiveComplexity": 7, "euphoria": 3, "intensity": 7, "bodyLoad": 7, "egoDissolve": 7, "visuals": 4}, "flower": {"petalCount": 8, "petalShape": "wispy", "primaryColor": "#475569", "secondaryColor": "#94a3b8", "petalRadius": 37, "centerSize": 13, "stemHeight": 75}},
  {"id": "mxipr", "name": "MXiPr", "category": "Dissociatives", "subcategory": "Arylcyclohexylamines", "duration": {"onset": 0.667, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 2.833}, "effects": {"cognitiveComplexity": 7, "euphoria": 2, "intensity": 7, "bodyLoad": 6, "egoDissolve": 7, "visuals": 6}, "flower": {"petalCount": 7, "petalShape": "wispy", "primaryColor": "#38bdf8", "secondaryColor": "#334155", "petalRadius": 41, "centerSize": 13, "stemHeight": 40}},
  {"id": "memantine", "name": "Memantine", "category": "Dissociatives", "subcategory": "Adamantanes", "duration": {"onset": 1.75, "comeUp": 2.5, "peak": 7.5, "offset": 14.5, "afterEffects": 0.75}, "effects": {"cognitiveComplexity": 7, "euphoria": 2, "intensity": 10, "bodyLoad": 6, "egoDissolve": 8, "visuals": 4}, "flower": {"petalCount": 7, "petalShape": "wispy", "primaryColor": "#38bdf8", "secondaryColor": "#334155", "petalRadius": 42, "centerSize": 15, "stemHeight": 92}},
  {"id": "methoxetamine", "name": "Methoxetamine", "category": "Dissociatives", "subcategory": "Arylcyclohexylamines", "duration": {"onset": 0.375, "comeUp": 1.125, "peak": 2.0, "offset": 1.25, "afterEffects": 0.25}, "effects": {"cognitiveComplexity": 7, "euphoria": 2, "intensity": 8, "bodyLoad": 7, "egoDissolve": 7, "visuals": 4}, "flower": {"petalCount": 7, "petalShape": "wispy", "primaryColor": "#64748b", "secondaryColor": "#475569", "petalRadius": 42, "centerSize": 13, "stemHeight": 47}},
  {"id": "methoxphenidine", "name": "Methoxphenidine", "category": "Dissociatives", "subcategory": "Diarylethylamines", "duration": {"onset": 0.75, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 6.25}, "effects": {"cognitiveComplexity": 7, "euphoria": 2, "intensity": 7, "bodyLoad": 7, "egoDissolve": 7, "visuals": 6}, "flower": {"petalCount": 7, "petalShape": "wispy", "primaryColor": "#64748b", "secondaryColor": "#475569", "petalRadius": 36, "centerSize": 13, "stemHeight": 56}},
  {"id": "nitrous", "name": "Nitrous", "category": "Dissociatives", "subcategory": "Dissociatives", "duration": {"onset": 7.5, "comeUp": 7.5, "peak": 22.5, "offset": 0.05, "afterEffects": 9.387}, "effects": {"cognitiveComplexity": 7, "euphoria": 3, "intensity": 10, "bodyLoad": 6, "egoDissolve": 8, "visuals": 5}, "flower": {"petalCount": 7, "petalShape": "wispy", "primaryColor": "#475569", "secondaryColor": "#94a3b8", "petalRadius": 42, "centerSize": 15, "stemHeight": 92}},
  {"id": "o_pce", "name": "O-PCE", "category": "Dissociatives", "subcategory": "Arylcyclohexylamines", "duration": {"onset": 0.5, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 4.0}, "effects": {"cognitiveComplexity": 7, "euphoria": 3, "intensity": 7, "bodyLoad": 6, "egoDissolve": 7, "visuals": 6}, "flower": {"petalCount": 7, "petalShape": "wispy", "primaryColor": "#64748b", "secondaryColor": "#475569", "petalRadius": 38, "centerSize": 13, "stemHeight": 45}},
  {"id": "pce", "name": "PCE", "category": "Dissociatives", "subcategory": "Arylcyclohexylamines", "duration": {"onset": 1.0, "comeUp": 1.333, "peak": 2.5, "offset": 1.5, "afterEffects": 1.583}, "effects": {"cognitiveComplexity": 7, "euphoria": 3, "intensity": 8, "bodyLoad": 6, "egoDissolve": 7, "visuals": 5}, "flower": {"petalCount": 7, "petalShape": "wispy", "primaryColor": "#94a3b8", "secondaryColor": "#38bdf8", "petalRadius": 41, "centerSize": 13, "stemHeight": 60}},
  {"id": "pcp", "name": "PCP", "category": "Dissociatives", "subcategory": "Arylcyclohexylamines", "duration": {"onset": 1.0, "comeUp": 1.333, "peak": 2.5, "offset": 1.5, "afterEffects": 1.583}, "effects": {"cognitiveComplexity": 7, "euphoria": 3, "intensity": 8, "bodyLoad": 6, "egoDissolve": 8, "visuals": 4}, "flower": {"petalCount": 7, "petalShape": "wispy", "primaryColor": "#38bdf8", "secondaryColor": "#334155", "petalRadius": 41, "centerSize": 15, "stemHeight": 60}},
  {"id": "rolicyclidine", "name": "Rolicyclidine", "category": "Dissociatives", "subcategory": "Arylcyclohexylamines", "duration": {"onset": 0.917, "comeUp": 1.25, "peak": 2.5, "offset": 3.5, "afterEffects": 0.833}, "effects": {"cognitiveComplexity": 7, "euphoria": 2, "intensity": 9, "bodyLoad": 7, "egoDissolve": 7, "visuals": 6}, "flower": {"petalCount": 7, "petalShape": "wispy", "primaryColor": "#94a3b8", "secondaryColor": "#38bdf8", "petalRadius": 42, "centerSize": 13, "stemHeight": 65}},
  {"id": "2_fea", "name": "2-FEA", "category": "Entactogens", "subcategory": "Substituted amphetamines", "duration": {"onset": 0.167, "comeUp": 0.125, "peak": 0.75, "offset": 0.75, "afterEffects": 0.448}, "effects": {"cognitiveComplexity": 5, "euphoria": 9, "intensity": 8, "bodyLoad": 5, "egoDissolve": 4, "visuals": 1}, "flower": {"petalCount": 5, "petalShape": "rounded", "primaryColor": "#fb7185", "secondaryColor": "#fb923c", "petalRadius": 38, "centerSize": 9, "stemHeight": 35}},
  {"id": "3_fea", "name": "3-FEA", "category": "Entactogens", "subcategory": "Amphetamine", "duration": {"onset": 0.667, "comeUp": 0.75, "peak": 2.0, "offset": 2.5, "afterEffects": 1.479}, "effects": {"cognitiveComplexity": 5, "euphoria": 9, "intensity": 7, "bodyLoad": 5, "egoDissolve": 4, "visuals": 2}, "flower": {"petalCount": 5, "petalShape": "rounded", "primaryColor": "#fb7185", "secondaryColor": "#fb923c", "petalRadius": 35, "centerSize": 9, "stemHeight": 58}},
  {"id": "3_fma", "name": "3-FMA", "category": "Entactogens", "subcategory": "Amphetamine", "duration": {"onset": 0.667, "comeUp": 0.75, "peak": 3.0, "offset": 2.0, "afterEffects": 1.604}, "effects": {"cognitiveComplexity": 5, "euphoria": 9, "intensity": 10, "bodyLoad": 5, "egoDissolve": 4, "visuals": 3}, "flower": {"petalCount": 5, "petalShape": "rounded", "primaryColor": "#fb923c", "secondaryColor": "#fbbf24", "petalRadius": 42, "centerSize": 9, "stemHeight": 61}},
  {"id": "3_mmc", "name": "3-MMC", "category": "Entactogens", "subcategory": "Cathinone", "duration": {"onset": 0.333, "comeUp": 0.75, "peak": 2.5, "offset": 1.25, "afterEffects": 0.167}, "effects": {"cognitiveComplexity": 5, "euphoria": 8, "intensity": 8, "bodyLoad": 6, "egoDissolve": 3, "visuals": 2}, "flower": {"petalCount": 5, "petalShape": "rounded", "primaryColor": "#fb923c", "secondaryColor": "#fbbf24", "petalRadius": 42, "centerSize": 8, "stemHeight": 47}},
  {"id": "4_fa", "name": "4-FA", "category": "Entactogens", "subcategory": "Substituted amphetamines", "duration": {"onset": 1.0, "comeUp": 0.875, "peak": 3.0, "offset": 2.5, "afterEffects": 1.844}, "effects": {"cognitiveComplexity": 5, "euphoria": 9, "intensity": 7, "bodyLoad": 5, "egoDissolve": 4, "visuals": 1}, "flower": {"petalCount": 5, "petalShape": "rounded", "primaryColor": "#e11d48", "secondaryColor": "#fb7185", "petalRadius": 39, "centerSize": 9, "stemHeight": 66}},
  {"id": "4_fma", "name": "4-FMA", "category": "Entactogens", "subcategory": "Substituted amphetamines", "duration": {"onset": 0.5, "comeUp": 0.5, "peak": 3.5, "offset": 1.5, "afterEffects": 1.5}, "effects": {"cognitiveComplexity": 5, "euphoria": 8, "intensity": 10, "bodyLoad": 7, "egoDissolve": 3, "visuals": 2}, "flower": {"petalCount": 6, "petalShape": "rounded", "primaryColor": "#fb923c", "secondaryColor": "#fbbf24", "petalRadius": 42, "centerSize": 8, "stemHeight": 58}},
  {"id": "5_apb", "name": "5-APB", "category": "Entactogens", "subcategory": "Substituted amphetamines", "duration": {"onset": 0.667, "comeUp": 1.125, "peak": 3.0, "offset": 2.25, "afterEffects": 1.76}, "effects": {"cognitiveComplexity": 5, "euphoria": 9, "intensity": 10, "bodyLoad": 5, "egoDissolve": 3, "visuals": 2}, "flower": {"petalCount": 5, "petalShape": "rounded", "primaryColor": "#f43f5e", "secondaryColor": "#e11d48", "petalRadius": 42, "centerSize": 8, "stemHeight": 64}},
  {"id": "5_mapb", "name": "5-MAPB", "category": "Entactogens", "subcategory": "Substituted amphetamines", "duration": {"onset": 0.667, "comeUp": 1.125, "peak": 3.0, "offset": 2.25, "afterEffects": 1.76}, "effects": {"cognitiveComplexity": 5, "euphoria": 9, "intensity": 8, "bodyLoad": 5, "egoDissolve": 3, "visuals": 2}, "flower": {"petalCount": 6, "petalShape": "rounded", "primaryColor": "#e11d48", "secondaryColor": "#fb7185", "petalRadius": 40, "centerSize": 8, "stemHeight": 64}},
  {"id": "6_apdb", "name": "6-APDB", "category": "Entactogens", "subcategory": "Substituted amphetamines", "duration": {"onset": 0.75, "comeUp": 0.75, "peak": 2.5, "offset": 2.5, "afterEffects": 0.5}, "effects": {"cognitiveComplexity": 5, "euphoria": 8, "intensity": 8, "bodyLoad": 5, "egoDissolve": 3, "visuals": 3}, "flower": {"petalCount": 5, "petalShape": "rounded", "primaryColor": "#f43f5e", "secondaryColor": "#e11d48", "petalRadius": 42, "centerSize": 8, "stemHeight": 56}},
  {"id": "butylone", "name": "Butylone", "category": "Entactogens", "subcategory": "MDxx", "duration": {"onset": 0.625, "comeUp": 0, "peak": 1.5, "offset": 1.5, "afterEffects": 0.375}, "effects": {"cognitiveComplexity": 5, "euphoria": 9, "intensity": 7, "bodyLoad": 5, "egoDissolve": 4, "visuals": 3}, "flower": {"petalCount": 6, "petalShape": "rounded", "primaryColor": "#fb7185", "secondaryColor": "#fb923c", "petalRadius": 37, "centerSize": 9, "stemHeight": 43}},
  {"id": "ephylone", "name": "Ephylone", "category": "Entactogens", "subcategory": "Cathinone", "duration": {"onset": 0.375, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 5.625}, "effects": {"cognitiveComplexity": 5, "euphoria": 8, "intensity": 7, "bodyLoad": 6, "egoDissolve": 4, "visuals": 3}, "flower": {"petalCount": 5, "petalShape": "rounded", "primaryColor": "#fb923c", "secondaryColor": "#fbbf24", "petalRadius": 37, "centerSize": 9, "stemHeight": 52}},
  {"id": "mdea", "name": "MDEA", "category": "Entactogens", "subcategory": "Amphetamine", "duration": {"onset": 0.667, "comeUp": 0.375, "peak": 1.75, "offset": 1.5, "afterEffects": 0.208}, "effects": {"cognitiveComplexity": 5, "euphoria": 8, "intensity": 7, "bodyLoad": 6, "egoDissolve": 4, "visuals": 2}, "flower": {"petalCount": 5, "petalShape": "rounded", "primaryColor": "#fb923c", "secondaryColor": "#fbbf24", "petalRadius": 36, "centerSize": 9, "stemHeight": 45}},
  {"id": "mdpv", "name": "MDPV", "category": "Entactogens", "subcategory": "MDxx", "duration": {"onset": 0.375, "comeUp": 0, "peak": 2.5, "offset": 1.25, "afterEffects": 0.375}, "effects": {"cognitiveComplexity": 5, "euphoria": 9, "intensity": 9, "bodyLoad": 6, "egoDissolve": 3, "visuals": 1}, "flower": {"petalCount": 5, "petalShape": "rounded", "primaryColor": "#e11d48", "secondaryColor": "#fb7185", "petalRadius": 42, "centerSize": 8, "stemHeight": 45}},
  {"id": "mephedrone", "name": "Mephedrone", "category": "Entactogens", "subcategory": "Cathinone", "duration": {"onset": 0.5, "comeUp": 0.375, "peak": 3.0, "offset": 1.125, "afterEffects": 1.25}, "effects": {"cognitiveComplexity": 5, "euphoria": 9, "intensity": 7, "bodyLoad": 5, "egoDissolve": 3, "visuals": 2}, "flower": {"petalCount": 5, "petalShape": "rounded", "primaryColor": "#e11d48", "secondaryColor": "#fb7185", "petalRadius": 36, "centerSize": 8, "stemHeight": 53}},
  {"id": "methylone", "name": "Methylone", "category": "Entactogens", "subcategory": "Cathinone", "duration": {"onset": 0.5, "comeUp": 0.5, "peak": 1.25, "offset": 1.25, "afterEffects": 0.875}, "effects": {"cognitiveComplexity": 5, "euphoria": 9, "intensity": 6, "bodyLoad": 6, "egoDissolve": 4, "visuals": 3}, "flower": {"petalCount": 6, "petalShape": "rounded", "primaryColor": "#f43f5e", "secondaryColor": "#e11d48", "petalRadius": 38, "centerSize": 9, "stemHeight": 44}},
  {"id": "eszopiclone", "name": "Eszopiclone", "category": "Hallucinogens", "subcategory": "Cyclopyrrolone", "duration": {"onset": 0.25, "comeUp": 0, "peak": 1.0, "offset": 0, "afterEffects": 5.75}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 6, "bodyLoad": 3, "egoDissolve": 2, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "wavy", "primaryColor": "#d946ef", "secondaryColor": "#a855f7", "petalRadius": 35, "centerSize": 6, "stemHeight": 56}},
  {"id": "gaboxadol", "name": "Gaboxadol", "category": "Hallucinogens", "subcategory": "3-hydroxyisoxazole", "duration": {"onset": 0.625, "comeUp": 0, "peak": 1.5, "offset": 0.033, "afterEffects": 0.54}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "wavy", "primaryColor": "#d946ef", "secondaryColor": "#a855f7", "petalRadius": 39, "centerSize": 5, "stemHeight": 37}},
  {"id": "salvinorin_a", "name": "Salvinorin A", "category": "Hallucinogens", "subcategory": "Salvinorin", "duration": {"onset": 37.5, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 9.375}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 5, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "wavy", "primaryColor": "#c084fc", "secondaryColor": "#d946ef", "petalRadius": 34, "centerSize": 6, "stemHeight": 92}},
  {"id": "zolpidem", "name": "Zolpidem", "category": "Hallucinogens", "subcategory": "Imidazopyridine", "duration": {"onset": 0.5, "comeUp": 0.625, "peak": 4.5, "offset": 4.5, "afterEffects": 2.531}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 10, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "wavy", "primaryColor": "#c084fc", "secondaryColor": "#d946ef", "petalRadius": 42, "centerSize": 5, "stemHeight": 81}},
  {"id": "zopiclone", "name": "Zopiclone", "category": "Hallucinogens", "subcategory": "Cyclopyrrolone", "duration": {"onset": 0.333, "comeUp": 0, "peak": 3.5, "offset": 0, "afterEffects": 2.417}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 9, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "wavy", "primaryColor": "#a855f7", "secondaryColor": "#c084fc", "petalRadius": 40, "centerSize": 5, "stemHeight": 53}},
  {"id": "alpha_gpc", "name": "Alpha-GPC", "category": "Nootropics", "subcategory": "Choline derivative", "duration": {"onset": 1.0, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 5.0}, "effects": {"cognitiveComplexity": 3, "euphoria": 3, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#67e8f9", "secondaryColor": "#0891b2", "petalRadius": 39, "centerSize": 5, "stemHeight": 52}},
  {"id": "aniracetam", "name": "Aniracetam", "category": "Nootropics", "subcategory": "Racetams", "duration": {"onset": 1.125, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 2.875}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 6, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#0891b2", "secondaryColor": "#06b6d4", "petalRadius": 38, "centerSize": 6, "stemHeight": 43}},
  {"id": "choline_bitartrate", "name": "Choline bitartrate", "category": "Nootropics", "subcategory": "Ammonium salt", "duration": {"onset": 1.0, "comeUp": 0.375, "peak": 3.0, "offset": 1.5, "afterEffects": 0.125}, "effects": {"cognitiveComplexity": 3, "euphoria": 3, "intensity": 9, "bodyLoad": 4, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#0891b2", "secondaryColor": "#06b6d4", "petalRadius": 40, "centerSize": 5, "stemHeight": 52}},
  {"id": "coluracetam", "name": "Coluracetam", "category": "Nootropics", "subcategory": "Racetams", "duration": {"onset": 0.375, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 4.125}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 5, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#0891b2", "secondaryColor": "#06b6d4", "petalRadius": 35, "centerSize": 6, "stemHeight": 45}},
  {"id": "creatine", "name": "Creatine", "category": "Nootropics", "subcategory": "Nootropics", "duration": {"onset": 1.0, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 24}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#06b6d4", "secondaryColor": "#22d3ee", "petalRadius": 36, "centerSize": 5, "stemHeight": 92}},
  {"id": "n_acetylcysteine", "name": "N-Acetylcysteine", "category": "Nootropics", "subcategory": "Cysteine", "duration": {"onset": 0.667, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 3.833}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 5, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#06b6d4", "secondaryColor": "#22d3ee", "petalRadius": 31, "centerSize": 5, "stemHeight": 45}},
  {"id": "omberacetam", "name": "Omberacetam", "category": "Nootropics", "subcategory": "Peptide", "duration": {"onset": 0.083, "comeUp": 0, "peak": 2.0, "offset": 3.0, "afterEffects": 1.271}, "effects": {"cognitiveComplexity": 3, "euphoria": 3, "intensity": 8, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#22d3ee", "secondaryColor": "#67e8f9", "petalRadius": 39, "centerSize": 5, "stemHeight": 53}},
  {"id": "piracetam", "name": "Piracetam", "category": "Nootropics", "subcategory": "Racetams", "duration": {"onset": 1.0, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 5.0}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 6, "bodyLoad": 4, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#22d3ee", "secondaryColor": "#67e8f9", "petalRadius": 34, "centerSize": 5, "stemHeight": 52}},
  {"id": "pramiracetam", "name": "Pramiracetam", "category": "Nootropics", "subcategory": "Racetams", "duration": {"onset": 1.0, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 4.5}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 6, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#67e8f9", "secondaryColor": "#0891b2", "petalRadius": 36, "centerSize": 5, "stemHeight": 49}},
  {"id": "sam_e", "name": "SAM-e", "category": "Nootropics", "subcategory": "Nitrogenous organic acid", "duration": {"onset": 2.333, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 0.583}, "effects": {"cognitiveComplexity": 3, "euphoria": 3, "intensity": 6, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#06b6d4", "secondaryColor": "#22d3ee", "petalRadius": 34, "centerSize": 5, "stemHeight": 38}},
  {"id": "theanine", "name": "Theanine", "category": "Nootropics", "subcategory": "Nootropics", "duration": {"onset": 1.0, "comeUp": 0, "peak": 2.0, "offset": 0, "afterEffects": 1.5}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 9, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#06b6d4", "secondaryColor": "#22d3ee", "petalRadius": 40, "centerSize": 5, "stemHeight": 45}},
  {"id": "tianeptine", "name": "Tianeptine", "category": "Nootropics", "subcategory": "Dibenzothiazepine", "duration": {"onset": 0.75, "comeUp": 0.375, "peak": 1.25, "offset": 0.75, "afterEffects": 0.781}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 6, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#67e8f9", "secondaryColor": "#0891b2", "petalRadius": 33, "centerSize": 5, "stemHeight": 42}},
  {"id": "galantamine", "name": "Galantamine", "category": "Oneirogens", "subcategory": "Benzazepine", "duration": {"onset": 0.667, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 8.333}, "effects": {"cognitiveComplexity": 3, "euphoria": 2, "intensity": 6, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#7c3aed", "petalRadius": 37, "centerSize": 5, "stemHeight": 65}},
  {"id": "melatonin", "name": "Melatonin", "category": "Oneirogens", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.208, "comeUp": 0.75, "peak": 1.5, "offset": 2.5, "afterEffects": 1.24}, "effects": {"cognitiveComplexity": 3, "euphoria": 3, "intensity": 8, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "wavy", "primaryColor": "#7c3aed", "secondaryColor": "#8b5cf6", "petalRadius": 41, "centerSize": 5, "stemHeight": 52}},
  {"id": "acetylfentanyl", "name": "Acetylfentanyl", "category": "Opioids", "subcategory": "Anilidopiperidine", "duration": {"onset": 0.142, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 3.358}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 5, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#a78bfa", "secondaryColor": "#c4b5fd", "petalRadius": 33, "centerSize": 5, "stemHeight": 40}},
  {"id": "buprenorphine", "name": "Buprenorphine", "category": "Opioids", "subcategory": "Substituted morphinans", "duration": {"onset": 0.75, "comeUp": 0, "peak": 6.0, "offset": 0, "afterEffects": 4.25}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 10, "bodyLoad": 4, "egoDissolve": 3, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#4f46e5", "secondaryColor": "#6366f1", "petalRadius": 42, "centerSize": 8, "stemHeight": 74}},
  {"id": "dextropropoxyphene", "name": "Dextropropoxyphene", "category": "Opioids", "subcategory": "Phenylpropylamine", "duration": {"onset": 0.417, "comeUp": 0, "peak": 2.5, "offset": 0, "afterEffects": 0.729}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#6366f1", "secondaryColor": "#818cf8", "petalRadius": 40, "centerSize": 5, "stemHeight": 41}},
  {"id": "fentanyl", "name": "Fentanyl", "category": "Opioids", "subcategory": "Anilidopiperidine", "duration": {"onset": 0.375, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 2.125}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 5, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#4f46e5", "secondaryColor": "#6366f1", "petalRadius": 35, "centerSize": 6, "stemHeight": 36}},
  {"id": "hydrocodone", "name": "Hydrocodone", "category": "Opioids", "subcategory": "Substituted morphinans", "duration": {"onset": 0.583, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 5.417}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 5, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#c4b5fd", "secondaryColor": "#4f46e5", "petalRadius": 32, "centerSize": 5, "stemHeight": 52}},
  {"id": "hydromorphone", "name": "Hydromorphone", "category": "Opioids", "subcategory": "Substituted morphinans", "duration": {"onset": 0.167, "comeUp": 1.5, "peak": 0.292, "offset": 0.75, "afterEffects": 2.292}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 7, "bodyLoad": 3, "egoDissolve": 2, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#a78bfa", "secondaryColor": "#c4b5fd", "petalRadius": 38, "centerSize": 6, "stemHeight": 47}},
  {"id": "methadone", "name": "Methadone", "category": "Opioids", "subcategory": "Diphenylpropylamine", "duration": {"onset": 0.917, "comeUp": 3.0, "peak": 5.0, "offset": 5.0, "afterEffects": 0.583}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 10, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#818cf8", "secondaryColor": "#a78bfa", "petalRadius": 42, "centerSize": 5, "stemHeight": 90}},
  {"id": "naloxone", "name": "Naloxone", "category": "Opioids", "subcategory": "Substituted morphinans", "duration": {"onset": 0.167, "comeUp": 0.5, "peak": 1.5, "offset": 0.75, "afterEffects": 0.729}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 6, "bodyLoad": 3, "egoDissolve": 2, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#818cf8", "secondaryColor": "#a78bfa", "petalRadius": 34, "centerSize": 6, "stemHeight": 41}},
  {"id": "o_desmethyltramadol", "name": "O-Desmethyltramadol", "category": "Opioids", "subcategory": "Phenylpropylamine", "duration": {"onset": 0.5, "comeUp": 0.583, "peak": 3.5, "offset": 3.0, "afterEffects": 0.417}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 9, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#6366f1", "secondaryColor": "#818cf8", "petalRadius": 42, "centerSize": 6, "stemHeight": 61}},
  {"id": "oxycodone", "name": "Oxycodone", "category": "Opioids", "subcategory": "Substituted morphinans", "duration": {"onset": 0.333, "comeUp": 1.5, "peak": 1.5, "offset": 2.0, "afterEffects": 0.667}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 7, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#c4b5fd", "secondaryColor": "#4f46e5", "petalRadius": 37, "centerSize": 6, "stemHeight": 52}},
  {"id": "oxymorphone", "name": "Oxymorphone", "category": "Opioids", "subcategory": "Substituted morphinans", "duration": {"onset": 0.542, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 4.458}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 7, "bodyLoad": 4, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#6366f1", "secondaryColor": "#818cf8", "petalRadius": 36, "centerSize": 6, "stemHeight": 47}},
  {"id": "pethidine", "name": "Pethidine", "category": "Opioids", "subcategory": "Substituted piperidines", "duration": {"onset": 0.75, "comeUp": 0, "peak": 5.0, "offset": 0, "afterEffects": 1.438}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 9, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#4f46e5", "secondaryColor": "#6366f1", "petalRadius": 40, "centerSize": 5, "stemHeight": 57}},
  {"id": "sufentanil", "name": "Sufentanil", "category": "Opioids", "subcategory": "Anilidopiperidine", "duration": {"onset": 0.025, "comeUp": 0, "peak": 0.125, "offset": 0, "afterEffects": 0.037}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 7, "bodyLoad": 5, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#c4b5fd", "secondaryColor": "#4f46e5", "petalRadius": 36, "centerSize": 5, "stemHeight": 25}},
  {"id": "tapentadol", "name": "Tapentadol", "category": "Opioids", "subcategory": "Phenylpropylamine", "duration": {"onset": 0.375, "comeUp": 0.625, "peak": 1.5, "offset": 2.5, "afterEffects": 1.25}, "effects": {"cognitiveComplexity": 3, "euphoria": 5, "intensity": 8, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#c4b5fd", "secondaryColor": "#4f46e5", "petalRadius": 42, "centerSize": 5, "stemHeight": 53}},
  {"id": "tramadol", "name": "Tramadol", "category": "Opioids", "subcategory": "Phenylpropylamine", "duration": {"onset": 0.625, "comeUp": 0.75, "peak": 4.0, "offset": 3.0, "afterEffects": 2.094}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 10, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#c4b5fd", "secondaryColor": "#4f46e5", "petalRadius": 42, "centerSize": 5, "stemHeight": 72}},
  {"id": "u_47700", "name": "U-47700", "category": "Opioids", "subcategory": "Benzamide", "duration": {"onset": 0.125, "comeUp": 0.292, "peak": 1.5, "offset": 0, "afterEffects": 0.583}, "effects": {"cognitiveComplexity": 3, "euphoria": 4, "intensity": 8, "bodyLoad": 4, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#6366f1", "secondaryColor": "#818cf8", "petalRadius": 38, "centerSize": 5, "stemHeight": 36}},
  {"id": "bromazepam", "name": "Bromazepam", "category": "Other", "subcategory": "Other", "duration": {"onset": 0.242, "comeUp": 1.125, "peak": 7.0, "offset": 0.75, "afterEffects": 1.383}, "effects": {"cognitiveComplexity": 3, "euphoria": 3, "intensity": 10, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "rounded", "primaryColor": "#64748b", "secondaryColor": "#64748b", "petalRadius": 42, "centerSize": 5, "stemHeight": 72}},
  {"id": "1p_eth_lad", "name": "1P-ETH-LAD", "category": "Psychedelics", "subcategory": "Lysergamides", "duration": {"onset": 1.0, "comeUp": 0, "peak": 3.0, "offset": 3.0, "afterEffects": 2.0}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 10, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#e879f9", "secondaryColor": "#ec4899", "petalRadius": 42, "centerSize": 15, "stemHeight": 65}},
  {"id": "1cp_al_lad", "name": "1cP-AL-LAD", "category": "Psychedelics", "subcategory": "Lysergamides", "duration": {"onset": 0.667, "comeUp": 0.75, "peak": 3.75, "offset": 2.5, "afterEffects": 0.833}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 8, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#ec4899", "secondaryColor": "#059669", "petalRadius": 38, "centerSize": 15, "stemHeight": 63}},
  {"id": "1cp_mipla", "name": "1cP-MiPLA", "category": "Psychedelics", "subcategory": "Lysergamides", "duration": {"onset": 0.5, "comeUp": 1.125, "peak": 1.5, "offset": 1.5, "afterEffects": 0.375}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 7, "bodyLoad": 4, "egoDissolve": 8, "visuals": 9}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#c084fc", "secondaryColor": "#e879f9", "petalRadius": 36, "centerSize": 15, "stemHeight": 47}},
  {"id": "25b_nbome", "name": "25B-NBOMe", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.5, "comeUp": 1.0, "peak": 5.0, "offset": 3.0, "afterEffects": 0.5}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 10, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#ec4899", "secondaryColor": "#059669", "petalRadius": 42, "centerSize": 15, "stemHeight": 70}},
  {"id": "25c_nboh", "name": "25C-NBOH", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.5, "comeUp": 1.0, "peak": 0, "offset": 0, "afterEffects": 4.5}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 7, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 11, "petalShape": "wavy", "primaryColor": "#ec4899", "secondaryColor": "#059669", "petalRadius": 39, "centerSize": 15, "stemHeight": 52}},
  {"id": "25c_nbome", "name": "25C-NBOMe", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.25, "comeUp": 1.0, "peak": 5.0, "offset": 2.5, "afterEffects": 0.25}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 10, "bodyLoad": 5, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#c084fc", "petalRadius": 42, "centerSize": 15, "stemHeight": 65}},
  {"id": "25d_nbome", "name": "25D-NBOMe", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.5, "comeUp": 0, "peak": 1.5, "offset": 1.5, "afterEffects": 1.5}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 8, "bodyLoad": 5, "egoDissolve": 9, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#c084fc", "secondaryColor": "#e879f9", "petalRadius": 39, "centerSize": 16, "stemHeight": 47}},
  {"id": "25i_nboh", "name": "25I-NBOH", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.625, "comeUp": 1.0, "peak": 2.75, "offset": 2.0, "afterEffects": 0.125}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 7, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#e11d48", "secondaryColor": "#a855f7", "petalRadius": 40, "centerSize": 15, "stemHeight": 54}},
  {"id": "25i_nbome", "name": "25I-NBOMe", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.125, "comeUp": 0.333, "peak": 1.5, "offset": 2.5, "afterEffects": 0.542}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 9, "bodyLoad": 5, "egoDissolve": 8, "visuals": 7}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e11d48", "secondaryColor": "#a855f7", "petalRadius": 41, "centerSize": 15, "stemHeight": 47}},
  {"id": "25n_nbome", "name": "25N-NBOMe", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 1.0, "comeUp": 0, "peak": 2.5, "offset": 2.5, "afterEffects": 1.5}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 9, "bodyLoad": 4, "egoDissolve": 7, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#ec4899", "secondaryColor": "#059669", "petalRadius": 42, "centerSize": 13, "stemHeight": 58}},
  {"id": "2c_b_fly", "name": "2C-B-FLY", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.75, "comeUp": 1.5, "peak": 4.0, "offset": 2.5, "afterEffects": 0.75}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 9, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#c084fc", "petalRadius": 42, "centerSize": 15, "stemHeight": 67}},
  {"id": "2c_c", "name": "2C-C", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.542, "comeUp": 1.125, "peak": 2.5, "offset": 2.0, "afterEffects": 1.542}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 9, "bodyLoad": 5, "egoDissolve": 8, "visuals": 7}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#ec4899", "secondaryColor": "#059669", "petalRadius": 42, "centerSize": 15, "stemHeight": 59}},
  {"id": "2c_d", "name": "2C-D", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.5, "comeUp": 0.5, "peak": 2.0, "offset": 1.0, "afterEffects": 1.0}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 7, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#c084fc", "petalRadius": 37, "centerSize": 15, "stemHeight": 47}},
  {"id": "2c_e", "name": "2C-E", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.5, "comeUp": 1.5, "peak": 4.0, "offset": 2.5, "afterEffects": 2.125}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 10, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#c084fc", "secondaryColor": "#e879f9", "petalRadius": 42, "centerSize": 15, "stemHeight": 72}},
  {"id": "2c_i", "name": "2C-I", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.5, "comeUp": 1.125, "peak": 4.0, "offset": 2.5, "afterEffects": 2.031}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 9, "bodyLoad": 4, "egoDissolve": 9, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#c084fc", "petalRadius": 42, "centerSize": 16, "stemHeight": 70}},
  {"id": "2c_p", "name": "2C-P", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 2.0, "comeUp": 3.0, "peak": 6.0, "offset": 4.5, "afterEffects": 3.875}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 10, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#059669", "secondaryColor": "#e11d48", "petalRadius": 42, "centerSize": 15, "stemHeight": 92}},
  {"id": "2c_t", "name": "2C-T", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.625, "comeUp": 0, "peak": 1.208, "offset": 1.5, "afterEffects": 1.167}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 7, "bodyLoad": 5, "egoDissolve": 8, "visuals": 9}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e879f9", "secondaryColor": "#ec4899", "petalRadius": 40, "centerSize": 15, "stemHeight": 45}},
  {"id": "2c_t_2", "name": "2C-T-2", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.75, "comeUp": 0, "peak": 3.75, "offset": 3.0, "afterEffects": 0.5}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 10, "bodyLoad": 5, "egoDissolve": 9, "visuals": 9}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e11d48", "secondaryColor": "#a855f7", "petalRadius": 42, "centerSize": 16, "stemHeight": 61}},
  {"id": "2c_t_21", "name": "2C-T-21", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 1.75, "comeUp": 0, "peak": 3.5, "offset": 2.5, "afterEffects": 3.25}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 9, "bodyLoad": 4, "egoDissolve": 8, "visuals": 7}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e879f9", "secondaryColor": "#ec4899", "petalRadius": 42, "centerSize": 15, "stemHeight": 74}},
  {"id": "2c_t_7", "name": "2C-T-7", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 1.25, "comeUp": 0.333, "peak": 4.0, "offset": 2.0, "afterEffects": 0.417}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 8, "bodyLoad": 5, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#a855f7", "secondaryColor": "#8b5cf6", "petalRadius": 42, "centerSize": 15, "stemHeight": 61}},
  {"id": "3c_e", "name": "3C-E", "category": "Psychedelics", "subcategory": "Substituted amphetamines", "duration": {"onset": 1.5, "comeUp": 0, "peak": 6.0, "offset": 4.5, "afterEffects": 1.0}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 10, "bodyLoad": 5, "egoDissolve": 9, "visuals": 9}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#a855f7", "secondaryColor": "#8b5cf6", "petalRadius": 42, "centerSize": 16, "stemHeight": 83}},
  {"id": "3c_p", "name": "3C-P", "category": "Psychedelics", "subcategory": "Substituted amphetamines", "duration": {"onset": 1.5, "comeUp": 0, "peak": 6.0, "offset": 4.5, "afterEffects": 1.0}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 10, "bodyLoad": 4, "egoDissolve": 9, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e11d48", "secondaryColor": "#a855f7", "petalRadius": 42, "centerSize": 16, "stemHeight": 83}},
  {"id": "4_aco_det", "name": "4-AcO-DET", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.667, "comeUp": 1.25, "peak": 2.25, "offset": 1.5, "afterEffects": 1.417}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 9, "bodyLoad": 4, "egoDissolve": 8, "visuals": 7}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#a855f7", "secondaryColor": "#8b5cf6", "petalRadius": 42, "centerSize": 15, "stemHeight": 56}},
  {"id": "4_aco_dipt", "name": "4-AcO-DiPT", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.458, "comeUp": 0.5, "peak": 1.75, "offset": 1.25, "afterEffects": 0.99}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 8, "bodyLoad": 5, "egoDissolve": 8, "visuals": 7}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#a855f7", "secondaryColor": "#8b5cf6", "petalRadius": 41, "centerSize": 15, "stemHeight": 47}},
  {"id": "4_aco_met", "name": "4-AcO-MET", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.667, "comeUp": 0.75, "peak": 1.5, "offset": 2.0, "afterEffects": 0.083}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 9, "bodyLoad": 5, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#059669", "secondaryColor": "#e11d48", "petalRadius": 39, "centerSize": 15, "stemHeight": 47}},
  {"id": "4_aco_mipt", "name": "4-AcO-MiPT", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.667, "comeUp": 1.5, "peak": 2.25, "offset": 1.5, "afterEffects": 0.083}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 7, "bodyLoad": 5, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#ec4899", "secondaryColor": "#059669", "petalRadius": 38, "centerSize": 15, "stemHeight": 52}},
  {"id": "4_ho_det", "name": "4-HO-DET", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.542, "comeUp": 0.75, "peak": 3.0, "offset": 1.75, "afterEffects": 1.51}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 9, "bodyLoad": 5, "egoDissolve": 8, "visuals": 7}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e11d48", "secondaryColor": "#a855f7", "petalRadius": 42, "centerSize": 15, "stemHeight": 58}},
  {"id": "4_ho_dpt", "name": "4-HO-DPT", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.875, "comeUp": 1.5, "peak": 2.5, "offset": 1.5, "afterEffects": 0.125}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 9, "bodyLoad": 4, "egoDissolve": 9, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#c084fc", "secondaryColor": "#e879f9", "petalRadius": 41, "centerSize": 16, "stemHeight": 54}},
  {"id": "4_ho_dipt", "name": "4-HO-DiPT", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.375, "comeUp": 0.5, "peak": 1.25, "offset": 0.75, "afterEffects": 0.125}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 8, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e879f9", "secondaryColor": "#ec4899", "petalRadius": 39, "centerSize": 15, "stemHeight": 38}},
  {"id": "4_ho_ept", "name": "4-HO-EPT", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.75, "comeUp": 0, "peak": 1.5, "offset": 1.5, "afterEffects": 1.25}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 8, "bodyLoad": 4, "egoDissolve": 8, "visuals": 9}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#e11d48", "secondaryColor": "#a855f7", "petalRadius": 40, "centerSize": 15, "stemHeight": 47}},
  {"id": "4_ho_met", "name": "4-HO-MET", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.458, "comeUp": 0.75, "peak": 2.5, "offset": 1.25, "afterEffects": 0.042}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 8, "bodyLoad": 4, "egoDissolve": 8, "visuals": 9}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e11d48", "secondaryColor": "#a855f7", "petalRadius": 42, "centerSize": 15, "stemHeight": 47}},
  {"id": "4_ho_mpt", "name": "4-HO-MPT", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.667, "comeUp": 1.5, "peak": 2.5, "offset": 1.5, "afterEffects": 1.542}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 9, "bodyLoad": 4, "egoDissolve": 8, "visuals": 9}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e11d48", "secondaryColor": "#a855f7", "petalRadius": 42, "centerSize": 15, "stemHeight": 59}},
  {"id": "4_ho_mipt", "name": "4-HO-MiPT", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.5, "comeUp": 0.667, "peak": 2.0, "offset": 1.5, "afterEffects": 0.333}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 8, "bodyLoad": 5, "egoDissolve": 9, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#a855f7", "secondaryColor": "#8b5cf6", "petalRadius": 38, "centerSize": 16, "stemHeight": 47}},
  {"id": "5_meo_dalt", "name": "5-MeO-DALT", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.208, "comeUp": 0.292, "peak": 1.25, "offset": 1.5, "afterEffects": 0.812}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 6, "bodyLoad": 6, "egoDissolve": 8, "visuals": 7}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#c084fc", "petalRadius": 35, "centerSize": 15, "stemHeight": 43}},
  {"id": "5_meo_dibf", "name": "5-MeO-DiBF", "category": "Psychedelics", "subcategory": "Substituted benzofurans", "duration": {"onset": 0, "comeUp": 0, "peak": 0.75, "offset": 0, "afterEffects": 4.25}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 5, "bodyLoad": 4, "egoDissolve": 8, "visuals": 9}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e879f9", "secondaryColor": "#ec4899", "petalRadius": 31, "centerSize": 15, "stemHeight": 47}},
  {"id": "5_meo_dipt", "name": "5-MeO-DiPT", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.5, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 5.5}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 7, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#c084fc", "secondaryColor": "#e879f9", "petalRadius": 39, "centerSize": 15, "stemHeight": 52}},
  {"id": "5_meo_mipt", "name": "5-MeO-MiPT", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.5, "comeUp": 0.75, "peak": 2.5, "offset": 2.5, "afterEffects": 0.25}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 7, "bodyLoad": 4, "egoDissolve": 9, "visuals": 7}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#c084fc", "petalRadius": 36, "centerSize": 16, "stemHeight": 54}},
  {"id": "6_apb", "name": "6-APB", "category": "Psychedelics", "subcategory": "Substituted amphetamines", "duration": {"onset": 0.75, "comeUp": 1.5, "peak": 3.5, "offset": 2.5, "afterEffects": 0.25}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 7, "bodyLoad": 5, "egoDissolve": 8, "visuals": 7}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#ec4899", "secondaryColor": "#059669", "petalRadius": 40, "centerSize": 15, "stemHeight": 63}},
  {"id": "al_lad", "name": "AL-LAD", "category": "Psychedelics", "subcategory": "Lysergamides", "duration": {"onset": 0.667, "comeUp": 0.75, "peak": 3.75, "offset": 2.5, "afterEffects": 0.833}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 9, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#c084fc", "petalRadius": 40, "centerSize": 15, "stemHeight": 63}},
  {"id": "ald_52", "name": "ALD-52", "category": "Psychedelics", "subcategory": "Lysergamides", "duration": {"onset": 0.5, "comeUp": 1.5, "peak": 4.0, "offset": 4.0, "afterEffects": 1.0}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 10, "bodyLoad": 4, "egoDissolve": 8, "visuals": 7}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#c084fc", "petalRadius": 42, "centerSize": 15, "stemHeight": 74}},
  {"id": "allylescaline", "name": "Allylescaline", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 2.375, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 7.625}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 6, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#059669", "secondaryColor": "#e11d48", "petalRadius": 36, "centerSize": 15, "stemHeight": 70}},
  {"id": "ayahuasca", "name": "Ayahuasca", "category": "Psychedelics", "subcategory": "Psychedelics", "duration": {"onset": 0.667, "comeUp": 0, "peak": 1.5, "offset": 1.5, "afterEffects": 3.833}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 7, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#c084fc", "secondaryColor": "#e879f9", "petalRadius": 41, "centerSize": 15, "stemHeight": 58}},
  {"id": "bromo_dragonfly", "name": "Bromo-DragonFLY", "category": "Psychedelics", "subcategory": "Substituted amphetamines", "duration": {"onset": 4.5, "comeUp": 4.5, "peak": 9.0, "offset": 5.5, "afterEffects": 5.875}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 10, "bodyLoad": 4, "egoDissolve": 8, "visuals": 7}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#ec4899", "secondaryColor": "#059669", "petalRadius": 42, "centerSize": 15, "stemHeight": 92}},
  {"id": "det", "name": "DET", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 1.0, "comeUp": 0, "peak": 3.0, "offset": 0, "afterEffects": 1.0}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 9, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#c084fc", "secondaryColor": "#e879f9", "petalRadius": 42, "centerSize": 15, "stemHeight": 47}},
  {"id": "dob", "name": "DOB", "category": "Psychedelics", "subcategory": "Substituted amphetamines", "duration": {"onset": 1.0, "comeUp": 3.0, "peak": 8.0, "offset": 6.0, "afterEffects": 1.0}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 10, "bodyLoad": 5, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#e11d48", "secondaryColor": "#a855f7", "petalRadius": 42, "centerSize": 15, "stemHeight": 92}},
  {"id": "doc", "name": "DOC", "category": "Psychedelics", "subcategory": "Substituted amphetamines", "duration": {"onset": 1.5, "comeUp": 2.5, "peak": 9.0, "offset": 5.0, "afterEffects": 4.5}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 10, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#e879f9", "secondaryColor": "#ec4899", "petalRadius": 42, "centerSize": 15, "stemHeight": 92}},
  {"id": "doi", "name": "DOI", "category": "Psychedelics", "subcategory": "Substituted amphetamines", "duration": {"onset": 1.5, "comeUp": 2.25, "peak": 0, "offset": 0, "afterEffects": 16.25}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 6, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#c084fc", "secondaryColor": "#e879f9", "petalRadius": 36, "centerSize": 15, "stemHeight": 92}},
  {"id": "dom", "name": "DOM", "category": "Psychedelics", "subcategory": "Substituted amphetamines", "duration": {"onset": 1.5, "comeUp": 2.5, "peak": 7.0, "offset": 4.0, "afterEffects": 3.75}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 10, "bodyLoad": 5, "egoDissolve": 9, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#c084fc", "secondaryColor": "#e879f9", "petalRadius": 42, "centerSize": 16, "stemHeight": 92}},
  {"id": "dpt", "name": "DPT", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.667, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 2.333}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 7, "bodyLoad": 5, "egoDissolve": 9, "visuals": 9}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e879f9", "secondaryColor": "#ec4899", "petalRadius": 38, "centerSize": 16, "stemHeight": 38}},
  {"id": "dipt", "name": "DiPT", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.75, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 3.75}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 5, "bodyLoad": 5, "egoDissolve": 9, "visuals": 7}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#c084fc", "petalRadius": 31, "centerSize": 16, "stemHeight": 45}},
  {"id": "ept", "name": "EPT", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.208, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 2.792}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 6, "bodyLoad": 5, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#e879f9", "secondaryColor": "#ec4899", "petalRadius": 38, "centerSize": 15, "stemHeight": 38}},
  {"id": "eth_lad", "name": "ETH-LAD", "category": "Psychedelics", "subcategory": "Lysergamides", "duration": {"onset": 0.5, "comeUp": 1.125, "peak": 5.0, "offset": 3.0, "afterEffects": 0.375}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 10, "bodyLoad": 4, "egoDissolve": 8, "visuals": 9}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#c084fc", "petalRadius": 42, "centerSize": 15, "stemHeight": 70}},
  {"id": "efavirenz", "name": "Efavirenz", "category": "Psychedelics", "subcategory": "Benzoxazine", "duration": {"onset": 0.05, "comeUp": 0, "peak": 1.5, "offset": 0, "afterEffects": 0.388}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 6, "bodyLoad": 5, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e879f9", "secondaryColor": "#ec4899", "petalRadius": 37, "centerSize": 15, "stemHeight": 33}},
  {"id": "lsm_775", "name": "LSM-775", "category": "Psychedelics", "subcategory": "Lysergamides", "duration": {"onset": 0.333, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 7.667}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 6, "bodyLoad": 4, "egoDissolve": 9, "visuals": 9}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e879f9", "secondaryColor": "#ec4899", "petalRadius": 34, "centerSize": 16, "stemHeight": 61}},
  {"id": "lsz", "name": "LSZ", "category": "Psychedelics", "subcategory": "Lysergamides", "duration": {"onset": 0.667, "comeUp": 0.75, "peak": 4.0, "offset": 2.5, "afterEffects": 0.083}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 8, "bodyLoad": 4, "egoDissolve": 9, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#ec4899", "secondaryColor": "#059669", "petalRadius": 42, "centerSize": 16, "stemHeight": 61}},
  {"id": "met", "name": "MET", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 1.5, "comeUp": 0.75, "peak": 2.0, "offset": 2.0, "afterEffects": 1.562}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 7, "bodyLoad": 4, "egoDissolve": 8, "visuals": 9}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#c084fc", "petalRadius": 40, "centerSize": 15, "stemHeight": 60}},
  {"id": "methallylescaline", "name": "Methallylescaline", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.667, "comeUp": 1.0, "peak": 4.0, "offset": 3.0, "afterEffects": 0.333}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 10, "bodyLoad": 5, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#c084fc", "petalRadius": 42, "centerSize": 15, "stemHeight": 65}},
  {"id": "mipla", "name": "MiPLA", "category": "Psychedelics", "subcategory": "Lysergamides", "duration": {"onset": 0.5, "comeUp": 1.125, "peak": 1.5, "offset": 1.5, "afterEffects": 0.375}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 6, "bodyLoad": 4, "egoDissolve": 8, "visuals": 9}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#c084fc", "petalRadius": 34, "centerSize": 15, "stemHeight": 47}},
  {"id": "pargy_lad", "name": "PARGY-LAD", "category": "Psychedelics", "subcategory": "Lysergamides", "duration": {"onset": 0.625, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 6.375}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 6, "bodyLoad": 4, "egoDissolve": 8, "visuals": 7}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#ec4899", "secondaryColor": "#059669", "petalRadius": 36, "centerSize": 15, "stemHeight": 56}},
  {"id": "pro_lad", "name": "PRO-LAD", "category": "Psychedelics", "subcategory": "Lysergamides", "duration": {"onset": 0.625, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 6.375}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 5, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#8b5cf6", "secondaryColor": "#c084fc", "petalRadius": 35, "centerSize": 15, "stemHeight": 56}},
  {"id": "psilocin", "name": "Psilocin", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 0.542, "comeUp": 2.25, "peak": 2.5, "offset": 1.75, "afterEffects": 1.76}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 7, "bodyLoad": 4, "egoDissolve": 9, "visuals": 9}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e879f9", "secondaryColor": "#ec4899", "petalRadius": 40, "centerSize": 16, "stemHeight": 64}},
  {"id": "tma_2", "name": "TMA-2", "category": "Psychedelics", "subcategory": "Substituted amphetamines", "duration": {"onset": 1.167, "comeUp": 2.25, "peak": 5.0, "offset": 3.0, "afterEffects": 2.854}, "effects": {"cognitiveComplexity": 9, "euphoria": 6, "intensity": 10, "bodyLoad": 5, "egoDissolve": 9, "visuals": 8}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#059669", "secondaryColor": "#e11d48", "petalRadius": 42, "centerSize": 16, "stemHeight": 89}},
  {"id": "tma_6", "name": "TMA-6", "category": "Psychedelics", "subcategory": "Amphetamine", "duration": {"onset": 1.0, "comeUp": 2.25, "peak": 6.5, "offset": 4.0, "afterEffects": 3.438}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 10, "bodyLoad": 4, "egoDissolve": 8, "visuals": 9}, "flower": {"petalCount": 9, "petalShape": "wavy", "primaryColor": "#e11d48", "secondaryColor": "#a855f7", "petalRadius": 42, "centerSize": 15, "stemHeight": 92}},
  {"id": "\u03b1mt", "name": "\u0391MT", "category": "Psychedelics", "subcategory": "Substituted tryptamines", "duration": {"onset": 2.0, "comeUp": 0, "peak": 5.0, "offset": 0, "afterEffects": 7.0}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 9, "bodyLoad": 4, "egoDissolve": 8, "visuals": 8}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#e879f9", "secondaryColor": "#ec4899", "petalRadius": 42, "centerSize": 15, "stemHeight": 88}},
  {"id": "\u03b2k_2c_b", "name": "\u0392k-2C-B", "category": "Psychedelics", "subcategory": "Substituted phenethylamines", "duration": {"onset": 0.75, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 9.25}, "effects": {"cognitiveComplexity": 9, "euphoria": 7, "intensity": 7, "bodyLoad": 5, "egoDissolve": 8, "visuals": 7}, "flower": {"petalCount": 10, "petalShape": "wavy", "primaryColor": "#e11d48", "secondaryColor": "#a855f7", "petalRadius": 36, "centerSize": 15, "stemHeight": 70}},
  {"id": "2_aminoindane", "name": "2-Aminoindane", "category": "Stimulants", "subcategory": "Aminoindane", "duration": {"onset": 0.333, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 1.167}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 6, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#dc2626", "secondaryColor": "#ea580c", "petalRadius": 39, "centerSize": 5, "stemHeight": 31}},
  {"id": "2_fa", "name": "2-FA", "category": "Stimulants", "subcategory": "Substituted amphetamines", "duration": {"onset": 0.375, "comeUp": 0.375, "peak": 1.5, "offset": 1.25, "afterEffects": 0.875}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 8, "bodyLoad": 4, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#fb923c", "secondaryColor": "#dc2626", "petalRadius": 38, "centerSize": 5, "stemHeight": 44}},
  {"id": "2_fma", "name": "2-FMA", "category": "Stimulants", "subcategory": "Amphetamine", "duration": {"onset": 0.75, "comeUp": 0.458, "peak": 3.25, "offset": 2.5, "afterEffects": 1.042}, "effects": {"cognitiveComplexity": 3, "euphoria": 8, "intensity": 8, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#ef4444", "secondaryColor": "#f59e0b", "petalRadius": 41, "centerSize": 5, "stemHeight": 61}},
  {"id": "34_ctmp", "name": "3,4-CTMP", "category": "Stimulants", "subcategory": "Substituted phenidates", "duration": {"onset": 1.5, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 10.5}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 5, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#dc2626", "secondaryColor": "#ea580c", "petalRadius": 32, "centerSize": 5, "stemHeight": 79}},
  {"id": "3_fa", "name": "3-FA", "category": "Stimulants", "subcategory": "Amphetamine", "duration": {"onset": 0.667, "comeUp": 0.75, "peak": 2.5, "offset": 1.25, "afterEffects": 1.292}, "effects": {"cognitiveComplexity": 3, "euphoria": 8, "intensity": 9, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#f97316", "secondaryColor": "#fb923c", "petalRadius": 42, "centerSize": 5, "stemHeight": 54}},
  {"id": "3_fpm", "name": "3-FPM", "category": "Stimulants", "subcategory": "Substituted amphetamines", "duration": {"onset": 0.5, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 4.5}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 5, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#ef4444", "secondaryColor": "#f59e0b", "petalRadius": 36, "centerSize": 5, "stemHeight": 47}},
  {"id": "4f_eph", "name": "4F-EPH", "category": "Stimulants", "subcategory": "Substituted phenidates", "duration": {"onset": 0.292, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 5.208}, "effects": {"cognitiveComplexity": 3, "euphoria": 8, "intensity": 5, "bodyLoad": 4, "egoDissolve": 0, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#f97316", "secondaryColor": "#fb923c", "petalRadius": 31, "centerSize": 4, "stemHeight": 49}},
  {"id": "4f_mph", "name": "4F-MPH", "category": "Stimulants", "subcategory": "Substituted phenidates", "duration": {"onset": 0.75, "comeUp": 0, "peak": 3.0, "offset": 1.5, "afterEffects": 0.75}, "effects": {"cognitiveComplexity": 3, "euphoria": 8, "intensity": 8, "bodyLoad": 4, "egoDissolve": 2, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#dc2626", "secondaryColor": "#ea580c", "petalRadius": 38, "centerSize": 6, "stemHeight": 52}},
  {"id": "a_php", "name": "A-PHP", "category": "Stimulants", "subcategory": "Cathinone", "duration": {"onset": 0.183, "comeUp": 0, "peak": 1.75, "offset": 3.0, "afterEffects": 0.067}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 8, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#ef4444", "secondaryColor": "#f59e0b", "petalRadius": 42, "centerSize": 5, "stemHeight": 47}},
  {"id": "a_pvp", "name": "A-PVP", "category": "Stimulants", "subcategory": "Cathinone", "duration": {"onset": 0.183, "comeUp": 0, "peak": 1.75, "offset": 3.0, "afterEffects": 1.233}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 8, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#dc2626", "secondaryColor": "#ea580c", "petalRadius": 41, "centerSize": 5, "stemHeight": 52}},
  {"id": "adrafinil", "name": "Adrafinil", "category": "Stimulants", "subcategory": "Benzhydryl", "duration": {"onset": 1.5, "comeUp": 0.875, "peak": 5.25, "offset": 2.0, "afterEffects": 2.406}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 10, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#fb923c", "secondaryColor": "#dc2626", "petalRadius": 42, "centerSize": 6, "stemHeight": 79}},
  {"id": "armodafinil", "name": "Armodafinil", "category": "Stimulants", "subcategory": "Benzhydryl", "duration": {"onset": 0.667, "comeUp": 1.75, "peak": 5.5, "offset": 3.5, "afterEffects": 0.083}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 10, "bodyLoad": 4, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#dc2626", "secondaryColor": "#ea580c", "petalRadius": 42, "centerSize": 5, "stemHeight": 76}},
  {"id": "bromantane", "name": "Bromantane", "category": "Stimulants", "subcategory": "Adamantanes", "duration": {"onset": 0.75, "comeUp": 0, "peak": 3.0, "offset": 0, "afterEffects": 4.25}, "effects": {"cognitiveComplexity": 3, "euphoria": 8, "intensity": 8, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#fb923c", "secondaryColor": "#dc2626", "petalRadius": 42, "centerSize": 6, "stemHeight": 61}},
  {"id": "caffeine", "name": "Caffeine", "category": "Stimulants", "subcategory": "Xanthines", "duration": {"onset": 0.125, "comeUp": 0.583, "peak": 1.5, "offset": 8.0, "afterEffects": 2.552}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 8, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#ef4444", "secondaryColor": "#f59e0b", "petalRadius": 37, "centerSize": 6, "stemHeight": 82}},
  {"id": "cyclazodone", "name": "Cyclazodone", "category": "Stimulants", "subcategory": "Substituted aminorexes", "duration": {"onset": 0.542, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 5.458}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 6, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#f97316", "secondaryColor": "#fb923c", "petalRadius": 34, "centerSize": 5, "stemHeight": 52}},
  {"id": "dichloropane", "name": "Dichloropane", "category": "Stimulants", "subcategory": "Substituted tropanes", "duration": {"onset": 0.375, "comeUp": 0.375, "peak": 1.25, "offset": 1.25, "afterEffects": 0.812}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 6, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#fb923c", "secondaryColor": "#dc2626", "petalRadius": 34, "centerSize": 5, "stemHeight": 43}},
  {"id": "eth_cat", "name": "ETH-CAT", "category": "Stimulants", "subcategory": "Cathinone", "duration": {"onset": 0.458, "comeUp": 0.375, "peak": 1.25, "offset": 1.5, "afterEffects": 0.417}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 6, "bodyLoad": 4, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#f59e0b", "secondaryColor": "#f97316", "petalRadius": 36, "centerSize": 6, "stemHeight": 43}},
  {"id": "ephedrine", "name": "Ephedrine", "category": "Stimulants", "subcategory": "Amphetamine", "duration": {"onset": 0.917, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 2.583}, "effects": {"cognitiveComplexity": 3, "euphoria": 8, "intensity": 7, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#fb923c", "secondaryColor": "#dc2626", "petalRadius": 36, "centerSize": 6, "stemHeight": 40}},
  {"id": "ethylone", "name": "Ethylone", "category": "Stimulants", "subcategory": "Stimulants", "duration": {"onset": 0.5, "comeUp": 0, "peak": 1.25, "offset": 1.5, "afterEffects": 0.812}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 7, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#ea580c", "secondaryColor": "#ef4444", "petalRadius": 38, "centerSize": 6, "stemHeight": 43}},
  {"id": "ethylphenidate", "name": "Ethylphenidate", "category": "Stimulants", "subcategory": "Substituted phenidates", "duration": {"onset": 1.333, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 4.167}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#dc2626", "secondaryColor": "#ea580c", "petalRadius": 39, "centerSize": 5, "stemHeight": 49}},
  {"id": "fenethylline", "name": "Fenethylline", "category": "Stimulants", "subcategory": "Amphetamine", "duration": {"onset": 1.75, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 1.75}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 5, "bodyLoad": 3, "egoDissolve": 2, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#ea580c", "secondaryColor": "#ef4444", "petalRadius": 35, "centerSize": 6, "stemHeight": 40}},
  {"id": "hexedrone", "name": "Hexedrone", "category": "Stimulants", "subcategory": "Cathinone", "duration": {"onset": 0.375, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 2.125}, "effects": {"cognitiveComplexity": 3, "euphoria": 8, "intensity": 6, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#ea580c", "secondaryColor": "#ef4444", "petalRadius": 35, "centerSize": 5, "stemHeight": 36}},
  {"id": "isopropylphenidate", "name": "Isopropylphenidate", "category": "Stimulants", "subcategory": "Substituted phenidates", "duration": {"onset": 0.333, "comeUp": 0.5, "peak": 2.0, "offset": 1.5, "afterEffects": 0.417}, "effects": {"cognitiveComplexity": 3, "euphoria": 8, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#ef4444", "secondaryColor": "#f59e0b", "petalRadius": 38, "centerSize": 5, "stemHeight": 46}},
  {"id": "kratom", "name": "Kratom", "category": "Stimulants", "subcategory": "Indole alkaloids", "duration": {"onset": 0.5, "comeUp": 0, "peak": 1.5, "offset": 4.5, "afterEffects": 1.625}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 6, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#f59e0b", "secondaryColor": "#f97316", "petalRadius": 36, "centerSize": 5, "stemHeight": 61}},
  {"id": "lisdexamfetamine", "name": "Lisdexamfetamine", "category": "Stimulants", "subcategory": "Amphetamine", "duration": {"onset": 1.25, "comeUp": 0.75, "peak": 4.0, "offset": 5.0, "afterEffects": 1.0}, "effects": {"cognitiveComplexity": 3, "euphoria": 8, "intensity": 10, "bodyLoad": 4, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#ef4444", "secondaryColor": "#f59e0b", "petalRadius": 42, "centerSize": 5, "stemHeight": 79}},
  {"id": "mcpp", "name": "MCPP", "category": "Stimulants", "subcategory": "Substituted piperazines", "duration": {"onset": 0.667, "comeUp": 0.667, "peak": 3.0, "offset": 5.5, "afterEffects": 2.458}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 9, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#dc2626", "secondaryColor": "#ea580c", "petalRadius": 40, "centerSize": 5, "stemHeight": 80}},
  {"id": "methiopropamine", "name": "Methiopropamine", "category": "Stimulants", "subcategory": "Thiophene", "duration": {"onset": 0.75, "comeUp": 0, "peak": 3.0, "offset": 2.5, "afterEffects": 1.75}, "effects": {"cognitiveComplexity": 3, "euphoria": 6, "intensity": 7, "bodyLoad": 3, "egoDissolve": 2, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#fb923c", "secondaryColor": "#dc2626", "petalRadius": 39, "centerSize": 6, "stemHeight": 61}},
  {"id": "methylnaphthidate", "name": "Methylnaphthidate", "category": "Stimulants", "subcategory": "Substituted phenidates", "duration": {"onset": 0.092, "comeUp": 0, "peak": 1.75, "offset": 1.75, "afterEffects": 0.898}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#ea580c", "secondaryColor": "#ef4444", "petalRadius": 39, "centerSize": 5, "stemHeight": 45}},
  {"id": "methylphenidate", "name": "Methylphenidate", "category": "Stimulants", "subcategory": "Substituted phenidates", "duration": {"onset": 0.75, "comeUp": 0.542, "peak": 1.25, "offset": 0.875, "afterEffects": 0.854}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 6, "bodyLoad": 5, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#ea580c", "secondaryColor": "#ef4444", "petalRadius": 35, "centerSize": 5, "stemHeight": 44}},
  {"id": "modafinil", "name": "Modafinil", "category": "Stimulants", "subcategory": "Benzhydryl", "duration": {"onset": 0.667, "comeUp": 0.667, "peak": 4.25, "offset": 2.0, "afterEffects": 1.896}, "effects": {"cognitiveComplexity": 3, "euphoria": 8, "intensity": 10, "bodyLoad": 3, "egoDissolve": 2, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#ea580c", "secondaryColor": "#ef4444", "petalRadius": 42, "centerSize": 6, "stemHeight": 67}},
  {"id": "n_ethylhexedrone", "name": "N-Ethylhexedrone", "category": "Stimulants", "subcategory": "Cathinone", "duration": {"onset": 0.083, "comeUp": 0, "peak": 1.0, "offset": 2.5, "afterEffects": 0.896}, "effects": {"cognitiveComplexity": 3, "euphoria": 8, "intensity": 8, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#fb923c", "secondaryColor": "#dc2626", "petalRadius": 38, "centerSize": 6, "stemHeight": 45}},
  {"id": "nep", "name": "NEP", "category": "Stimulants", "subcategory": "Cathinone", "duration": {"onset": 0.075, "comeUp": 0.167, "peak": 0.75, "offset": 1.0, "afterEffects": 0.008}, "effects": {"cognitiveComplexity": 3, "euphoria": 8, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#dc2626", "secondaryColor": "#ea580c", "petalRadius": 38, "centerSize": 5, "stemHeight": 34}},
  {"id": "nm_2_ai", "name": "NM-2-AI", "category": "Stimulants", "subcategory": "Amphetamine", "duration": {"onset": 0.75, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 2.25}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 7, "bodyLoad": 4, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#ef4444", "secondaryColor": "#f59e0b", "petalRadius": 36, "centerSize": 5, "stemHeight": 38}},
  {"id": "oxiracetam", "name": "Oxiracetam", "category": "Stimulants", "subcategory": "Racetams", "duration": {"onset": 1.0, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 8.0}, "effects": {"cognitiveComplexity": 3, "euphoria": 8, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#f97316", "secondaryColor": "#fb923c", "petalRadius": 37, "centerSize": 5, "stemHeight": 65}},
  {"id": "pentedrone", "name": "Pentedrone", "category": "Stimulants", "subcategory": "Cathinone", "duration": {"onset": 0.375, "comeUp": 0, "peak": 1.5, "offset": 1.5, "afterEffects": 0.625}, "effects": {"cognitiveComplexity": 3, "euphoria": 8, "intensity": 9, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#f59e0b", "secondaryColor": "#f97316", "petalRadius": 42, "centerSize": 6, "stemHeight": 43}},
  {"id": "phenylpiracetam", "name": "Phenylpiracetam", "category": "Stimulants", "subcategory": "Racetams", "duration": {"onset": 0.75, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 1.75}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 7, "bodyLoad": 3, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#ea580c", "secondaryColor": "#ef4444", "petalRadius": 40, "centerSize": 6, "stemHeight": 36}},
  {"id": "prolintane", "name": "Prolintane", "category": "Stimulants", "subcategory": "Amphetamine", "duration": {"onset": 0.667, "comeUp": 0.5, "peak": 2.5, "offset": 1.5, "afterEffects": 1.292}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 7, "bodyLoad": 4, "egoDissolve": 2, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#f97316", "secondaryColor": "#fb923c", "petalRadius": 40, "centerSize": 6, "stemHeight": 54}},
  {"id": "propylhexedrine", "name": "Propylhexedrine", "category": "Stimulants", "subcategory": "Cycloalkylamines", "duration": {"onset": 0.333, "comeUp": 0.875, "peak": 3.5, "offset": 2.0, "afterEffects": 0.292}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 8, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#fb923c", "secondaryColor": "#dc2626", "petalRadius": 42, "centerSize": 5, "stemHeight": 56}},
  {"id": "theacrine", "name": "Theacrine", "category": "Stimulants", "subcategory": "Xanthines", "duration": {"onset": 0.75, "comeUp": 0, "peak": 0, "offset": 0, "afterEffects": 7.25}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 7, "bodyLoad": 3, "egoDissolve": 1, "visuals": 0}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#f59e0b", "secondaryColor": "#f97316", "petalRadius": 40, "centerSize": 5, "stemHeight": 61}},
  {"id": "tyrosine", "name": "Tyrosine", "category": "Stimulants", "subcategory": "Substituted phenethylamines", "duration": {"onset": 1.0, "comeUp": 0, "peak": 2.0, "offset": 0, "afterEffects": 0.75}, "effects": {"cognitiveComplexity": 3, "euphoria": 7, "intensity": 9, "bodyLoad": 3, "egoDissolve": 1, "visuals": 1}, "flower": {"petalCount": 4, "petalShape": "pointed", "primaryColor": "#dc2626", "secondaryColor": "#ea580c", "petalRadius": 42, "centerSize": 5, "stemHeight": 41}}
];

// ─── Globals ───
let gridAnimations = {};
let soloState = null;
let showFullList = true;

function getActiveDrugs() {
  if (showFullList) {
    // Merge and deduplicate
    const all = [...drugs, ...extraDrugs];
    // Sort by category then name
    all.sort((a, b) => a.category.localeCompare(b.category) || a.name.localeCompare(b.name));
    return all;
  }
  return drugs;
}

// ─── Init ───
document.addEventListener('DOMContentLoaded', init);

function init() {
  buildFilters();
  renderGrid('All');
  setupOverlay();
  setupHeaderButtons();
  setupCompareMode();
  setupSearch();
  setupDoseSlider();
  handleHashRoute();
  window.addEventListener('hashchange', handleHashRoute);

  // Resize canvases on orientation change / resize
  window.addEventListener('resize', () => {
    if (soloState) {
      const c = document.getElementById('hallucinationCanvas');
      c.width = window.innerWidth; c.height = window.innerHeight;
    }
    if (compareState) {
      const c = document.getElementById('compareCanvas');
      c.width = window.innerWidth; c.height = window.innerHeight;
    }
  });
}

// ─── Category filter ───
function buildFilters() {
  rebuildCategoryOptions();
  document.getElementById('categoryFilter').addEventListener('change', () => {
    renderGrid(document.getElementById('categoryFilter').value);
  });
}

function rebuildCategoryOptions() {
  const sel = document.getElementById('categoryFilter');
  const current = sel.value;
  // Keep just the "All" option
  sel.innerHTML = '<option value="All">All Categories</option>';
  const allDrugs = getActiveDrugs();
  const cats = [...new Set(allDrugs.map(d => d.category))].sort();
  cats.forEach(c => {
    const count = allDrugs.filter(d => d.category === c).length;
    const o = document.createElement('option');
    o.value = c;
    o.textContent = `${c} (${count})`;
    sel.appendChild(o);
  });
  // Restore selection if still valid
  if (cats.includes(current)) sel.value = current;
  else sel.value = 'All';
}

// ─── Header buttons ───
function setupHeaderButtons() {
  document.getElementById('restartAllBtn').addEventListener('click', () => {
    const now = performance.now();
    Object.values(gridAnimations).forEach(a => {
      a.startTime = now;
      a.playing = true;
    });
  });

  document.getElementById('randomPairBtn').addEventListener('click', openRandomPair);

  document.getElementById('fullListBtn').addEventListener('click', () => {
    showFullList = !showFullList;
    const btn = document.getElementById('fullListBtn');
    btn.textContent = showFullList ? 'Curated (20)' : `Full List (${20 + extraDrugs.length})`;
    btn.classList.toggle('full-list-active', showFullList);
    rebuildCategoryOptions();
    renderGrid(document.getElementById('categoryFilter').value);
  });

  document.getElementById('viewToggle').addEventListener('click', () => {
    const grid = document.getElementById('grid');
    const btn = document.getElementById('viewToggle');
    const isList = grid.classList.toggle('list-view');
    btn.innerHTML = isList ? '&#9638; Grid' : '&#9776; List';
  });
}

// ─── Grid rendering ───
function renderGrid(category) {
  Object.values(gridAnimations).forEach(a => { if (a.raf) cancelAnimationFrame(a.raf); });
  gridAnimations = {};

  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  const allDrugs = getActiveDrugs();
  const filtered = category === 'All' ? allDrugs : allDrugs.filter(d => d.category === category);

  // Group by category for full list mode with headers
  if (showFullList && category === 'All') {
    const groups = {};
    filtered.forEach(d => {
      if (!groups[d.category]) groups[d.category] = [];
      groups[d.category].push(d);
    });
    // Sort categories, render each with a header
    const catOrder = Object.keys(groups).sort();
    catOrder.forEach(cat => {
      const header = document.createElement('div');
      header.className = 'category-header';
      header.textContent = `${cat} (${groups[cat].length})`;
      grid.appendChild(header);
      groups[cat].forEach(drug => addDrugCard(grid, drug));
    });
  } else {
    filtered.forEach(drug => addDrugCard(grid, drug));
  }
}

function addDrugCard(grid, drug) {
  const card = document.createElement('div');
  card.className = 'card';

  const svgNS = 'http://www.w3.org/2000/svg';
  const svg = document.createElementNS(svgNS, 'svg');
  svg.setAttribute('viewBox', '-60 -55 120 130');
  svg.setAttribute('xmlns', svgNS);
  addDefs(svg, drug);
  const g = document.createElementNS(svgNS, 'g');
  g.dataset.id = drug.id;
  svg.appendChild(g);

  const label = document.createElement('div');
  label.className = 'label';
  label.textContent = drug.name;

  const subLabel = document.createElement('div');
  subLabel.className = 'sub-label';
  subLabel.textContent = drug.subcategory;

  card.appendChild(svg);
  card.appendChild(label);
  card.appendChild(subLabel);
  card.addEventListener('click', () => {
    if (compareMode) { addComparePick(drug, card); }
    else { openSolo(drug); }
  });
  grid.appendChild(card);

  startGridAnimation(drug, g, card);
}

function startGridAnimation(drug, g, card) {
  const state = { startTime: performance.now(), playing: true, raf: null };
  gridAnimations[drug.id] = state;

  function tick(now) {
    if (state.playing) {
      const elapsed = (now - state.startTime) / 1000;
      const totalDur = getTotalDuration(drug);
      const loopDur = totalDur + 2; // 2s pause between loops
      const t = elapsed % loopDur;
      const progress = Math.min(t / totalDur, 1);
      renderFlower(g, drug, progress, false, now);
      updateCardBackground(card, drug, progress, now);
    }
    state.raf = requestAnimationFrame(tick);
  }
  state.raf = requestAnimationFrame(tick);
}

// ─── Solo overlay ───
function setupOverlay() {
  document.getElementById('closeOverlay').addEventListener('click', closeSolo);
  document.getElementById('soloPlayPause').addEventListener('click', toggleSoloPlay);
  document.getElementById('soloRestart').addEventListener('click', restartSolo);

  const timeline = document.getElementById('timeline');
  timeline.addEventListener('input', () => {
    if (!soloState) return;
    soloState.scrubbing = true;
    const progress = timeline.value / 1000;
    const now = performance.now();
    renderFlower(soloState.g, soloState.drug, progress, true, now);
    updatePhaseLabel(soloState.drug, progress);
    updateTimeLabels(soloState.drug, progress);
    updateSoloBackground(soloState.drug, progress, now);
  });
  timeline.addEventListener('change', () => {
    if (!soloState) return;
    // Resume from scrub position
    const progress = document.getElementById('timeline').value / 1000;
    const totalDur = getTotalDuration(soloState.drug);
    soloState.startTime = performance.now() - (progress * totalDur * 1000);
    soloState.scrubbing = false;
  });

  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') closeSolo();
    if (e.key === ' ' && soloState) { e.preventDefault(); toggleSoloPlay(); }
    if (e.key === 'm' && soloState) { AudioEngine.toggleMute(); updateSoundBtn('soloSoundBtn'); }
  });

  document.getElementById('soloSoundBtn').addEventListener('click', () => {
    AudioEngine.toggleMute();
    updateSoundBtn('soloSoundBtn');
  });
}

function updateSoundBtn(id) {
  const btn = document.getElementById(id);
  if (!btn) return;
  const muted = AudioEngine.isMuted();
  btn.textContent = muted ? '\u{1F507}' : '\u{1F50A}';
  btn.classList.toggle('active', !muted);
}

function openSolo(drug) {
  if (soloState && soloState.raf) cancelAnimationFrame(soloState.raf);

  const overlay = document.getElementById('overlay');
  overlay.classList.add('open');

  // Init hallucination canvas
  const canvas = document.getElementById('hallucinationCanvas');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  initHallucinationOrbs(drug);
  document.getElementById('soloName').textContent = drug.name;
  document.getElementById('soloCategory').textContent = `${drug.category} \u2014 ${drug.subcategory}`;
  document.getElementById('pwLink').href = getPWUrl(drug);
  document.getElementById('doseSlider').value = 2;
  document.getElementById('doseLabel').textContent = 'Medium';
  currentDose = 2;
  setHash(drug.id);

  // Effect details
  const e = drug.effects;
  const dur = drug.duration;
  document.getElementById('soloDetails').innerHTML =
    `<span><b>Intensity:</b> ${e.intensity}/10</span>` +
    `<span><b>Euphoria:</b> ${e.euphoria}/10</span>` +
    `<span><b>Visuals:</b> ${e.visuals}/10</span>` +
    `<span><b>Body load:</b> ${e.bodyLoad}/10</span>` +
    `<span><b>Ego dissolution:</b> ${e.egoDissolve}/10</span>` +
    `<span><b>Total duration:</b> ${formatTime(getTotalDuration(drug))}</span>` +
    `<span><b>Peak:</b> ${formatTime(dur.peak)}</span>`;

  const container = document.getElementById('soloFlowerContainer');
  container.innerHTML = '';

  const svgNS = 'http://www.w3.org/2000/svg';
  const svg = document.createElementNS(svgNS, 'svg');
  svg.classList.add('solo-flower');
  svg.setAttribute('viewBox', '-80 -70 160 160');
  svg.setAttribute('xmlns', svgNS);
  addDefs(svg, drug);
  const g = document.createElementNS(svgNS, 'g');
  svg.appendChild(g);
  container.appendChild(svg);

  soloState = { drug, baseDrug: drug, g, startTime: performance.now(), playing: true, scrubbing: false, raf: null };
  document.getElementById('soloPlayPause').innerHTML = '&#9646;&#9646;';
  try { AudioEngine.start(drug, 'solo'); } catch(e) { console.warn('Audio init failed:', e); }
  updateSoundBtn('soloSoundBtn');

  const totalDur = getTotalDuration(drug);
  document.getElementById('totalLabel').textContent = formatTime(totalDur);
  document.getElementById('timeline').value = 0;

  function tick(now) {
    if (!soloState) return;
    // Apply dose scaling
    soloState.drug = applyDose(soloState.baseDrug, getDoseMultiplier());
    const activeDrug = soloState.drug;
    const curTotalDur = getTotalDuration(activeDrug);
    if (soloState.playing && !soloState.scrubbing) {
      const elapsed = (now - soloState.startTime) / 1000;
      const progress = Math.min(elapsed / curTotalDur, 1);
      renderFlower(g, activeDrug, progress, true, now);
      document.getElementById('timeline').value = progress * 1000;
      updatePhaseLabel(activeDrug, progress);
      updateTimeLabels(activeDrug, progress);
      updateSoloBackground(activeDrug, progress, now);
      try { AudioEngine.update(activeDrug, progress, 'solo'); } catch(e) {}

      if (progress >= 1) {
        soloState.playing = false;
        document.getElementById('soloPlayPause').innerHTML = '&#9654;';
      }
    }
    soloState.raf = requestAnimationFrame(tick);
  }
  soloState.raf = requestAnimationFrame(tick);
}

function closeSolo() {
  const overlay = document.getElementById('overlay');
  overlay.classList.remove('open');
  overlay.style.background = '';
  const canvas = document.getElementById('hallucinationCanvas');
  const cctx = canvas.getContext('2d');
  cctx.clearRect(0, 0, canvas.width, canvas.height);
  hallucinationOrbs = [];
  try { AudioEngine.stop('solo'); } catch(e) {}
  if (soloState && soloState.raf) cancelAnimationFrame(soloState.raf);
  soloState = null;
  setHash('');
}

function toggleSoloPlay() {
  if (!soloState) return;
  soloState.playing = !soloState.playing;
  document.getElementById('soloPlayPause').innerHTML = soloState.playing ? '&#9646;&#9646;' : '&#9654;';
  if (soloState.playing) {
    const progress = document.getElementById('timeline').value / 1000;
    const totalDur = getTotalDuration(soloState.drug);
    soloState.startTime = performance.now() - (progress * totalDur * 1000);
  }
}

function restartSolo() {
  if (!soloState) return;
  soloState.startTime = performance.now();
  soloState.playing = true;
  soloState.scrubbing = false;
  document.getElementById('soloPlayPause').innerHTML = '&#9646;&#9646;';
}

// ─── Compare mode ───
let compareMode = false;
let comparePicks = [];  // up to 2 drug objects
let compareState = null; // { drugs, gs, startTime, playing, scrubbing, raf }

// Interaction database — based on documented pharmacological interactions
const INTERACTIONS = [
  { cats: ['Psychedelics', 'Entactogens'], type: 'synergy', label: 'Synergistic',
    color: '#f59e0b', desc: 'Commonly reported to intensify visuals, euphoria, and emotional depth. Classic combinations include "candyflipping" (LSD+MDMA) and "hippieflipping" (psilocybin+MDMA).' },
  { cats: ['Psychedelics', 'Cannabinoids'], type: 'synergy', label: 'Potentiating',
    color: '#22c55e', desc: 'Cannabis is commonly reported to significantly intensify psychedelic visuals and cognitive effects, sometimes unpredictably.' },
  { cats: ['Psychedelics', 'Dissociatives'], type: 'synergy', label: 'Synergistic',
    color: '#a855f7', desc: 'Reported to produce deeply immersive, dissociated psychedelic states. The combination can be overwhelming and unpredictable.' },
  { cats: ['Depressants', 'Psychedelics'], type: 'antagonism', label: 'Dampening',
    color: '#3b82f6', desc: 'Benzodiazepines and other depressants are commonly used as "trip killers" to reduce psychedelic intensity. They dampen visuals and anxiety.' },
  { cats: ['Stimulants', 'Depressants'], type: 'antagonism', label: 'Opposing',
    color: '#ef4444', desc: 'These categories have opposing mechanisms. Stimulants mask depressant sedation while depressants mask stimulant anxiety, but underlying physiological strain remains.' },
  { cats: ['Depressants', 'Depressants'], type: 'synergy', label: 'Dangerous Synergy',
    color: '#dc2626', desc: 'Combining depressants (opioids + benzodiazepines) is widely documented to synergistically increase respiratory depression risk. This is one of the most dangerous drug combinations.' },
  { cats: ['Stimulants', 'Stimulants'], type: 'synergy', label: 'Compounding',
    color: '#f97316', desc: 'Combining stimulants compounds cardiovascular strain. Increased heart rate, blood pressure, and risk of cardiac events are well-documented.' },
  { cats: ['Entactogens', 'Stimulants'], type: 'synergy', label: 'Intensifying',
    color: '#fb923c', desc: 'Stimulants can intensify entactogen effects but also increase neurotoxicity risk, cardiovascular strain, and hyperthermia.' },
  { cats: ['Dissociatives', 'Depressants'], type: 'synergy', label: 'Dangerous Synergy',
    color: '#dc2626', desc: 'Both categories depress the CNS. Combination increases risk of respiratory depression, loss of consciousness, and vomiting while sedated.' },
  { cats: ['Cannabinoids', 'Dissociatives'], type: 'synergy', label: 'Potentiating',
    color: '#64748b', desc: 'Cannabis is reported to deepen dissociative states and can increase confusion and disorientation.' },
  { cats: ['Deliriants', 'Psychedelics'], type: 'synergy', label: 'Unpredictable',
    color: '#78716c', desc: 'Deliriants combined with psychedelics produce highly unpredictable, often dysphoric experiences. Realistic hallucinations mixed with psychedelic distortion.' },
  { cats: ['Deliriants', 'Depressants'], type: 'synergy', label: 'Dangerous Synergy',
    color: '#dc2626', desc: 'Both cause sedation and cognitive impairment. Combination increases risk of cardiac complications (deliriants are anticholinergic) and respiratory depression.' },
  // Opioids as separate category
  { cats: ['Opioids', 'Depressants'], type: 'synergy', label: 'Dangerous Synergy',
    color: '#dc2626', desc: 'Opioids combined with depressants (benzodiazepines, alcohol, GHB) synergistically increase respiratory depression risk. This is one of the leading causes of overdose death.' },
  { cats: ['Opioids', 'Opioids'], type: 'synergy', label: 'Dangerous Synergy',
    color: '#dc2626', desc: 'Combining opioids compounds respiratory depression. Overdose risk increases dramatically with multiple opioids.' },
  { cats: ['Opioids', 'Stimulants'], type: 'antagonism', label: 'Opposing',
    color: '#ef4444', desc: 'Stimulants mask opioid sedation, making it difficult to gauge intoxication level. When the stimulant wears off first, delayed respiratory depression can occur.' },
  { cats: ['Opioids', 'Dissociatives'], type: 'synergy', label: 'Dangerous Synergy',
    color: '#dc2626', desc: 'Both cause CNS depression and respiratory suppression. The dissociative component can mask warning signs of opioid overdose.' },
  { cats: ['Opioids', 'Psychedelics'], type: 'antagonism', label: 'Mixed',
    color: '#94a3b8', desc: 'Opioids may dampen psychedelic intensity. The combination is not well-studied but opioid sedation can reduce anxiety while dulling the experience.' },
  // Nootropics
  { cats: ['Nootropics', 'Stimulants'], type: 'synergy', label: 'Additive',
    color: '#06b6d4', desc: 'Some nootropics enhance stimulant cognitive effects. The combination is commonly used for cognitive performance but may increase cardiovascular strain.' },
  // Hallucinogens (sleep-related)
  { cats: ['Hallucinogens', 'Depressants'], type: 'synergy', label: 'Potentiating',
    color: '#d946ef', desc: 'Hypnotic hallucinogens combined with depressants intensify sedation and hallucinatory effects. Increased risk of amnesia and loss of motor control.' },
];

function getInteraction(drug1, drug2) {
  const c1 = drug1.category, c2 = drug2.category;
  // Same drug
  if (drug1.id === drug2.id) return { type: 'same', label: 'Same Drug', color: '#64748b', desc: 'Same substance — effects simply overlap.' };
  // Same subcategory
  if (drug1.subcategory === drug2.subcategory && drug1.subcategory !== drug1.category)
    return { type: 'similar', label: 'Similar Compounds', color: '#94a3b8', desc: `Both are ${drug1.subcategory.toLowerCase()}. Effects are largely additive with similar mechanism of action.` };
  // Check interaction table (bidirectional)
  for (const rule of INTERACTIONS) {
    if ((rule.cats[0] === c1 && rule.cats[1] === c2) || (rule.cats[0] === c2 && rule.cats[1] === c1)) {
      return rule;
    }
  }
  return { type: 'unknown', label: 'Mixed Effects', color: '#64748b', desc: 'Interaction profile varies. Combined effects are not well characterized for this specific pairing.' };
}

// Compute combined effects based on interaction type
function getCombinedEffects(drug1, drug2, interaction) {
  const e1 = drug1.effects, e2 = drug2.effects;
  let synergyMult = 1.0;  // how much the combo amplifies
  let dampenMult = 1.0;   // how much it dampens

  if (interaction.type === 'synergy') { synergyMult = 1.35; }
  else if (interaction.type === 'antagonism') { dampenMult = 0.6; }

  return {
    visuals: Math.min(10, Math.max(e1.visuals, e2.visuals) * synergyMult * dampenMult + Math.min(e1.visuals, e2.visuals) * 0.3 * synergyMult),
    intensity: Math.min(10, (e1.intensity + e2.intensity) * 0.6 * synergyMult * dampenMult),
    euphoria: Math.min(10, Math.max(e1.euphoria, e2.euphoria) * synergyMult * dampenMult),
    bodyLoad: Math.min(10, (e1.bodyLoad + e2.bodyLoad) * 0.6 * synergyMult),
    egoDissolve: Math.min(10, Math.max(e1.egoDissolve, e2.egoDissolve) * synergyMult * dampenMult),
  };
}

function enterCompareMode() {
  compareMode = true;
  comparePicks = [];
  document.getElementById('compareBar').classList.add('active');
  document.getElementById('picks').innerHTML = '';
  document.getElementById('compareGo').style.display = 'none';
  // Make cards selectable
  document.querySelectorAll('.card').forEach(c => c.classList.add('selectable'));
}

function exitCompareMode() {
  compareMode = false;
  comparePicks = [];
  document.getElementById('compareBar').classList.remove('active');
  document.querySelectorAll('.card').forEach(c => {
    c.classList.remove('selectable', 'selected');
  });
}

function addComparePick(drug, card) {
  if (comparePicks.length >= 2) return;
  if (comparePicks.find(p => p.drug.id === drug.id)) return;
  comparePicks.push({ drug, card });
  card.classList.add('selected');

  // Update picks display
  const picksEl = document.getElementById('picks');
  picksEl.innerHTML = comparePicks.map((p, i) =>
    `<span class="picked">${p.drug.name}<button class="remove-pick" data-idx="${i}">&times;</button></span>`
  ).join(' + ');

  picksEl.querySelectorAll('.remove-pick').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const idx = parseInt(btn.dataset.idx);
      comparePicks[idx].card.classList.remove('selected');
      comparePicks.splice(idx, 1);
      // Refresh display
      addComparePick.__refresh();
    });
  });

  document.getElementById('compareGo').style.display = comparePicks.length === 2 ? '' : 'none';
}
// Helper to refresh picks display without adding
addComparePick.__refresh = function() {
  const picksEl = document.getElementById('picks');
  picksEl.innerHTML = comparePicks.map((p, i) =>
    `<span class="picked">${p.drug.name}<button class="remove-pick" data-idx="${i}">&times;</button></span>`
  ).join(comparePicks.length === 2 ? ' + ' : '');
  picksEl.querySelectorAll('.remove-pick').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const idx = parseInt(btn.dataset.idx);
      comparePicks[idx].card.classList.remove('selected');
      comparePicks.splice(idx, 1);
      addComparePick.__refresh();
    });
  });
  document.getElementById('compareGo').style.display = comparePicks.length === 2 ? '' : 'none';
};

function openCompare() {
  if (comparePicks.length !== 2) return;
  const drug1 = comparePicks[0].drug;
  const drug2 = comparePicks[1].drug;
  exitCompareMode();

  const interaction = getInteraction(drug1, drug2);
  const combined = getCombinedEffects(drug1, drug2, interaction);

  const overlay = document.getElementById('compareOverlay');
  overlay.classList.add('open');

  // Canvas
  const canvas = document.getElementById('compareCanvas');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  initCompareOrbs(drug1, drug2, interaction);

  // Title + interaction
  document.getElementById('compareTitle').textContent = `${drug1.name} + ${drug2.name}`;
  const tag = document.getElementById('interactionTag');
  tag.textContent = interaction.label;
  tag.style.background = interaction.color + '30';
  tag.style.color = interaction.color;
  tag.style.border = `1px solid ${interaction.color}50`;
  document.getElementById('interactionDesc').textContent = interaction.desc;

  // Build side-by-side flowers
  const container = document.getElementById('compareFlowers');
  container.innerHTML = '';
  const svgNS = 'http://www.w3.org/2000/svg';
  const gs = [];

  [drug1, drug2].forEach((drug, idx) => {
    const side = document.createElement('div');
    side.className = 'compare-side';

    const svg = document.createElementNS(svgNS, 'svg');
    svg.setAttribute('viewBox', '-80 -70 160 160');
    svg.setAttribute('xmlns', svgNS);
    addDefs(svg, drug);
    const g = document.createElementNS(svgNS, 'g');
    svg.appendChild(g);
    gs.push(g);

    const label = document.createElement('div');
    label.className = 'compare-label';
    label.textContent = drug.name;

    const phase = document.createElement('div');
    phase.className = 'compare-phase';
    phase.id = `comparePhase${idx}`;

    side.appendChild(svg);
    side.appendChild(label);
    side.appendChild(phase);
    container.appendChild(side);
  });

  // Build hybrid flower
  const hybridResult = renderHybridFlower(drug1, drug2, interaction);
  const hybridDrug = hybridResult.hybrid;
  const hybridG = hybridResult.g;

  const maxDur = Math.max(getTotalDuration(drug1), getTotalDuration(drug2));
  document.getElementById('compareTotalLabel').textContent = formatTime(maxDur);
  document.getElementById('compareTimeline').value = 0;
  setHash(drug1.id + '+' + drug2.id);

  compareState = {
    drugs: [drug1, drug2],
    gs,
    interaction,
    combined,
    maxDur,
    hybridDrug,
    hybridG,
    startTime: performance.now(),
    playing: true,
    scrubbing: false,
    raf: null,
  };
  document.getElementById('comparePlayPause').innerHTML = '&#9646;&#9646;';
  try { AudioEngine.startDual(drug1, drug2); } catch(e) { console.warn('Audio init failed:', e); }
  updateSoundBtn('compareSoundBtn');

  function tick(now) {
    if (!compareState) return;
    if (compareState.playing && !compareState.scrubbing) {
      const elapsed = (now - compareState.startTime) / 1000;
      const progress = Math.min(elapsed / maxDur, 1);
      renderCompareFrame(progress, now);
      document.getElementById('compareTimeline').value = progress * 1000;
      document.getElementById('compareTimeLabel').textContent = formatTime(progress * maxDur);
      // Update audio for both drugs
      const dur1t = getTotalDuration(drug1), dur2t = getTotalDuration(drug2);
      const t = progress * maxDur;
      try { AudioEngine.update(drug1, Math.min(t / dur1t, 1), 'comp0'); } catch(e) {}
      try { AudioEngine.update(drug2, Math.min(t / dur2t, 1), 'comp1'); } catch(e) {}

      if (progress >= 1) {
        compareState.playing = false;
        document.getElementById('comparePlayPause').innerHTML = '&#9654;';
      }
    }
    compareState.raf = requestAnimationFrame(tick);
  }
  compareState.raf = requestAnimationFrame(tick);
}

function renderCompareFrame(progress, now) {
  if (!compareState) return;
  const { drugs: [d1, d2], gs: [g1, g2], maxDur, interaction, combined } = compareState;

  // Each drug progresses on its own timeline within the shared max duration
  const dur1 = getTotalDuration(d1);
  const dur2 = getTotalDuration(d2);
  const t = progress * maxDur;
  const p1 = Math.min(t / dur1, 1);
  const p2 = Math.min(t / dur2, 1);

  renderFlower(g1, d1, p1, true, now);
  renderFlower(g2, d2, p2, true, now);

  // Hybrid flower
  if (compareState.hybridDrug && compareState.hybridG) {
    const hybridP = (p1 + p2) / 2;
    renderFlower(compareState.hybridG, compareState.hybridDrug, hybridP, true, now);
  }

  // Phase labels
  const phase1 = p1 < 1 ? getPhaseInfo(d1, p1) : { name: 'Finished', phaseProgress: 1 };
  const phase2 = p2 < 1 ? getPhaseInfo(d2, p2) : { name: 'Finished', phaseProgress: 1 };
  document.getElementById('comparePhase0').textContent = `${phase1.name} (${Math.round(phase1.phaseProgress * 100)}%)`;
  document.getElementById('comparePhase1').textContent = `${phase2.name} (${Math.round(phase2.phaseProgress * 100)}%)`;

  // Combined hallucination background
  updateCompareBackground(d1, d2, p1, p2, interaction, combined, now);
}

function closeCompare() {
  document.getElementById('compareOverlay').classList.remove('open');
  const canvas = document.getElementById('compareCanvas');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  document.getElementById('hybridFlower').innerHTML = '';
  if (compareState && compareState.raf) cancelAnimationFrame(compareState.raf);
  try { AudioEngine.stop('comp0'); AudioEngine.stop('comp1'); } catch(e) {}
  compareState = null;
  setHash('');
}

// ─── Compare hallucination canvas ───
let compareOrbs = [];

function initCompareOrbs(drug1, drug2, interaction) {
  compareOrbs = [];
  const v1 = drug1.effects.visuals, v2 = drug2.effects.visuals;
  const count = 15 + Math.round((v1 + v2) * 2.5);
  const rgb1 = hexToRgb(drug1.flower.primaryColor);
  const rgb2 = hexToRgb(drug2.flower.primaryColor);
  const acc1 = hexToRgb(drug1.flower.secondaryColor);
  const acc2 = hexToRgb(drug2.flower.secondaryColor);

  for (let i = 0; i < count; i++) {
    const side = i < count / 2 ? 0 : 1; // which drug this orb belongs to
    const baseColor = side === 0 ? lerpColor(rgb1, acc1, Math.random()) : lerpColor(rgb2, acc2, Math.random());
    compareOrbs.push({
      x: Math.random(),
      y: Math.random(),
      baseR: 25 + Math.random() * 100,
      speed: 0.12 + Math.random() * 0.3,
      phase: Math.random() * Math.PI * 2,
      driftX: (Math.random() - 0.5) * 0.35,
      driftY: (Math.random() - 0.5) * 0.25,
      color: baseColor,
      side,
      mirror: Math.random() > 0.55,
    });
  }
}

function updateCompareBackground(d1, d2, p1, p2, interaction, combined, now) {
  const canvas = document.getElementById('compareCanvas');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  const time = now / 1000;

  const i1 = getHallucinationIntensity(d1, p1);
  const i2 = getHallucinationIntensity(d2, p2);

  // Interaction modifies combined intensity
  let synergyBoost = 1.0;
  if (interaction.type === 'synergy') synergyBoost = 1.4;
  else if (interaction.type === 'antagonism') synergyBoost = 0.55;

  const combinedIntensity = Math.min(1, (i1 + i2) * 0.6 * synergyBoost);
  const overlapIntensity = Math.min(i1, i2) * synergyBoost; // how much they overlap right now

  const dark = [15, 15, 26];
  const rgb1 = hexToRgb(d1.flower.primaryColor);
  const rgb2 = hexToRgb(d2.flower.primaryColor);
  const acc1 = hexToRgb(d1.flower.secondaryColor);
  const acc2 = hexToRgb(d2.flower.secondaryColor);

  // Clear
  ctx.globalCompositeOperation = 'source-over';
  ctx.fillStyle = `rgb(${dark[0]},${dark[1]},${dark[2]})`;
  ctx.fillRect(0, 0, W, H);

  if (combinedIntensity < 0.005) return;

  // ── Layer 1: Dual color wash (left=drug1, right=drug2, blending in center) ──
  const wash1 = lerpColor(rgb1, acc1, 0.5 + Math.sin(time * 0.25) * 0.3);
  const wash2 = lerpColor(rgb2, acc2, 0.5 + Math.cos(time * 0.3) * 0.3);
  const w1a = i1 * 0.25;
  const w2a = i2 * 0.25;

  // Drug 1 wash — biased left
  const grd1 = ctx.createRadialGradient(
    W * (0.3 + Math.sin(time * 0.2) * 0.1), H * 0.45, 0,
    W * 0.35, H * 0.5, W * 0.5
  );
  grd1.addColorStop(0, `rgba(${wash1[0]},${wash1[1]},${wash1[2]},${w1a})`);
  grd1.addColorStop(1, `rgba(${dark[0]},${dark[1]},${dark[2]},0)`);
  ctx.fillStyle = grd1;
  ctx.fillRect(0, 0, W, H);

  // Drug 2 wash — biased right
  const grd2 = ctx.createRadialGradient(
    W * (0.7 + Math.cos(time * 0.18) * 0.1), H * 0.45, 0,
    W * 0.65, H * 0.5, W * 0.5
  );
  grd2.addColorStop(0, `rgba(${wash2[0]},${wash2[1]},${wash2[2]},${w2a})`);
  grd2.addColorStop(1, `rgba(${dark[0]},${dark[1]},${dark[2]},0)`);
  ctx.fillStyle = grd2;
  ctx.fillRect(0, 0, W, H);

  // ── Overlap zone: blended color in center when both active ──
  if (overlapIntensity > 0.05) {
    const blended = lerpColor(wash1, wash2, 0.5 + Math.sin(time * 0.5) * 0.2);
    const overlapGrd = ctx.createRadialGradient(
      W * 0.5, H * 0.45, 0, W * 0.5, H * 0.5, W * 0.35
    );
    overlapGrd.addColorStop(0, `rgba(${blended[0]},${blended[1]},${blended[2]},${overlapIntensity * 0.3 * synergyBoost})`);
    overlapGrd.addColorStop(1, `rgba(${blended[0]},${blended[1]},${blended[2]},0)`);
    ctx.fillStyle = overlapGrd;
    ctx.fillRect(0, 0, W, H);
  }

  // ── Layer 2: Floating orbs ──
  ctx.globalCompositeOperation = 'screen';
  for (const orb of compareOrbs) {
    const orbIntensity = orb.side === 0 ? i1 : i2;
    if (orbIntensity < 0.01) continue;

    const ox = ((orb.x + orb.driftX * time * orb.speed * 0.1) % 1.4) - 0.2;
    const oy = ((orb.y + orb.driftY * time * orb.speed * 0.1) % 1.4) - 0.2;
    const px = ox * W;
    const py = oy * H;
    const sizePulse = 1 + Math.sin(time * orb.speed * 2 + orb.phase) * 0.3 * orbIntensity;
    const r = orb.baseR * orbIntensity * sizePulse * (1 + overlapIntensity * 0.3 * synergyBoost);

    if (r < 1) continue;

    const alpha = orbIntensity * (0.12 + Math.sin(time * orb.speed + orb.phase) * 0.06);
    const g = ctx.createRadialGradient(px, py, 0, px, py, r);
    g.addColorStop(0, `rgba(${orb.color[0]},${orb.color[1]},${orb.color[2]},${alpha})`);
    g.addColorStop(0.5, `rgba(${orb.color[0]},${orb.color[1]},${orb.color[2]},${alpha * 0.25})`);
    g.addColorStop(1, `rgba(${orb.color[0]},${orb.color[1]},${orb.color[2]},0)`);
    ctx.fillStyle = g;
    ctx.fillRect(px - r, py - r, r * 2, r * 2);

    if (orb.mirror && combinedIntensity > 0.3) {
      const mx = W - px, my = H - py;
      const ma = alpha * (combinedIntensity - 0.3);
      const mg = ctx.createRadialGradient(mx, my, 0, mx, my, r * 0.6);
      mg.addColorStop(0, `rgba(${orb.color[0]},${orb.color[1]},${orb.color[2]},${ma})`);
      mg.addColorStop(1, `rgba(${orb.color[0]},${orb.color[1]},${orb.color[2]},0)`);
      ctx.fillStyle = mg;
      ctx.fillRect(mx - r, my - r, r * 2, r * 2);
    }
  }

  // ── Layer 3: Interaction-specific effects during overlap ──
  if (overlapIntensity > 0.2) {
    const effectStr = (overlapIntensity - 0.2) * synergyBoost;

    if (interaction.type === 'synergy') {
      // Synergy: pulsing rings that expand from center, more chaotic
      const numRings = Math.floor(4 + combined.visuals * 3);
      for (let i = 0; i < numRings; i++) {
        const rp = (time * 0.7 + i * 0.6) % 3 / 3;
        const rr = rp * W * 0.55;
        const rf = (1 - rp) * effectStr;
        const rc = lerpColor(rgb1, rgb2, (Math.sin(time * 0.4 + i) + 1) * 0.5);
        ctx.beginPath();
        ctx.arc(W * 0.5, H * 0.45, rr, 0, Math.PI * 2);
        ctx.strokeStyle = `rgba(${rc[0]},${rc[1]},${rc[2]},${rf * 0.3})`;
        ctx.lineWidth = 2 + effectStr * 4;
        ctx.stroke();
      }
    }

    if (interaction.type === 'antagonism') {
      // Antagonism: fragmenting/dissolving effect — dashed arcs that break apart
      ctx.setLineDash([4 + effectStr * 10, 8 + effectStr * 15]);
      for (let i = 0; i < 6; i++) {
        const angle = time * 0.3 + i * Math.PI / 3;
        const r = 50 + i * 30 * effectStr;
        ctx.beginPath();
        ctx.arc(W * 0.5, H * 0.45, r, angle, angle + Math.PI * 0.8);
        const fc = lerpColor(rgb1, rgb2, 0.5);
        ctx.strokeStyle = `rgba(${fc[0]},${fc[1]},${fc[2]},${effectStr * 0.15})`;
        ctx.lineWidth = 1.5;
        ctx.stroke();
      }
      ctx.setLineDash([]);
    }

    // Geometric overlay for high combined visuals
    if (combinedIntensity > 0.5 && combined.visuals > 4) {
      const geoAlpha = (combinedIntensity - 0.5) * 0.15;
      const sides = Math.max(d1.flower.petalCount, d2.flower.petalCount);
      const layers = 4;
      for (let l = 0; l < layers; l++) {
        const lr = 60 + l * (40 + combinedIntensity * 40);
        const rot = time * 0.25 * (l % 2 === 0 ? 1 : -1);
        ctx.beginPath();
        for (let s = 0; s <= sides; s++) {
          const a = (Math.PI * 2 / sides) * s + rot;
          const wobble = Math.sin(time * 1.2 + s * 0.9 + l) * combinedIntensity * 10;
          const x = W * 0.5 + Math.cos(a) * (lr + wobble);
          const y = H * 0.45 + Math.sin(a) * (lr + wobble);
          if (s === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        }
        ctx.closePath();
        const gc = lerpColor(rgb1, rgb2, (l / layers + Math.sin(time * 0.3)) * 0.5 + 0.25);
        ctx.strokeStyle = `rgba(${gc[0]},${gc[1]},${gc[2]},${geoAlpha})`;
        ctx.lineWidth = 1 + combinedIntensity * 1.5;
        ctx.stroke();
      }
    }
  }

  // ── Layer 5: Vignette ──
  ctx.globalCompositeOperation = 'source-over';
  const vigGrd = ctx.createRadialGradient(W * 0.5, H * 0.45, W * 0.18, W * 0.5, H * 0.5, W * 0.72);
  vigGrd.addColorStop(0, `rgba(${dark[0]},${dark[1]},${dark[2]},0)`);
  vigGrd.addColorStop(1, `rgba(${dark[0]},${dark[1]},${dark[2]},${0.5 + (1 - combinedIntensity) * 0.4})`);
  ctx.fillStyle = vigGrd;
  ctx.fillRect(0, 0, W, H);
}

// ─── Compare mode event wiring ───
function setupCompareMode() {
  document.getElementById('compareBtn').addEventListener('click', () => {
    if (compareMode) exitCompareMode();
    else enterCompareMode();
  });
  document.getElementById('compareCancel').addEventListener('click', exitCompareMode);
  document.getElementById('compareGo').addEventListener('click', openCompare);
  document.getElementById('closeCompare').addEventListener('click', closeCompare);

  document.getElementById('comparePlayPause').addEventListener('click', () => {
    if (!compareState) return;
    compareState.playing = !compareState.playing;
    document.getElementById('comparePlayPause').innerHTML = compareState.playing ? '&#9646;&#9646;' : '&#9654;';
    if (compareState.playing) {
      const progress = document.getElementById('compareTimeline').value / 1000;
      compareState.startTime = performance.now() - (progress * compareState.maxDur * 1000);
    }
  });

  document.getElementById('compareRestart').addEventListener('click', () => {
    if (!compareState) return;
    compareState.startTime = performance.now();
    compareState.playing = true;
    compareState.scrubbing = false;
    document.getElementById('comparePlayPause').innerHTML = '&#9646;&#9646;';
  });

  const tl = document.getElementById('compareTimeline');
  tl.addEventListener('input', () => {
    if (!compareState) return;
    compareState.scrubbing = true;
    const progress = tl.value / 1000;
    renderCompareFrame(progress, performance.now());
    document.getElementById('compareTimeLabel').textContent = formatTime(progress * compareState.maxDur);
  });
  tl.addEventListener('change', () => {
    if (!compareState) return;
    const progress = tl.value / 1000;
    compareState.startTime = performance.now() - (progress * compareState.maxDur * 1000);
    compareState.scrubbing = false;
  });

  document.getElementById('compareSoundBtn').addEventListener('click', () => {
    AudioEngine.toggleMute();
    updateSoundBtn('compareSoundBtn');
  });

  document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && compareState) closeCompare();
    if (e.key === 'm' && compareState) { AudioEngine.toggleMute(); updateSoundBtn('compareSoundBtn'); }
  });
}

// ─── Search ───
function setupSearch() {
  const input = document.getElementById('searchBar');
  input.addEventListener('input', () => {
    const q = input.value.trim().toLowerCase();
    const cards = document.querySelectorAll('.card');
    const headers = document.querySelectorAll('.category-header');
    if (!q) {
      cards.forEach(c => c.style.display = '');
      headers.forEach(h => h.style.display = '');
      return;
    }
    cards.forEach(c => {
      const label = c.querySelector('.label');
      const sub = c.querySelector('.sub-label');
      const name = (label ? label.textContent : '').toLowerCase();
      const subcat = (sub ? sub.textContent : '').toLowerCase();
      c.style.display = (name.includes(q) || subcat.includes(q)) ? '' : 'none';
    });
    headers.forEach(h => h.style.display = 'none');
  });
}

// ─── Random pair ───
function openRandomPair() {
  const all = getActiveDrugs();
  if (all.length < 2) return;
  const i = Math.floor(Math.random() * all.length);
  let j;
  do { j = Math.floor(Math.random() * all.length); } while (j === i);
  comparePicks = [{ drug: all[i] }, { drug: all[j] }];
  openCompare();
}

// ─── PsychonautWiki link helper ───
function getPWUrl(drug) {
  const name = drug.name.replace(/ /g, '_');
  return `https://psychonautwiki.org/wiki/${encodeURIComponent(name)}`;
}

// ─── URL hash routing ───
function handleHashRoute() {
  const hash = window.location.hash.slice(1);
  if (!hash) return;
  const all = getActiveDrugs();
  if (hash.includes('+')) {
    const [id1, id2] = hash.split('+');
    const d1 = all.find(d => d.id === id1);
    const d2 = all.find(d => d.id === id2);
    if (d1 && d2) {
      comparePicks = [{ drug: d1 }, { drug: d2 }];
      openCompare();
    }
  } else {
    const drug = all.find(d => d.id === hash);
    if (drug) openSolo(drug);
  }
}

function setHash(val) {
  history.replaceState(null, '', val ? '#' + val : window.location.pathname);
}

// ─── Dose slider ───
let currentDose = 2; // 1=low, 2=medium, 3=high

function setupDoseSlider() {
  const slider = document.getElementById('doseSlider');
  const label = document.getElementById('doseLabel');
  slider.addEventListener('input', () => {
    currentDose = parseFloat(slider.value);
    if (currentDose <= 1.5) label.textContent = 'Low';
    else if (currentDose <= 2.5) label.textContent = 'Medium';
    else label.textContent = 'High';
  });
}

function getDoseMultiplier() {
  // Returns a multiplier: 0.5 (low) to 1.5 (high)
  return 0.25 + (currentDose - 1) * 0.625;
}

function applyDose(baseDrug, mult) {
  if (mult === 1) return baseDrug;
  const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));
  return {
    ...baseDrug,
    duration: {
      onset: baseDrug.duration.onset * (1 + (mult - 1) * 0.3),
      comeUp: baseDrug.duration.comeUp * (1 + (mult - 1) * 0.3),
      peak: baseDrug.duration.peak * mult,
      offset: baseDrug.duration.offset * (1 + (mult - 1) * 0.4),
      afterEffects: baseDrug.duration.afterEffects * (1 + (mult - 1) * 0.5),
    },
    effects: {
      cognitiveComplexity: clamp(Math.round(baseDrug.effects.cognitiveComplexity * mult), 1, 10),
      euphoria: clamp(Math.round(baseDrug.effects.euphoria * mult), 0, 10),
      intensity: clamp(Math.round(baseDrug.effects.intensity * mult), 1, 10),
      bodyLoad: clamp(Math.round(baseDrug.effects.bodyLoad * mult), 0, 10),
      egoDissolve: clamp(Math.round(baseDrug.effects.egoDissolve * mult), 0, 10),
      visuals: clamp(Math.round(baseDrug.effects.visuals * mult), 0, 10),
    },
    flower: {
      ...baseDrug.flower,
      petalRadius: clamp(Math.round(baseDrug.flower.petalRadius * (0.7 + mult * 0.3)), 15, 55),
      centerSize: clamp(Math.round(baseDrug.flower.centerSize * (0.8 + mult * 0.2)), 3, 20),
    }
  };
}

// ─── Hybrid flower ───
function buildHybridDrug(drug1, drug2, interaction) {
  const blend = (a, b, w) => a * (1 - w) + b * w;
  const f1 = drug1.flower, f2 = drug2.flower;
  const e1 = drug1.effects, e2 = drug2.effects;
  const synergy = interaction.type === 'synergy' ? 1.2 : interaction.type === 'antagonism' ? 0.7 : 1.0;

  // Blend colors
  const rgb1 = hexToRgb(f1.primaryColor), rgb2 = hexToRgb(f2.primaryColor);
  const rgbS1 = hexToRgb(f1.secondaryColor), rgbS2 = hexToRgb(f2.secondaryColor);
  const blendRgb = (a, b) => '#' + [0,1,2].map(i => Math.round((a[i]+b[i])/2).toString(16).padStart(2,'0')).join('');

  return {
    id: drug1.id + '_' + drug2.id + '_hybrid',
    name: 'Hybrid',
    category: drug1.category,
    subcategory: 'Combined',
    duration: {
      onset: blend(drug1.duration.onset, drug2.duration.onset, 0.5),
      comeUp: blend(drug1.duration.comeUp, drug2.duration.comeUp, 0.5),
      peak: blend(drug1.duration.peak, drug2.duration.peak, 0.5) * synergy,
      offset: blend(drug1.duration.offset, drug2.duration.offset, 0.5),
      afterEffects: blend(drug1.duration.afterEffects, drug2.duration.afterEffects, 0.5),
    },
    effects: {
      cognitiveComplexity: Math.min(10, Math.round(blend(e1.cognitiveComplexity, e2.cognitiveComplexity, 0.5) * synergy)),
      euphoria: Math.min(10, Math.round(blend(e1.euphoria, e2.euphoria, 0.5) * synergy)),
      intensity: Math.min(10, Math.round(blend(e1.intensity, e2.intensity, 0.5) * synergy)),
      bodyLoad: Math.min(10, Math.round(blend(e1.bodyLoad, e2.bodyLoad, 0.5) * synergy)),
      egoDissolve: Math.min(10, Math.round(blend(e1.egoDissolve, e2.egoDissolve, 0.5) * synergy)),
      visuals: Math.min(10, Math.round(blend(e1.visuals, e2.visuals, 0.5) * synergy)),
    },
    flower: {
      petalCount: Math.round(blend(f1.petalCount, f2.petalCount, 0.5)),
      petalShape: f1.petalShape, // pick first drug's shape
      primaryColor: blendRgb(rgb1, rgb2),
      secondaryColor: blendRgb(rgbS1, rgbS2),
      petalRadius: Math.round(blend(f1.petalRadius, f2.petalRadius, 0.5) * synergy),
      centerSize: Math.round(blend(f1.centerSize, f2.centerSize, 0.5)),
      stemHeight: Math.round(blend(f1.stemHeight, f2.stemHeight, 0.5)),
    }
  };
}

function renderHybridFlower(drug1, drug2, interaction) {
  const container = document.getElementById('hybridFlower');
  container.innerHTML = '';
  const hybrid = buildHybridDrug(drug1, drug2, interaction);

  const svgNS = 'http://www.w3.org/2000/svg';
  const svg = document.createElementNS(svgNS, 'svg');
  svg.setAttribute('viewBox', '-80 -70 160 160');
  svg.setAttribute('xmlns', svgNS);
  addDefs(svg, hybrid);
  const g = document.createElementNS(svgNS, 'g');
  svg.appendChild(g);

  const label = document.createElement('div');
  label.className = 'hybrid-label';
  label.textContent = 'Hybrid';

  container.appendChild(svg);
  container.appendChild(label);

  return { hybrid, g };
}

// ─── Duration / phase helpers ───
function getTotalDuration(drug) {
  const d = drug.duration;
  return d.onset + d.comeUp + d.peak + d.offset + d.afterEffects;
}

function getPhaseInfo(drug, progress) {
  const d = drug.duration;
  const total = getTotalDuration(drug);
  const t = progress * total;
  let acc = 0;
  const phases = [
    { name: 'Onset', dur: d.onset },
    { name: 'Come Up', dur: d.comeUp },
    { name: 'Peak', dur: d.peak },
    { name: 'Offset', dur: d.offset },
    { name: 'After Effects', dur: d.afterEffects },
  ];
  for (const p of phases) {
    if (t < acc + p.dur + 0.0001) {
      return { name: p.name, phaseProgress: p.dur > 0 ? Math.max(0, (t - acc) / p.dur) : 0 };
    }
    acc += p.dur;
  }
  return { name: 'After Effects', phaseProgress: 1 };
}

function updatePhaseLabel(drug, progress) {
  const el = document.getElementById('phaseIndicator');
  if (progress <= 0.001) { el.textContent = 'Seed'; return; }
  const { name, phaseProgress } = getPhaseInfo(drug, progress);
  el.textContent = `${name} (${Math.round(phaseProgress * 100)}%)`;
}

function updateTimeLabels(drug, progress) {
  document.getElementById('timeLabel').textContent = formatTime(progress * getTotalDuration(drug));
}

function formatTime(hours) {
  const h = Math.floor(hours);
  const m = Math.round((hours - h) * 60);
  return `${h}h ${m.toString().padStart(2, '0')}m`;
}

// ─── SVG defs (gradients + glow filter) ───
function addDefs(svg, drug) {
  const svgNS = 'http://www.w3.org/2000/svg';
  const defs = document.createElementNS(svgNS, 'defs');

  const grad = document.createElementNS(svgNS, 'radialGradient');
  grad.id = `grad-${drug.id}`;
  grad.setAttribute('cx', '30%');
  grad.setAttribute('cy', '30%');
  grad.setAttribute('r', '70%');
  const stop1 = document.createElementNS(svgNS, 'stop');
  stop1.setAttribute('offset', '0%');
  stop1.setAttribute('stop-color', drug.flower.secondaryColor);
  const stop2 = document.createElementNS(svgNS, 'stop');
  stop2.setAttribute('offset', '100%');
  stop2.setAttribute('stop-color', drug.flower.primaryColor);
  grad.appendChild(stop1);
  grad.appendChild(stop2);
  defs.appendChild(grad);

  const filter = document.createElementNS(svgNS, 'filter');
  filter.id = `glow-${drug.id}`;
  filter.setAttribute('x', '-50%');
  filter.setAttribute('y', '-50%');
  filter.setAttribute('width', '200%');
  filter.setAttribute('height', '200%');
  filter.innerHTML = '<feGaussianBlur stdDeviation="4" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>';
  defs.appendChild(filter);

  svg.appendChild(defs);
}

// ─── Petal path generators (all curves, no sharp corners) ───
function petalPath(shape, r) {
  switch (shape) {
    case 'rounded':
      // Soft, full teardrop
      return `M0,0 C${r*0.45},-${r*0.2} ${r*0.5},-${r*0.6} 0,-${r} C-${r*0.5},-${r*0.6} -${r*0.45},-${r*0.2} 0,0Z`;
    case 'pointed':
      // Narrow but with smooth curves instead of straight lines
      return `M0,0 C${r*0.22},-${r*0.12} ${r*0.24},-${r*0.35} ${r*0.14},-${r*0.55} C${r*0.08},-${r*0.72} ${r*0.03},-${r*0.88} 0,-${r} C-${r*0.03},-${r*0.88} -${r*0.08},-${r*0.72} -${r*0.14},-${r*0.55} C-${r*0.24},-${r*0.35} -${r*0.22},-${r*0.12} 0,0Z`;
    case 'wavy': {
      // Psychedelic flowing petal — wide, organic S-curves with rounded tip
      return `M0,0 C${r*0.5},-${r*0.1} ${r*0.52},-${r*0.3} ${r*0.35},-${r*0.45} C${r*0.18},-${r*0.58} ${r*0.28},-${r*0.72} ${r*0.15},-${r*0.85} C${r*0.08},-${r*0.94} ${r*0.02},-${r} 0,-${r} C-${r*0.02},-${r} -${r*0.08},-${r*0.94} -${r*0.15},-${r*0.85} C-${r*0.28},-${r*0.72} -${r*0.18},-${r*0.58} -${r*0.35},-${r*0.45} C-${r*0.52},-${r*0.3} -${r*0.5},-${r*0.1} 0,0Z`;
    }
    case 'wispy':
      // Ethereal, hollow, cloud-like — wide in middle, pinched at base and tip
      return `M0,0 C${r*0.5},-${r*0.15} ${r*0.55},-${r*0.4} ${r*0.35},-${r*0.55} C${r*0.2},-${r*0.65} ${r*0.15},-${r*0.82} 0,-${r} C-${r*0.15},-${r*0.82} -${r*0.2},-${r*0.65} -${r*0.35},-${r*0.55} C-${r*0.55},-${r*0.4} -${r*0.5},-${r*0.15} 0,0Z`;
    default:
      return petalPath('rounded', r);
  }
}

// ─── Generative Audio Engine ───
const AudioEngine = (() => {
  let ctx = null;
  let masterGain = null;
  let nodes = {};   // active audio nodes
  let active = false;
  let muted = true; // start muted

  function getCtx() {
    if (!ctx) {
      ctx = new (window.AudioContext || window.webkitAudioContext)();
      masterGain = ctx.createGain();
      masterGain.gain.value = 0;
      masterGain.connect(ctx.destination);
    }
    if (ctx.state === 'suspended') ctx.resume();
    return ctx;
  }

  // Drug category → base frequency and character
  function getDrugTuning(drug) {
    const cat = drug.category;
    const map = {
      'Psychedelics':   { baseFreq: 220,  waveform: 'sine',     filterQ: 8,  detuneRange: 15, reverbMix: 0.6 },
      'Stimulants':     { baseFreq: 330,  waveform: 'sawtooth', filterQ: 3,  detuneRange: 5,  reverbMix: 0.2 },
      'Depressants':    { baseFreq: 110,  waveform: 'sine',     filterQ: 2,  detuneRange: 3,  reverbMix: 0.5 },
      'Opioids':        { baseFreq: 130,  waveform: 'sine',     filterQ: 1,  detuneRange: 2,  reverbMix: 0.7 },
      'Dissociatives':  { baseFreq: 185,  waveform: 'triangle', filterQ: 6,  detuneRange: 25, reverbMix: 0.8 },
      'Entactogens':    { baseFreq: 262,  waveform: 'sine',     filterQ: 4,  detuneRange: 8,  reverbMix: 0.5 },
      'Cannabinoids':   { baseFreq: 165,  waveform: 'sine',     filterQ: 2,  detuneRange: 4,  reverbMix: 0.4 },
      'Deliriants':     { baseFreq: 98,   waveform: 'sawtooth', filterQ: 10, detuneRange: 40, reverbMix: 0.7 },
      'Nootropics':     { baseFreq: 392,  waveform: 'sine',     filterQ: 1,  detuneRange: 2,  reverbMix: 0.1 },
      'Hallucinogens':  { baseFreq: 196,  waveform: 'triangle', filterQ: 5,  detuneRange: 20, reverbMix: 0.6 },
    };
    return map[cat] || map['Depressants'];
  }

  // Build audio graph for a drug
  function buildGraph(drug, prefix) {
    const ac = getCtx();
    const tuning = getDrugTuning(drug);
    const n = {};

    // Main drone oscillator
    n.osc1 = ac.createOscillator();
    n.osc1.type = tuning.waveform;
    n.osc1.frequency.value = tuning.baseFreq;

    // Harmony oscillator (fifth above)
    n.osc2 = ac.createOscillator();
    n.osc2.type = tuning.waveform;
    n.osc2.frequency.value = tuning.baseFreq * 1.498; // slightly detuned fifth

    // Sub bass
    n.osc3 = ac.createOscillator();
    n.osc3.type = 'sine';
    n.osc3.frequency.value = tuning.baseFreq * 0.5;

    // Shimmer oscillator (octave up, detuned)
    n.osc4 = ac.createOscillator();
    n.osc4.type = 'sine';
    n.osc4.frequency.value = tuning.baseFreq * 2.01;

    // LFO for tremolo / movement
    n.lfo = ac.createOscillator();
    n.lfo.type = 'sine';
    n.lfo.frequency.value = 0.3;
    n.lfoGain = ac.createGain();
    n.lfoGain.gain.value = 0;
    n.lfo.connect(n.lfoGain);

    // Gains for each osc
    n.gain1 = ac.createGain(); n.gain1.gain.value = 0;
    n.gain2 = ac.createGain(); n.gain2.gain.value = 0;
    n.gain3 = ac.createGain(); n.gain3.gain.value = 0;
    n.gain4 = ac.createGain(); n.gain4.gain.value = 0;

    // Filter
    n.filter = ac.createBiquadFilter();
    n.filter.type = 'lowpass';
    n.filter.frequency.value = 200;
    n.filter.Q.value = tuning.filterQ;

    // Convolver-free reverb approximation: feedback delay
    n.delay = ac.createDelay(1.0);
    n.delay.delayTime.value = 0.3;
    n.feedback = ac.createGain();
    n.feedback.gain.value = tuning.reverbMix * 0.5;
    n.delayGain = ac.createGain();
    n.delayGain.gain.value = tuning.reverbMix;

    // Master for this voice
    n.voiceGain = ac.createGain();
    n.voiceGain.gain.value = 0;

    // Connect: oscs → gains → filter → voiceGain → masterGain
    n.osc1.connect(n.gain1);
    n.osc2.connect(n.gain2);
    n.osc3.connect(n.gain3);
    n.osc4.connect(n.gain4);

    // LFO modulates osc1 gain for tremolo
    n.lfoGain.connect(n.gain1.gain);

    [n.gain1, n.gain2, n.gain3, n.gain4].forEach(g => g.connect(n.filter));

    n.filter.connect(n.voiceGain);

    // Delay feedback loop
    n.filter.connect(n.delay);
    n.delay.connect(n.feedback);
    n.feedback.connect(n.delay);
    n.delay.connect(n.delayGain);
    n.delayGain.connect(n.voiceGain);

    n.voiceGain.connect(masterGain);

    // Start oscillators
    n.osc1.start();
    n.osc2.start();
    n.osc3.start();
    n.osc4.start();
    n.lfo.start();

    n.tuning = tuning;
    n.drug = drug;

    nodes[prefix] = n;
    return n;
  }

  function start(drug, prefix = 'solo') {
    getCtx();
    if (nodes[prefix]) stop(prefix);
    buildGraph(drug, prefix);
    active = true;
    if (!muted) masterGain.gain.setTargetAtTime(0.35, ctx.currentTime, 0.3);
  }

  function startDual(drug1, drug2) {
    getCtx();
    stop('comp0'); stop('comp1');
    buildGraph(drug1, 'comp0');
    buildGraph(drug2, 'comp1');
    active = true;
    if (!muted) masterGain.gain.setTargetAtTime(0.3, ctx.currentTime, 0.3);
  }

  function stop(prefix) {
    const n = nodes[prefix];
    if (!n) return;
    try {
      [n.osc1, n.osc2, n.osc3, n.osc4, n.lfo].forEach(o => { try { o.stop(); } catch(e){} });
    } catch(e) {}
    delete nodes[prefix];
  }

  function stopAll() {
    Object.keys(nodes).forEach(stop);
    active = false;
    if (masterGain) masterGain.gain.setTargetAtTime(0, ctx.currentTime, 0.1);
  }

  function toggleMute() {
    muted = !muted;
    if (!ctx) return muted;
    if (muted) {
      masterGain.gain.setTargetAtTime(0, ctx.currentTime, 0.3);
    } else {
      masterGain.gain.setTargetAtTime(0.35, ctx.currentTime, 0.3);
    }
    return muted;
  }

  function isMuted() { return muted; }

  // Update audio parameters based on trip progress
  function update(drug, progress, prefix = 'solo') {
    const n = nodes[prefix];
    if (!n || !ctx) return;

    const t = ctx.currentTime;
    const tuning = n.tuning;
    const d = drug.duration;
    const total = getTotalDuration(drug);
    const elapsed = progress * total;
    const visuals = drug.effects.visuals / 10;
    const intensity = drug.effects.intensity / 10;
    const bodyLoad = drug.effects.bodyLoad / 10;
    const ego = drug.effects.egoDissolve / 10;

    let volume = 0;
    let filterFreq = 200;
    let harmonyVol = 0;
    let subVol = 0;
    let shimmerVol = 0;
    let detuneAmt = 0;
    let lfoSpeed = 0.3;
    let lfoDepth = 0;
    let delayFeedback = tuning.reverbMix * 0.3;

    let acc = 0;

    // Onset: low drone barely audible
    if (elapsed <= d.onset) {
      const p = d.onset > 0 ? elapsed / d.onset : 1;
      volume = p * 0.15;
      filterFreq = 150 + p * 100;
      subVol = p * 0.1;
    }
    // Come up: growing, filter opening, harmonics appearing
    else if (elapsed <= (acc = d.onset) + d.comeUp) {
      const p = (elapsed - acc) / d.comeUp;
      volume = 0.15 + p * 0.35;
      filterFreq = 250 + p * 600;
      harmonyVol = p * 0.15;
      subVol = 0.1 + p * 0.1;
      detuneAmt = p * tuning.detuneRange * 0.5;
      lfoDepth = p * 3;
    }
    // Peak: full richness, all harmonics, shimmer, wide filter
    else if (elapsed <= (acc = d.onset + d.comeUp) + d.peak) {
      const p = (elapsed - acc) / d.peak;
      volume = 0.5 + Math.sin(p * Math.PI) * 0.15 * intensity;
      filterFreq = 800 + visuals * 1200 + Math.sin(p * Math.PI * 3) * 200;
      harmonyVol = 0.15 + visuals * 0.12;
      subVol = 0.2;
      shimmerVol = visuals * 0.1 * (0.5 + Math.sin(p * Math.PI) * 0.5);
      detuneAmt = tuning.detuneRange * (0.5 + ego * 0.5);
      lfoSpeed = 0.5 + bodyLoad * 0.8;
      lfoDepth = 5 + bodyLoad * 8;
      delayFeedback = tuning.reverbMix * (0.4 + ego * 0.3);
    }
    // Offset: fading, filter closing
    else if (elapsed <= (acc = d.onset + d.comeUp + d.peak) + d.offset) {
      const p = (elapsed - acc) / d.offset;
      volume = 0.5 * (1 - p * 0.5);
      filterFreq = 800 * (1 - p * 0.6) + 150;
      harmonyVol = 0.15 * (1 - p);
      subVol = 0.2 * (1 - p * 0.5);
      shimmerVol = 0;
      detuneAmt = tuning.detuneRange * 0.3 * (1 - p);
      lfoDepth = 3 * (1 - p);
    }
    // After effects: minimal, fading to silence
    else {
      acc = d.onset + d.comeUp + d.peak + d.offset;
      const p = d.afterEffects > 0 ? Math.min((elapsed - acc) / d.afterEffects, 1) : 1;
      volume = 0.25 * (1 - p);
      filterFreq = 200 + 100 * (1 - p);
      subVol = 0.1 * (1 - p);
    }

    // Apply parameters with smooth ramps
    const ramp = 0.15;
    n.voiceGain.gain.setTargetAtTime(volume, t, ramp);
    n.filter.frequency.setTargetAtTime(Math.max(80, filterFreq), t, ramp);
    n.gain1.gain.setTargetAtTime(0.2, t, ramp);
    n.gain2.gain.setTargetAtTime(harmonyVol, t, ramp);
    n.gain3.gain.setTargetAtTime(subVol, t, ramp);
    n.gain4.gain.setTargetAtTime(shimmerVol, t, ramp);
    n.osc1.detune.setTargetAtTime(detuneAmt, t, ramp);
    n.osc2.detune.setTargetAtTime(-detuneAmt * 0.7, t, ramp);
    n.osc4.detune.setTargetAtTime(detuneAmt * 1.5, t, ramp);
    n.lfo.frequency.setTargetAtTime(lfoSpeed, t, ramp);
    n.lfoGain.gain.setTargetAtTime(lfoDepth, t, ramp);
    n.feedback.gain.setTargetAtTime(Math.min(0.85, delayFeedback), t, ramp);
  }

  return { start, startDual, stop, stopAll, toggleMute, isMuted, update };
})();

// ─── Easing ───
function easeInOut(t) { return t < 0.5 ? 2*t*t : 1-Math.pow(-2*t+2,2)/2; }

// ─── Color helpers ───
function hexToRgb(hex) {
  const v = parseInt(hex.replace('#', ''), 16);
  return [(v >> 16) & 255, (v >> 8) & 255, v & 255];
}

function lerpColor(a, b, t) {
  return [
    Math.round(a[0] + (b[0] - a[0]) * t),
    Math.round(a[1] + (b[1] - a[1]) * t),
    Math.round(a[2] + (b[2] - a[2]) * t),
  ];
}

// ─── Solo hallucination background system ───
let hallucinationOrbs = [];

function initHallucinationOrbs(drug) {
  hallucinationOrbs = [];
  const count = 12 + drug.effects.visuals * 4; // more orbs for high-visual drugs
  const primaryRgb = hexToRgb(drug.flower.primaryColor);
  const accentRgb = hexToRgb(drug.flower.secondaryColor);

  for (let i = 0; i < count; i++) {
    const t = i / count;
    const color = lerpColor(primaryRgb, accentRgb, Math.random());
    hallucinationOrbs.push({
      x: Math.random(),
      y: Math.random(),
      baseR: 30 + Math.random() * 120,
      speed: 0.15 + Math.random() * 0.35,
      phase: Math.random() * Math.PI * 2,
      driftX: (Math.random() - 0.5) * 0.4,
      driftY: (Math.random() - 0.5) * 0.3,
      color,
      // Some orbs are "fractal echoes" — they mirror/rotate
      mirror: Math.random() > 0.6,
      rotSpeed: (Math.random() - 0.5) * 0.5,
    });
  }
}

function getHallucinationIntensity(drug, progress) {
  const d = drug.duration;
  const total = getTotalDuration(drug);
  const t = progress * total;
  const visuals = drug.effects.visuals / 10;
  let intensity = 0;
  let acc = 0;

  if (t <= d.onset) {
    intensity = 0;
  } else if (t <= (acc = d.onset) + d.comeUp) {
    const p = (t - acc) / d.comeUp;
    intensity = easeInOut(p) * 0.45;
  } else if (t <= (acc = d.onset + d.comeUp) + d.peak) {
    const p = (t - acc) / d.peak;
    intensity = 0.45 + Math.sin(p * Math.PI) * 0.55;
  } else if (t <= (acc = d.onset + d.comeUp + d.peak) + d.offset) {
    const p = (t - acc) / d.offset;
    intensity = (1 - easeInOut(p)) * 0.45;
  } else {
    acc = d.onset + d.comeUp + d.peak + d.offset;
    const p = d.afterEffects > 0 ? Math.min((t - acc) / d.afterEffects, 1) : 1;
    intensity = (1 - p) * 0.08;
  }

  return intensity * visuals;
}

function updateSoloBackground(drug, progress, now) {
  const canvas = document.getElementById('hallucinationCanvas');
  const ctx = canvas.getContext('2d');
  const W = canvas.width;
  const H = canvas.height;
  const time = now / 1000;
  const visuals = drug.effects.visuals / 10;
  const intensity = getHallucinationIntensity(drug, progress);

  const dark = [15, 15, 26];
  const drugRgb = hexToRgb(drug.flower.primaryColor);
  const drugAccent = hexToRgb(drug.flower.secondaryColor);

  // Clear to dark base
  ctx.globalCompositeOperation = 'source-over';
  ctx.fillStyle = `rgb(${dark[0]},${dark[1]},${dark[2]})`;
  ctx.fillRect(0, 0, W, H);

  if (intensity < 0.005) return;

  // ── Layer 1: Deep ambient color wash — dual moving gradients ──
  const washHueShift = Math.sin(time * 0.3) * 0.5;
  const washColor = lerpColor(drugRgb, drugAccent, 0.5 + washHueShift);
  const washColor2 = lerpColor(drugAccent, drugRgb, 0.3 + Math.cos(time * 0.25) * 0.4);
  const washAlpha = intensity * 0.35;

  // Primary wash
  const grd = ctx.createRadialGradient(
    W * (0.5 + Math.sin(time * 0.2) * 0.25),
    H * (0.45 + Math.cos(time * 0.15) * 0.15),
    0,
    W * 0.5, H * 0.5, W * 0.7
  );
  grd.addColorStop(0, `rgba(${washColor[0]},${washColor[1]},${washColor[2]},${washAlpha})`);
  grd.addColorStop(1, `rgba(${dark[0]},${dark[1]},${dark[2]},0)`);
  ctx.fillStyle = grd;
  ctx.fillRect(0, 0, W, H);

  // Secondary counter-moving wash
  const grd2 = ctx.createRadialGradient(
    W * (0.5 - Math.sin(time * 0.17) * 0.3),
    H * (0.55 - Math.cos(time * 0.22) * 0.2),
    0,
    W * 0.5, H * 0.5, W * 0.6
  );
  grd2.addColorStop(0, `rgba(${washColor2[0]},${washColor2[1]},${washColor2[2]},${washAlpha * 0.6})`);
  grd2.addColorStop(1, `rgba(${dark[0]},${dark[1]},${dark[2]},0)`);
  ctx.fillStyle = grd2;
  ctx.fillRect(0, 0, W, H);

  // ── Layer 2: Floating orbs with soft glow ──
  ctx.globalCompositeOperation = 'screen';

  for (const orb of hallucinationOrbs) {
    // Animate position — slow organic drift
    const ox = ((orb.x + orb.driftX * time * orb.speed * 0.1) % 1.4) - 0.2;
    const oy = ((orb.y + orb.driftY * time * orb.speed * 0.1) % 1.4) - 0.2;
    const px = ox * W;
    const py = oy * H;

    // Size pulses with intensity
    const sizePulse = 1 + Math.sin(time * orb.speed * 2 + orb.phase) * 0.3 * intensity;
    const r = orb.baseR * intensity * sizePulse;

    if (r < 1) continue;

    const alpha = intensity * (0.25 + Math.sin(time * orb.speed + orb.phase) * 0.12);

    const g2 = ctx.createRadialGradient(px, py, 0, px, py, r);
    g2.addColorStop(0, `rgba(${orb.color[0]},${orb.color[1]},${orb.color[2]},${alpha})`);
    g2.addColorStop(0.5, `rgba(${orb.color[0]},${orb.color[1]},${orb.color[2]},${alpha * 0.3})`);
    g2.addColorStop(1, `rgba(${orb.color[0]},${orb.color[1]},${orb.color[2]},0)`);
    ctx.fillStyle = g2;
    ctx.fillRect(px - r, py - r, r * 2, r * 2);

    // Mirror echo for high-intensity
    if (orb.mirror && intensity > 0.3) {
      const mx = W - px;
      const my = H - py;
      const mirrorAlpha = alpha * (intensity - 0.3) * 1.5;
      const g3 = ctx.createRadialGradient(mx, my, 0, mx, my, r * 0.7);
      g3.addColorStop(0, `rgba(${orb.color[0]},${orb.color[1]},${orb.color[2]},${mirrorAlpha})`);
      g3.addColorStop(1, `rgba(${orb.color[0]},${orb.color[1]},${orb.color[2]},0)`);
      ctx.fillStyle = g3;
      ctx.fillRect(mx - r, my - r, r * 2, r * 2);
    }
  }

  // ── Layer 3: Concentric ripples ──
  if (intensity > 0.2) {
    const rippleAlpha = (intensity - 0.2) * 0.8;
    const numRings = Math.floor(4 + visuals * 8);
    ctx.globalCompositeOperation = 'screen';
    for (let i = 0; i < numRings; i++) {
      const ringPhase = time * 0.8 + i * 0.5;
      const ringProgress = (ringPhase % 3) / 3;
      const ringR = ringProgress * W * 0.7;
      const ringFade = 1 - ringProgress;

      ctx.beginPath();
      ctx.arc(W * 0.5, H * 0.45, ringR, 0, Math.PI * 2);
      const ringColor = lerpColor(drugRgb, drugAccent, (i / numRings + Math.sin(time * 0.4)) * 0.5 + 0.25);
      ctx.strokeStyle = `rgba(${ringColor[0]},${ringColor[1]},${ringColor[2]},${rippleAlpha * ringFade * 0.35})`;
      ctx.lineWidth = 2 + intensity * 4;
      ctx.stroke();
    }
  }

  // ── Layer 3b: Flowing color trails (psychedelic streaks) ──
  if (intensity > 0.25 && visuals > 0.3) {
    const trailAlpha = (intensity - 0.25) * visuals * 0.4;
    ctx.globalCompositeOperation = 'screen';
    for (let t2 = 0; t2 < 6; t2++) {
      const trailPhase = t2 * 1.05 + time * 0.4;
      const cx2 = W * (0.3 + 0.4 * Math.sin(trailPhase * 0.7));
      const cy2 = H * (0.3 + 0.4 * Math.cos(trailPhase * 0.5));
      const trailColor = lerpColor(drugRgb, drugAccent, (t2 / 6 + Math.sin(time * 0.3 + t2)) * 0.5 + 0.25);
      const trailR = 30 + intensity * 80 + Math.sin(time * 1.2 + t2) * 20;

      const tg = ctx.createRadialGradient(cx2, cy2, 0, cx2, cy2, trailR);
      tg.addColorStop(0, `rgba(${trailColor[0]},${trailColor[1]},${trailColor[2]},${trailAlpha * 0.5})`);
      tg.addColorStop(0.6, `rgba(${trailColor[0]},${trailColor[1]},${trailColor[2]},${trailAlpha * 0.15})`);
      tg.addColorStop(1, `rgba(${trailColor[0]},${trailColor[1]},${trailColor[2]},0)`);
      ctx.fillStyle = tg;
      ctx.fillRect(cx2 - trailR, cy2 - trailR, trailR * 2, trailR * 2);
    }
  }

  // ── Layer 4: Geometric patterns ──
  if (intensity > 0.35 && visuals > 0.3) {
    const geoAlpha = (intensity - 0.35) * 1.2 * visuals;
    const cx = W * 0.5;
    const cy = H * 0.45;
    const sides = drug.flower.petalCount;
    const layers = 4 + Math.floor(visuals * 6);

    ctx.globalCompositeOperation = 'screen';

    for (let layer = 0; layer < layers; layer++) {
      const layerR = 40 + layer * (30 + intensity * 50);
      const rot = time * 0.3 * (layer % 2 === 0 ? 1 : -1) + layer * 0.4;
      const layerAlpha = geoAlpha * (1 - layer / layers) * 0.18;

      ctx.beginPath();
      for (let i = 0; i <= sides; i++) {
        const angle = (Math.PI * 2 / sides) * i + rot;
        const wobble = Math.sin(time * 1.5 + i * 1.1 + layer) * intensity * 8;
        const x = cx + Math.cos(angle) * (layerR + wobble);
        const y = cy + Math.sin(angle) * (layerR + wobble);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.closePath();
      const geoColor = lerpColor(drugRgb, drugAccent, (layer / layers + Math.sin(time * 0.5)) * 0.5 + 0.25);
      ctx.strokeStyle = `rgba(${geoColor[0]},${geoColor[1]},${geoColor[2]},${layerAlpha})`;
      ctx.lineWidth = 1 + intensity * 2;
      ctx.stroke();
    }

    // Connecting lines between layers (sacred geometry feel)
    if (intensity > 0.5 && visuals > 0.4) {
      const connectAlpha = (intensity - 0.5) * visuals * 0.18;
      for (let i = 0; i < sides; i++) {
        const angle = (Math.PI * 2 / sides) * i + time * 0.2;
        const x1 = cx + Math.cos(angle) * 40;
        const y1 = cy + Math.sin(angle) * 40;
        const x2 = cx + Math.cos(angle) * (40 + layers * (30 + intensity * 50));
        const y2 = cy + Math.sin(angle) * (40 + layers * (30 + intensity * 50));
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.strokeStyle = `rgba(${drugAccent[0]},${drugAccent[1]},${drugAccent[2]},${connectAlpha})`;
        ctx.lineWidth = 0.8;
        ctx.stroke();
      }
    }
  }

  // ── Layer 5: Color breathing / vignette ──
  ctx.globalCompositeOperation = 'source-over';
  const breathe = 0.5 + Math.sin(time * 1.2) * 0.15 * intensity;
  const vignetteGrd = ctx.createRadialGradient(W * 0.5, H * 0.45, W * 0.15, W * 0.5, H * 0.5, W * 0.75);
  vignetteGrd.addColorStop(0, `rgba(${dark[0]},${dark[1]},${dark[2]},0)`);
  vignetteGrd.addColorStop(1, `rgba(${dark[0]},${dark[1]},${dark[2]},${0.5 + (1 - intensity) * 0.4})`);
  ctx.fillStyle = vignetteGrd;
  ctx.fillRect(0, 0, W, H);
}

// ─── Card reactive background (hallucination intensity) ───
function updateCardBackground(card, drug, progress, now) {
  const d = drug.duration;
  const total = getTotalDuration(drug);
  const t = progress * total;
  const time = now / 1000;
  const visuals = drug.effects.visuals / 10; // 0–1

  // How intense are hallucinations right now?
  let intensity = 0;
  let acc = 0;

  if (t <= d.onset) {
    intensity = 0;
  } else if (t <= (acc = d.onset) + d.comeUp) {
    const p = (t - acc) / d.comeUp;
    intensity = easeInOut(p) * 0.5;
  } else if (t <= (acc = d.onset + d.comeUp) + d.peak) {
    const p = (t - acc) / d.peak;
    // Peaks with a sine bulge in the middle
    intensity = 0.5 + Math.sin(p * Math.PI) * 0.5;
  } else if (t <= (acc = d.onset + d.comeUp + d.peak) + d.offset) {
    const p = (t - acc) / d.offset;
    intensity = (1 - easeInOut(p)) * 0.5;
  } else {
    acc = d.onset + d.comeUp + d.peak + d.offset;
    const p = d.afterEffects > 0 ? Math.min((t - acc) / d.afterEffects, 1) : 1;
    intensity = (1 - p) * 0.08;
  }

  // Scale by the drug's visual effect rating
  intensity *= visuals;

  // Subtle pulse during peak for high-visuals drugs
  if (intensity > 0.3 && visuals > 0.5) {
    intensity += Math.sin(time * 2.5) * 0.06 * visuals;
  }

  const drugRgb = hexToRgb(drug.flower.primaryColor);
  const drugAccent = hexToRgb(drug.flower.secondaryColor);
  const base = [26, 26, 46]; // #1a1a2e

  // Blend the drug color into the card background proportional to intensity
  const mixed = lerpColor(drugRgb, drugAccent, 0.3);
  const glowAlpha = intensity * 0.35;

  const bgR = Math.min(255, Math.round(base[0] + mixed[0] * glowAlpha));
  const bgG = Math.min(255, Math.round(base[1] + mixed[1] * glowAlpha));
  const bgB = Math.min(255, Math.round(base[2] + mixed[2] * glowAlpha));

  // Radial glow from center, stronger at peak
  const glowSpread = 40 + intensity * 25; // % radius
  card.style.background =
    `radial-gradient(ellipse at 50% 40%, rgba(${bgR},${bgG},${bgB},1) 0%, rgba(${base[0]},${base[1]},${base[2]},1) ${glowSpread}%)`;

  // Also add a colored box-shadow glow for high-intensity moments
  if (intensity > 0.15) {
    const shadowAlpha = (intensity - 0.15) * 0.5;
    card.style.boxShadow = `0 0 ${Math.round(intensity * 30)}px rgba(${drugRgb[0]},${drugRgb[1]},${drugRgb[2]},${shadowAlpha.toFixed(2)})`;
  } else {
    card.style.boxShadow = '';
  }
}

// ─── Main flower renderer ───
function renderFlower(g, drug, progress, isSolo, now) {
  const f = drug.flower;
  const time = now / 1000;
  const d = drug.duration;
  const total = getTotalDuration(drug);
  const t = progress * total;

  // Animation state
  let bloomScale = 0;
  let stemGrow = 0;
  let colorOpacity = 1;
  let glowOn = false;
  let wiltAngle = 0;
  let opacityPulse = 1;

  let acc = 0;

  // petalSpread: 0 = closed bud, 1 = fully open, controls petal fan-out angle
  let petalSpread = 0;
  // petalDroop: extra downward rotation per petal during wilting
  let petalDroop = 0;
  // petalCurl: petals curl inward (negative) or outward (positive)
  let petalCurl = 0;

  // Phase: Onset — seed/bud, stem just starting
  if (t <= d.onset) {
    const p = d.onset > 0 ? easeInOut(t / d.onset) : 1;
    stemGrow = p * 0.3;
    bloomScale = p * 0.08;
    petalSpread = 0; // tight bud
    colorOpacity = 0.4 + p * 0.3;
  }
  // Phase: Come Up — petals unfurling, bloom opening
  else if (t <= (acc = d.onset) + d.comeUp) {
    const p = d.comeUp > 0 ? easeInOut((t - acc) / d.comeUp) : 1;
    stemGrow = 0.3 + p * 0.5;
    bloomScale = 0.08 + p * 0.55;
    petalSpread = p; // petals fan open from 0 to 1
    petalCurl = -0.3 * (1 - p); // slight inward curl at start, opening out
    colorOpacity = 0.7 + p * 0.3;
  }
  // Phase: Peak — full bloom, vibrant, alive
  else if (t <= (acc = d.onset + d.comeUp) + d.peak) {
    const p = d.peak > 0 ? (t - acc) / d.peak : 1;
    stemGrow = 0.8 + easeInOut(p) * 0.2;
    bloomScale = 0.63 + easeInOut(p) * 0.37;
    petalSpread = 1;
    petalCurl = 0.15 * Math.sin(p * Math.PI); // gentle outward bow at mid-peak
    glowOn = true;
    if (drug.effects.visuals > 4) {
      opacityPulse = 0.88 + Math.sin(time * (drug.effects.visuals * 0.7)) * 0.12;
    }
  }
  // Phase: Offset — wilting begins, petals drooping and closing
  else if (t <= (acc = d.onset + d.comeUp + d.peak) + d.offset) {
    const p = d.offset > 0 ? easeInOut((t - acc) / d.offset) : 1;
    stemGrow = 1 - p * 0.2;
    bloomScale = 1 - p * 0.3;
    petalSpread = 1 - p * 0.3; // petals start closing slightly
    petalDroop = p * 15; // petals droop gently
    petalCurl = -p * 0.3; // slight curl inward
    colorOpacity = 1 - p * 0.35;
    wiltAngle = p * 8;
  }
  // Phase: After Effects — full wilt, flower fading
  else {
    acc = d.onset + d.comeUp + d.peak + d.offset;
    const p = d.afterEffects > 0 ? easeInOut(Math.min((t - acc) / d.afterEffects, 1)) : 1;
    stemGrow = 0.8 - p * 0.35;
    bloomScale = 0.7 - p * 0.35;
    petalSpread = 0.7 - p * 0.4; // closing
    petalDroop = 15 + p * 25; // increasing droop
    petalCurl = -0.3 - p * 0.4; // curling in
    colorOpacity = 0.65 - p * 0.45;
    wiltAngle = 8 + p * 12;
  }

  // Scale for grid vs solo
  const sc = isSolo ? 1.0 : 0.6;
  const stemH = Math.max(f.stemHeight, 20) * sc * stemGrow;
  const petalR = f.petalRadius * sc * bloomScale;
  const centerR = f.centerSize * sc * bloomScale;

  // Wind + body load → organic sway
  const windBase = Math.sin(time * 0.4) * 0.6 + Math.sin(time * 2.3) * 0.3;
  const swayAmt = (drug.effects.bodyLoad * 0.2 + 1.2) * bloomScale;
  const sway = swayAmt * (Math.sin(time * 1.1) * 0.6 + windBase * 0.5);

  // Ego dissolution → center pulsation during peak
  const egoLevel = drug.effects.egoDissolve / 10;
  const egoExpand = glowOn ? (1 + egoLevel * 0.5 * (0.5 + 0.5 * Math.sin(time * 2.5))) : 1;

  // Clear and rebuild
  while (g.firstChild) g.removeChild(g.firstChild);
  const svgNS = 'http://www.w3.org/2000/svg';

  // Stem (curved path that bends with the wind)
  if (stemH > 1) {
    const stemBend = sway * 0.7;
    const stem = document.createElementNS(svgNS, 'path');
    stem.setAttribute('d',
      `M${sway * 0.3},0 C${sway * 0.3 + stemBend * 0.3},${stemH * 0.33} ${sway * 0.15 + stemBend * 0.15},${stemH * 0.66} ${sway * 0.1},${stemH}`);
    stem.setAttribute('stroke', '#2d5a27');
    stem.setAttribute('stroke-width', 2.2 * sc);
    stem.setAttribute('stroke-linecap', 'round');
    stem.setAttribute('fill', 'none');
    stem.setAttribute('opacity', Math.max(0.1, colorOpacity));
    g.appendChild(stem);

    // Leaves
    if (stemGrow > 0.35 && stemH > 10) {
      const addLeaf = (cx, cy, rx, ry, rot) => {
        const leaf = document.createElementNS(svgNS, 'ellipse');
        leaf.setAttribute('cx', cx);
        leaf.setAttribute('cy', cy);
        leaf.setAttribute('rx', rx);
        leaf.setAttribute('ry', ry);
        leaf.setAttribute('fill', '#3a7a32');
        leaf.setAttribute('opacity', Math.max(0.05, colorOpacity * 0.7));
        leaf.setAttribute('transform', `rotate(${rot}, ${cx}, ${cy})`);
        g.appendChild(leaf);
      };
      const ls = 5 * sc * Math.min(bloomScale + 0.3, 1);
      addLeaf(-ls * 1.2 + sway * 0.2, stemH * 0.55, ls, ls * 0.4, -35);
      addLeaf(ls * 1.1 + sway * 0.1, stemH * 0.35, ls * 0.85, ls * 0.35, 30);
    }
  }

  // Flower head
  const headG = document.createElementNS(svgNS, 'g');
  const headX = sway;
  // Wilt: head drops downward (positive Y) and tilts slightly
  const wiltDrop = wiltAngle * 0.5; // translate down proportional to wilt
  const wiltTilt = wiltAngle * 0.3; // gentle tilt, not full rotation
  headG.setAttribute('transform', `translate(${headX}, ${wiltDrop}) rotate(${wiltTilt + sway * 0.5})`);
  if (glowOn) headG.setAttribute('filter', `url(#glow-${drug.id})`);

  // Petals — each petal gets its own wind-driven sway, scale breathing, and bend
  if (petalR > 1) {
    // Wind: a slow directional drift + faster gusts, shared across petals
    const windDir = Math.sin(time * 0.4) * 1.2;             // slow wind direction shift
    const windGust = Math.sin(time * 2.3) * 0.7;            // faster gusts
    const windStrength = 0.6 + 0.4 * Math.sin(time * 0.7);  // overall wind intensity

    for (let i = 0; i < f.petalCount; i++) {
      const baseAngle = (360 / f.petalCount) * i;
      const iRad = (baseAngle * Math.PI) / 180;

      // Per-petal phase offset so they don't all move in sync
      const phase = i * 1.17 + drug.id.length * 0.3;

      // Gentle angular wobble (wind catching each petal differently)
      const angularWobble = (Math.sin(time * 1.4 + phase) * 5.0
                           + Math.sin(time * 2.8 + phase * 1.3) * 2.5)
                           * windStrength;

      // Petals facing the wind direction sway more
      const windAlignment = Math.cos(iRad - windDir);
      const windPush = windAlignment * (windGust + windDir) * 5.0 * windStrength;

      // Breathing scale per petal (each slightly out of phase)
      const breathe = 1 + Math.sin(time * 1.1 + phase * 0.8) * 0.07
                        + Math.sin(time * 2.5 + phase * 1.5) * 0.04;

      // Skew to simulate the petal bending in wind
      const skewAmount = windAlignment * windStrength * 5.0 * Math.sin(time * 1.6 + phase);

      // Bloom/wilt: spread controls how far from center each petal fans out
      // When spread=0 (bud), petals cluster tightly upward; spread=1 = full fan
      const spreadAngle = baseAngle * petalSpread;
      // Droop: pull each petal's angle toward 180° (downward in SVG)
      // The further a petal is from pointing down, the more it rotates toward down
      const targetDown = 180;
      const angleDiff = targetDown - spreadAngle;
      // Normalize to -180..180
      const normalizedDiff = ((angleDiff + 540) % 360) - 180;
      const droopFactor = normalizedDiff * (petalDroop / 60);
      // Curl: shrink petals slightly to simulate curling inward
      const curlScale = Math.max(0.5, 1 + petalCurl * 0.25);
      // Petals shrink slightly as they wilt
      const wiltShrink = 1 - petalDroop * 0.008;

      const finalAngle = spreadAngle + angularWobble + windPush + droopFactor;

      const petalG = document.createElementNS(svgNS, 'g');
      petalG.setAttribute('transform',
        `rotate(${finalAngle}) scale(${breathe * curlScale * wiltShrink}, ${breathe * wiltShrink}) skewX(${skewAmount})`);

      const petal = document.createElementNS(svgNS, 'path');
      petal.setAttribute('d', petalPath(f.petalShape, petalR));
      petal.setAttribute('fill', `url(#grad-${drug.id})`);
      petal.setAttribute('opacity', Math.max(0.05, colorOpacity * opacityPulse));
      petalG.appendChild(petal);
      headG.appendChild(petalG);
    }
  }

  // Center disc
  if (centerR > 0.5) {
    // Ego dissolution halo — glowing aura around center for high ego dissolve
    if (egoLevel > 0.3 && glowOn) {
      const haloR = centerR * egoExpand * (1.5 + egoLevel * 0.8);
      const haloPulse = 0.5 + 0.5 * Math.sin(time * 3);
      const haloAlpha = (egoLevel - 0.3) * 0.35 * haloPulse * colorOpacity;
      const halo = document.createElementNS(svgNS, 'circle');
      halo.setAttribute('cx', 0);
      halo.setAttribute('cy', 0);
      halo.setAttribute('r', haloR);
      halo.setAttribute('fill', f.secondaryColor);
      halo.setAttribute('opacity', haloAlpha);
      headG.appendChild(halo);
    }

    const outer = document.createElementNS(svgNS, 'circle');
    outer.setAttribute('cx', 0);
    outer.setAttribute('cy', 0);
    outer.setAttribute('r', centerR * egoExpand);
    outer.setAttribute('fill', f.secondaryColor);
    outer.setAttribute('opacity', Math.max(0.05, colorOpacity * 0.85));
    headG.appendChild(outer);

    const inner = document.createElementNS(svgNS, 'circle');
    inner.setAttribute('cx', 0);
    inner.setAttribute('cy', 0);
    inner.setAttribute('r', centerR * 0.45 * egoExpand);
    inner.setAttribute('fill', f.primaryColor);
    inner.setAttribute('opacity', Math.max(0.05, colorOpacity));
    headG.appendChild(inner);
  }

  // Seed dot when not yet bloomed
  if (bloomScale < 0.08) {
    const seed = document.createElementNS(svgNS, 'circle');
    seed.setAttribute('cx', 0);
    seed.setAttribute('cy', 0);
    seed.setAttribute('r', 2.5 * sc);
    seed.setAttribute('fill', f.primaryColor);
    seed.setAttribute('opacity', 0.7);
    headG.appendChild(seed);
  }

  g.appendChild(headG);
}
</script>
</body>
</html>
